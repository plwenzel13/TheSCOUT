var DvtAmxThematicMap=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtAmxThematicMap,DvtContainer,"DvtAmxThematicMap");DvtAmxThematicMap._LEGEND_COMPONET_GAP=10;DvtAmxThematicMap.prototype.Init=function(a,b,c){DvtAmxThematicMap.superclass.Init.call(this,a);this._tmap=new DvtThematicMap(a,b,c);this._tmapContainer=new DvtContainer(a);this._tmapContainer.addChild(this._tmap);this.addChild(this._tmapContainer);this.Defaults=new DvtThematicMapDefaults};
DvtAmxThematicMap.newInstance=function(a,b,c){return new DvtAmxThematicMap(a,b,c)};DvtAmxThematicMap.prototype.render=function(a,b,c){this.Options=this.Defaults.calcOptions(a);this._width=b;this._height=c;b=new DvtRectangle(0,0,b,c);this._renderLegend(this,b);this._tmap.render(a,b.w,b.h)};
DvtAmxThematicMap.prototype._renderLegend=function(a,b){this._legend&&(a.removeChild(this._legend),this._legend=null);var c=new DvtRectangle(DvtAmxThematicMap._LEGEND_COMPONET_GAP,DvtAmxThematicMap._LEGEND_COMPONET_GAP,b.w-2*DvtAmxThematicMap._LEGEND_COMPONET_GAP,b.h-2*DvtAmxThematicMap._LEGEND_COMPONET_GAP),d=this.Options,e=d.legend.rendered,g=d.legend.scrolling,h=DvtJSONUtils.clone(d.legend);this._addLegendData(this.Options,h);if(e&&(!h.sections||0!=h.sections.length)){e=d.legend.position;delete h.position;
h.layout.gapRatio=this.getGapRatio();h.hideAndShowBehavior="none";h.rolloverBehavior="none";h.scrolling=d.legend.scrolling;var k=DvtLegend.newInstance(this._tmap.getCtx());a.addChild(k);"auto"==e&&"asNeeded"!==g?e="bottom":"auto"==e&&"asNeeded"==g&&(e="end");g=DvtAgent.isRightToLeft(a.getCtx());"start"==e?e=g?"right":"left":"end"==e&&(e=g?"left":"right");h.orientation="left"==e||"right"==e?"vertical":"horizontal";g="top"==e||"bottom"==e;g=k.getPreferredSize(h,g?c.w:d.layout.legendMaxSize*c.w,g?d.layout.legendMaxSize*
c.h:c.h);if(0<g.w&&0<g.h)switch(k.render(h,g.w,g.h),this._legend=k,d=DvtThematicMapDefaults.getGapSize(this,d.layout.legendGap),DvtLayoutUtils.position(c,e,k,g.w,g.h,d),e){case "top":this._tmapContainer.setTranslateY(g.h+DvtAmxThematicMap._LEGEND_COMPONET_GAP);case "bottom":b.h-=g.h+DvtAmxThematicMap._LEGEND_COMPONET_GAP;break;case "left":this._tmapContainer.setTranslateX(g.w+DvtAmxThematicMap._LEGEND_COMPONET_GAP);case "right":b.w-=g.w+DvtAmxThematicMap._LEGEND_COMPONET_GAP}}};
DvtAmxThematicMap.prototype.getGapRatio=function(){if(null===this.Options.layout.gapRatio||isNaN(this.Options.layout.gapRatio)){var a=Math.min(this._width/400,1),b=Math.min(this._height/300,1);return Math.min(a,b)}return this.Options.layout.gapRatio};
DvtAmxThematicMap.prototype._addLegendData=function(a,b){b.title=a.legend?a.legend.title:null;b.sections=[];if(a&&a.legend&&a.legend.sections)for(var c=0;c<a.legend.sections.length;c++){var d=a.legend.sections[c];d&&b.sections.push({title:d.title,items:d.items,sections:d.sections})}return b};var DvtThematicMap=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtThematicMap,DvtPanZoomComponent,"DvtThematicMap");DvtThematicMap._FEATURES_OFF_PAN=1;DvtThematicMap._FEATURES_OFF_ZOOM=2;
DvtThematicMap._FEATURES_OFF_PAN_ZOOM=3;DvtThematicMap._FEATURES_OFF_ZOOMTOFIT=4;DvtThematicMap._FEATURES_OFF_PAN_ZOOMTOFIT=5;DvtThematicMap._FEATURES_OFF_ZOOM_ZOOMTOFIT=6;DvtThematicMap._FEATURES_OFF_ALL=7;DvtThematicMap._COLLAPSIBLE_PANEL_OFFSET=5;DvtThematicMap._ELEM_RESOURCES_CONTROLPANEL="controlPanelResources";DvtThematicMap._ELEM_RESOURCES_LEGEND="legendResources";DvtThematicMap._ELEM_RESOURCES_PANEL_DRAWER="panelDrawerResources";DvtThematicMap._ELEM_RESOURCES="resources";
DvtThematicMap.DEFAULT_MAX_ZOOM_FACTOR=6;
DvtThematicMap.prototype.Init=function(a,b,c){DvtThematicMap.superclass.Init.call(this,a,b,c);this._createHandlers();this._layers=[];this._drillAnimFadeOutObjs=[];this._legendButtonImages=this._legendData=this._legendPanel=this._legend=null;this._bBaseMapChanged=!1;this._drilledRowKeys=[];this._initDrilled={};this._processingInitDrilled=!1;this._drillDataLayer={};this._childToParent={};this._drilled=[];this._areaLayers=new DvtContainer(this.getCtx());this._dataAreaLayers=new DvtContainer(this.getCtx());
this._dataPointLayers=new DvtContainer(this.getCtx());this._labelLayers=new DvtContainer(this.getCtx());this._panning=this._zooming=this._initialZooming=!1;this._maxZoomFactor=DvtThematicMap.DEFAULT_MAX_ZOOM_FACTOR;this._isMarkerZoomBehaviorFixed=!0;this._selectedAreas={};this._bListenersRemoved=!1;this._showPopupBehaviors=null;this.setDisplayedControls(DvtControlPanel.CONTROLS_ALL);this.Defaults=new DvtThematicMapDefaults;this._eventHandler.associate(this,this);this._bRendered=!1};
DvtThematicMap.newInstance=function(a,b,c){return new DvtThematicMap(a,b,c)};DvtThematicMap.prototype.SetOptions=function(a){DvtThematicMap.superclass.SetOptions.call(this,a);DvtAgent.isEnvironmentBrowser()||(this.Options.animationOnDisplay="none",this.Options.animationOnMapChange="none",this.Options.animationOnDrill="none");(new DvtThematicMapJsonParser(this)).parse(this.Options)};DvtThematicMap.prototype.setStyleDefaults=function(a){this._styleDefaults=a};
DvtThematicMap.prototype.getStyleDefaults=function(){return this._styleDefaults};DvtThematicMap.prototype.getMaxZoomFactor=function(){return this._zooming?this._maxZoomFactor:1};DvtThematicMap.prototype.setMaxZoomFactor=function(a){this._maxZoomFactor=a};DvtThematicMap.prototype.isMarkerZoomBehaviorFixed=function(){return this._isMarkerZoomBehaviorFixed};DvtThematicMap.prototype.setMarkerZoomBehavior=function(a){this._isMarkerZoomBehaviorFixed="fixed"==a};
DvtThematicMap.prototype.__getEventManager=function(){return this._eventHandler};DvtThematicMap.prototype.addPointLayer=function(a){this._layers.push(a)};DvtThematicMap.prototype.addLayer=function(a){this._layers.push(a)};DvtThematicMap.prototype.getLayer=function(a){for(var b=0;b<this._layers.length;b++)if(this._layers[b].getLayerName()==a)return this._layers[b]};DvtThematicMap.prototype.getAllLayers=function(){return this._layers};DvtThematicMap.prototype.getAreaLayerContainer=function(){return this._areaLayers};
DvtThematicMap.prototype.getDataAreaContainer=function(){return this._dataAreaLayers};DvtThematicMap.prototype.getDataPointContainer=function(){return this._dataPointLayers};DvtThematicMap.prototype.getLabelContainer=function(){return this._labelLayers};DvtThematicMap.prototype.setMapName=function(a){this._bBaseMapChanged=this._mapName&&this._mapName!=a;this._mapName=a};DvtThematicMap.prototype.setAnimationOnDisplay=function(a){this._animationOnDisplay=a};
DvtThematicMap.prototype.setAnimationOnMapChange=function(a){this._animationOnMapChange=a};DvtThematicMap.prototype.setAnimationDuration=function(a){this._animationDuration=parseFloat(a)};DvtThematicMap.prototype.getAnimationDuration=function(){return this._animationDuration};DvtThematicMap.prototype.setDisplayTooltips=function(a){this._displayTooltips=a};DvtThematicMap.prototype.getDisplayTooltips=function(){return this._displayTooltips};
DvtThematicMap.prototype.setFeaturesOff=function(a){a=parseInt(a);var b=this.getDisplayedControls();if(a==DvtThematicMap._FEATURES_OFF_PAN||a==DvtThematicMap._FEATURES_OFF_PAN_ZOOM||a==DvtThematicMap._FEATURES_OFF_PAN_ZOOMTOFIT||a==DvtThematicMap._FEATURES_OFF_ALL)b&=~DvtControlPanel.CONTROLS_CENTER_BUTTON,this.setPanning(!1);if(a==DvtThematicMap._FEATURES_OFF_ZOOM||a==DvtThematicMap._FEATURES_OFF_PAN_ZOOM||a==DvtThematicMap._FEATURES_OFF_ZOOM_ZOOMTOFIT||a==DvtThematicMap._FEATURES_OFF_ALL)b&=~DvtControlPanel.CONTROLS_ZOOM,
this.setZooming(!1);if(a==DvtThematicMap._FEATURES_OFF_ZOOMTOFIT||a==DvtThematicMap._FEATURES_OFF_PAN_ZOOMTOFIT||a==DvtThematicMap._FEATURES_OFF_ZOOM_ZOOMTOFIT||a==DvtThematicMap._FEATURES_OFF_ALL)b&=~DvtControlPanel.CONTROLS_ZOOM_TO_FIT_BUTTON;this.setDisplayedControls(b)};DvtThematicMap.prototype.setInitialCenterX=function(a){this._initialCenterX=a};DvtThematicMap.prototype.setInitialCenterY=function(a){this._initialCenterY=a};
DvtThematicMap.prototype.setInitialZoom=function(a){this._initialZoom=a};DvtThematicMap.prototype.setAnimationOnDrill=function(a){this._animationOnDrill=a};DvtThematicMap.prototype.setDrillMode=function(a){this._drillMode=a;this._eventHandler.setDrillMode(a)};DvtThematicMap.prototype.setInitialZooming=function(a){this._initialZooming=a};DvtThematicMap.prototype.getLegendPanel=function(a){return this._legendPanel};
DvtThematicMap.prototype.PreRender=function(){DvtThematicMap.superclass.PreRender.call(this);!this.IsResize()&&this._pzcContainer&&(this._layers=[],this._drilledRowKeys=[],this._initDrilled={},this._drillDataLayer={},this._childToParent={},this._drilled=[],this.removeChild(this._legendPanel),this._legendButtonImages=this._legendData=this._legend=this._legendPanel=null,this.setDisplayedControls(DvtControlPanel.CONTROLS_ALL),this._panning=this._zooming=!0,this._oldPzc=this._pzc,this._areaLayers=new DvtContainer(this.getCtx()),
this._dataAreaLayers=new DvtContainer(this.getCtx()),this._dataPointLayers=new DvtContainer(this.getCtx()),this._labelLayers=new DvtContainer(this.getCtx()),this._showPopupBehaviors=null,this._eventHandler.removeListeners(this),this._createHandlers(),this._bListenersRemoved=!1,this._eventHandler.hideTooltip(),this._eventHandler.associate(this,this))};
DvtThematicMap.prototype._createHandlers=function(){this._eventHandler=new DvtThematicMapEventManager(this.getCtx(),this.__dispatchEvent,this);this._eventHandler.addListeners(this);DvtAgent.isTouchDevice()?this._keyboardHandler=null:(this._keyboardHandler=new DvtThematicMapKeyboardHandler(this,this._eventHandler),this._eventHandler.setKeyboardHandler(this._keyboardHandler))};
DvtThematicMap.prototype.HandleLegendResize=function(a){DvtAgent.isRightToLeft(this.getCtx())||(a=this.getWidth()-5-a.getWidth(),this._legendPanel.setTranslateX(a))};
DvtThematicMap.prototype._renderLegend=function(){if(this._legendData){this._legendPanel&&(this._legendPanel.destroy(),this.removeChild(this._legendPanel));var a="true"==this._legendData.disclosed,b="fixed"==this._legendData.display||DvtAgent.isEnvironmentBatik();if(!b||a){var c=this._legendData.maxWidth,d=c.indexOf("%"),c=-1!=d?parseFloat(c.substring(0,d))/100*this.getWidth():parseFloat(c),d=this.getHeight()-2*DvtThematicMap._COLLAPSIBLE_PANEL_OFFSET;if(this.getSkinName()==DvtCSSStyle.SKIN_ALTA)this._legendPanel=
new DvtPanelDrawer(this.getCtx(),null,this,"pd"),this._legendPanel.addEvtListener(DvtPanelDrawerEvent.TYPE,this.HandleLegendEvent,!1,this),this._legendPanel.setMaxWidth(c),this._legendPanel.setMaxHeight(d),this._legendPanel.setFixed(b),DvtAgent.isRightToLeft(this.getCtx())?(this._legendPanel.setDiscloseDirection(DvtPanelDrawer.DIR_RIGHT),this._legendPanel.setTranslateX(0)):this._legendPanel.setTranslateX(this.getWidth());else{var e=DvtCollapsiblePanel.COLLAPSE_NORTHEAST;this._legendPanel=new DvtCollapsiblePanel(this.getCtx(),
c,d,e,this.getResourcesMap(),this.getSubcomponentStyles(),a,b);this._legendPanel.addEvtListener(DvtCollapsiblePanelEvent.TYPE,this.HandleLegendEvent,!1,this);this._legendPanel.addEvtListener(DvtResizeEvent.RESIZE_EVENT,this.HandleLegendResize,!1,this);this._legendPanel.setButtonTooltips(this._legendData.expandTooltip,this._legendData.collapseTooltip)}c=this._legendData;this._legend=DvtLegend.newInstance(this.getCtx(),this.processLegendEvent,this);this.addChild(this._legendPanel);this.addChild(this._legend);
d=this._legend.getPreferredSize(c,this._legendPanel.getMaxContentWidth(),this._legendPanel.getMaxContentHeight());this._legend.render(c,d.w,d.h);var g;if(this.getSkinName()==DvtCSSStyle.SKIN_ALTA){this._legendPanel.setMaxContainerHeight(this._legend.getContentDimensions().h);this.removeChild(this._legend);var c=new DvtImage(this.getCtx(),this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_ICON_ENA],0,0,DvtPanelDrawer.IMAGE_SIZE,DvtPanelDrawer.IMAGE_SIZE),d=new DvtImage(this.getCtx(),this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_ICON_OVR],
0,0,DvtPanelDrawer.IMAGE_SIZE,DvtPanelDrawer.IMAGE_SIZE),e=new DvtImage(this.getCtx(),this.getResourcesMap()[DvtPanelDrawer.PANEL_LEGEND_ICON_DWN],0,0,DvtPanelDrawer.IMAGE_SIZE,DvtPanelDrawer.IMAGE_SIZE),h=DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,"LEGEND");this._legendPanel.addPanel(this._legend,c,d,e,h,DvtPanelDrawer.PANEL_LEGEND);this._legendPanel.renderComponent();a&&this._legendPanel.setDisclosed(!0,!0)}else this._legendPanel.addContent(this._legend),g=this._legendPanel.getDimensions(),
a=DvtAgent.isRightToLeft(this.getCtx())?5:this.getWidth()-5-g.w-g.x,this._legendPanel.setTranslate(a,5),g.w+=5;if(this._isFixedLegend=b)g||(g=this._legendPanel.getDimensions()),this._legendWidth=g.w,this._pzc.setSize(this.getWidth()-this._legendWidth,this.getHeight(),!0)}}};
DvtThematicMap.prototype.Render=function(){DvtThematicMap.superclass.Render.call(this);var a=new DvtContainer(this.getCtx()),b=new DvtContainer(this.getCtx());this._pzc=this.getPanZoomCanvas();this._pzc.addChild(a);this._pzc.getContentPane().addChild(b);this._render(a,b);if(this._topLayer){(this._controlPanel=this._pzc.getControlPanel())&&this._pzc.addChild(this._controlPanel);this._stopAnimation();b=new DvtRectangle(0,0,this.getWidth(),this.getHeight());if(this._bRendered||this._oldPzc){var c=null;
this._bBaseMapChanged&&!this.IsResize()?c=this._animationOnMapChange:this._topLayer&&this._topLayer.getLayerName()!=this._oldTopLayerName&&(c=this._topLayer.getAnimation());DvtBlackBoxAnimationHandler.isSupported(c)&&(this._animation=DvtBlackBoxAnimationHandler.getCombinedAnimation(this.getCtx(),c,this._oldPzc,this._pzc,b,this._animationDuration))&&this.addChild(this._oldPzc)}else DvtBlackBoxAnimationHandler.isSupported(this._animationOnDisplay)&&(this._animation=DvtBlackBoxAnimationHandler.getInAnimation(this.getCtx(),
this._animationOnDisplay,this._pzc,b,this._animationDuration));this._animation?(this._controlPanel&&this.addChild(this._controlPanel),this._eventHandler.hideTooltip(),this._eventHandler.removeListeners(this),this._bListenersRemoved=!0,this._animation.setOnEnd(this.OnAnimationEnd,this),this._animation.play()):this.OnAnimationEnd();this._pzcContainer=a;this._topLayer&&(this._oldTopLayerName=this._topLayer.getLayerName());this.getCtx().setKeyboardFocusArray([this]);this._bRendered=!0}};
DvtThematicMap.prototype._calcMinZoom=function(){var a=this._pzc.getZoomToFitPadding(),b=this._topLayer.getLayerDim(),c=this._pzc.getSize();return Math.min((c.w-2*a)/b.w,(c.h-2*a)/b.h)};
DvtThematicMap.prototype._render=function(a,b){this._renderLegend();b.addChild(this._areaLayers);b.addChild(this._dataAreaLayers);this.isMarkerZoomBehaviorFixed()?a.addChild(this._dataPointLayers):b.addChild(this._dataPointLayers);a.addChild(this._labelLayers);var c=this._pzc.getContentPane().getMatrix();this._topLayerRendered=!1;for(var d=0;d<this._layers.length;d++){var e=this._layers[d];if(!this._topLayerRendered&&e instanceof DvtMapAreaLayer||!(e instanceof DvtMapAreaLayer))e.render(c),!this._topLayerRendered&&
e instanceof DvtMapAreaLayer&&(this._topLayerRendered=!0,this._topLayer=e)}this._topLayer&&(c=this._topLayer.getIsolatedArea(),this._isolatedArea!=c&&(this._isolatedArea=c,this.setInitialCenterX(null),this.setInitialCenterY(null),this.setInitialZoom(null)),c=this.getNavigableAreas(),0==c.length&&(c=this.getNavigableObjects()),this._keyboardHandler&&this._eventHandler.setInitialFocus(c[0]),this._pzc.setMinZoom(null),this._pzc.setMaxZoom(null),this._pzc.setZoomingEnabled(!0),this._pzc.setPanningEnabled(!0),
this._bBaseMapChanged||this.IsResize()||null==this._initialZoom?this._pzc.zoomToFit(null,this._topLayer.getLayerDim()):(this._pzc.zoomTo(this._initialZoom),this._pzc.panTo(this._initialCenterX,this._initialCenterY)),this._processInitialDrilled(),this._updateZoomLimits(),this._pzc.setZoomingEnabled(this._zooming),this._pzc.setPanningEnabled(this._panning))};
DvtThematicMap.prototype.updateLayer=function(a,b,c){this._bRendered=!1;this._stopAnimation();(new DvtThematicMapJsonParser(this)).ParseDataLayers([a],this.getLayer(b),this._topLayer.getLayerName(),c);this._renderLegend();this._bRendered=!0;this._updateZoomLimits()};DvtThematicMap.prototype._updateZoomLimits=function(){var a=this._calcMinZoom();this._pzc.setMinZoom(a);this._pzc.setMaxZoom(a*this.getMaxZoomFactor())};
DvtThematicMap.prototype.OnUpdateLayerEnd=function(){this._topLayer.getIsolatedArea()&&this._pzc.zoomToFit(null,this._topLayer.getLayerDim());this._processInitialDrilled();this._initialZooming&&this._zoomData()};DvtThematicMap.prototype.getMapName=function(){return this._mapName};DvtThematicMap.prototype.getDrillMode=function(){return this._drillMode};DvtThematicMap.prototype.setLegendData=function(a){this._legendData=a};
DvtThematicMap.prototype.setRolloverBehavior=function(a){this._rolloverBehavior=a};DvtThematicMap.prototype.getRolloverBehavior=function(){return this._rolloverBehavior};DvtThematicMap.prototype._transformContainers=function(a){var b=new DvtMatrix;b.translate(a.getTx(),a.getTy());this.isMarkerZoomBehaviorFixed()&&this._dataPointLayers.setMatrix(b);this._labelLayers.setMatrix(b)};
DvtThematicMap.prototype.HandleLegendEvent=function(a){var b=new DvtSetPropertyEvent;b.addParam(DvtPanZoomComponent.LEGEND_DISCLOSED_EVENT_KEY,a.getSubType()==DvtCollapsiblePanelEvent.SUBTYPE_SHOW);this.__dispatchEvent(b)};
DvtThematicMap.prototype._constrainPanning=function(a){var b=this._pzc.getZoomToFitPadding(),c=this._pzc.getSize(),b=new DvtRectangle(b,b,c.w-2*b,c.h-2*b),d=this._topLayer.getLayerDim(),e=d.x*a,c=d.y*a,g=d.w*a;a*=d.h;d=0;g>b.w?(this._isFixedLegend&&DvtAgent.isRightToLeft(this.getCtx())&&(d=this._legendWidth),this._pzc.setMinPanX(b.x+b.w+d-(e+g)),this._pzc.setMaxPanX(b.x-e+d)):(this._isFixedLegend&&DvtAgent.isRightToLeft(this.getCtx())&&(d=2*this._legendWidth),e=(b.x+b.w+d)/2-(e+g/2),this._pzc.setMinPanX(e),
this._pzc.setMaxPanX(e));a>b.h?(this._pzc.setMinPanY(b.y+b.h-(c+a)),this._pzc.setMaxPanY(b.y-c)):(b=(b.y+b.h)/2-(c+a/2),this._pzc.setMinPanY(b),this._pzc.setMaxPanY(b))};
DvtThematicMap.prototype._updateAnimator=function(a,b){var c=a.getAnimator();if(c){var d=this._pzc.getContentPane(),e=c.getDestVal(d,d.getMatrix);b&&(this._currentAnimMatrix=d.getMatrix(),c.addProp(DvtAnimator.TYPE_MATRIX,this,this._getCenteredObjsMatrix,this._setCenteredObjsMatrix,e));d=new DvtMatrix(1,0,0,1,e.getTx(),e.getTy());this.isMarkerZoomBehaviorFixed()&&c.addProp(DvtAnimator.TYPE_MATRIX,this._dataPointLayers,this._dataPointLayers.getMatrix,this._dataPointLayers.setMatrix,d);c.addProp(DvtAnimator.TYPE_MATRIX,
this._labelLayers,this._labelLayers.getMatrix,this._labelLayers.setMatrix,d)}};
DvtThematicMap.prototype.HandleZoomEvent=function(a){switch(a.getSubType()){case DvtZoomEvent.SUBTYPE_ADJUST_PAN_CONSTRAINTS:this._panning&&this._constrainPanning(a.getNewZoom());break;case DvtZoomEvent.SUBTYPE_ZOOMING:case DvtZoomEvent.SUBTYPE_ELASTIC_ANIM_BEGIN:this._updateAnimator(a,!0);break;case DvtZoomEvent.SUBTYPE_ZOOMED:if(null!=a.getNewZoom()){var b=this._pzc.getContentPane().getMatrix();a.addParam("panX",b.getTx());a.addParam("panY",b.getTy());a._animator=null;this.__dispatchEvent(a);this._transformContainers(b);
for(var c=0;c<this._layers.length;c++)this._layers[c].HandleZoomEvent(a,b)}break;case DvtZoomEvent.SUBTYPE_ZOOM_AND_CENTER:this.fitSelectedRegions();break;case DvtZoomEvent.SUBTYPE_ZOOM_TO_FIT_END:this.__dispatchEvent(new DvtZoomEvent)}};
DvtThematicMap.prototype.HandlePanEvent=function(a){var b=a.getSubType();if(b==DvtPanEvent.SUBTYPE_ELASTIC_ANIM_BEGIN)this._updateAnimator(a,!1);else if(b==DvtPanEvent.SUBTYPE_PANNED&&null!=a.getNewX()){var c=this._pzc.getContentPane().getMatrix();a.addParam("zoom",this._pzc.getZoom());a.addParam("panX",c.getTx());a.addParam("panY",c.getTy());a._animator=null;this.__dispatchEvent(a);this._transformContainers(c);for(a=0;a<this._layers.length;a++)this._layers[a].HandlePanEvent(c)}this._legendPanel&&
(this.getSkinName()==DvtCSSStyle.SKIN_ALTA?b===DvtPanEvent.SUBTYPE_DRAG_PAN_BEGIN?this._legendPanel.setMouseEnabled(!1):b===DvtPanEvent.SUBTYPE_DRAG_PAN_END&&this._legendPanel.setMouseEnabled(!0):(c=this.getSubcomponentStyles(),a=this._legendPanel._background.getStroke().clone(),b===DvtPanEvent.SUBTYPE_DRAG_PAN_BEGIN?(this._legend.setAlpha(c[DvtControlPanel.BG_DRAG_ALPHA]),a.setAlpha(c[DvtControlPanel.FRAME_DRAG_ALPHA]),this._legendPanel._background.setStroke(a),this._legendPanel._buttonFrame&&this._legendPanel._buttonFrame.setAlpha(c[DvtControlPanel.FRAME_DRAG_ALPHA]),
this._legendPanel.setMouseEnabled(!1)):b===DvtPanEvent.SUBTYPE_DRAG_PAN_END&&(this._legend.setAlpha(1),a.setAlpha(c[DvtControlPanel.FRAME_ROLLOUT_ALPHA]),this._legendPanel._background.setStroke(a),this._legendPanel._buttonFrame&&this._legendPanel._buttonFrame.setAlpha(c[DvtControlPanel.FRAME_ROLLOUT_ALPHA]),this._legendPanel.setMouseEnabled(!0))))};
DvtThematicMap.prototype.GetControlPanelBehavior=function(){return"none"!=this._drillMode||this._zooming||this._panning&&this.getSkinName()!=DvtCSSStyle.SKIN_ALTA?DvtThematicMap.superclass.GetControlPanelBehavior.call(this):DvtPanZoomComponent.CONTROL_PANEL_BEHAVIOR_HIDDEN};
DvtThematicMap.prototype.GetControlPanel=function(){var a=this.GetControlPanelBehavior();return a!=DvtPanZoomComponent.CONTROL_PANEL_BEHAVIOR_HIDDEN?(a=a==DvtPanZoomComponent.CONTROL_PANEL_BEHAVIOR_INIT_COLLAPSED?DvtControlPanel.STATE_COLLAPSED:DvtControlPanel.STATE_EXPANDED,new DvtThematicMapControlPanel(this.getCtx(),this,a)):null};DvtThematicMap.prototype.setZooming=function(a){this._zooming=a};DvtThematicMap.prototype.setPanning=function(a){this._panning=a};
DvtThematicMap.prototype.addDisclosedRowKey=function(a){this._drilledRowKeys.push(a)};DvtThematicMap.prototype.addDrilledLayer=function(a,b){this._initDrilled[a]=b};
DvtThematicMap.prototype._processInitialDrilled=function(){this._processingInitDrilled=!0;for(var a=0;a<this._layers.length;a++){var b=this._layers[a].getLayerName();b in this._initDrilled&&(this._selectedAreas[b]=this._initDrilled[b][1],this._clickedLayerName=b,this._clickedDataLayerId=this._initDrilled[b][0],this.drillDown())}this._processingInitDrilled=!1};
DvtThematicMap.prototype.resetMap=function(){this._stopAnimation();for(var a=[],b=[],c=this._layers.length-1;-1<c;c--)this._layers[c].getLayerName()==this._topLayer.getLayerName()?this._layers[c].reset(b):this._layers[c].reset(a);for(c=0;c<a.length;c++)if(a[c]){var d=a[c].getParent();d&&d.removeChild(a[c])}for(c=0;c<b.length;c++)b[c]&&b[c].setAlpha(1);this._drilledRowKeys=[];this.fitMap();this._drilled=[];this._controlPanel&&"none"!=this._drillMode&&(this._controlPanel.setEnabledDrillDownButton(!1),
this._controlPanel.setEnabledDrillUpButton(!1))};
DvtThematicMap.prototype._zoomData=function(){var a=this._dataAreaLayers.getDimensions(),b=this._dataPointLayers.getDimensions();if(this.isMarkerZoomBehaviorFixed()){var c=this._pzc.getContentPane().getMatrix();b.w/=c.getA();b.h/=c.getD();b.x/=c.getA();b.y/=c.getD()}a=a.getUnion(b);this._stopAnimation();var d;this._pzc.isZoomingEnabled()||(d=this._pzc.getMaxZoom(),this._pzc.setMaxZoom(d*this._maxZoomFactor));var e;DvtAgent.isEnvironmentBrowser()&&(e=new DvtAnimator(this.getCtx(),.3));0<a.w&&0<a.h?
this._pzc.zoomToFit(e,a):this._pzc.zoomToFit(e,this._topLayer.getLayerDim());e&&e.play();d&&this._pzc.setMaxZoom(d)};DvtThematicMap.prototype._zoomToFitBounds=function(a){var b=new DvtAnimator(this.getCtx(),.3);this._pzc.zoomToFit(b,a);b.play()};DvtThematicMap.prototype.fitRegion=function(a){a||(a=this._zoomToFitObject);a||(a=this._clickedObject);this._zoomToFitBounds(a.getDimensions())};
DvtThematicMap.prototype.fitSelectedRegions=function(){if(this._clickedDataLayerId){var a=this.getLayer(this._clickedLayerName).getDataLayer(this._clickedDataLayerId);if(a&&(a=a._selectionHandler)){for(var a=a.getSelection(),b=0;b<a.length;b++)a[b]=a[b].getDisplayable();if(0<a.length){for(var c=a[0].getDimensions(),b=1;b<a.length;b++)c=c.getUnion(a[b].getDimensions());this._zoomToFitBounds(c)}}}};
DvtThematicMap.prototype.fitMap=function(){var a=new DvtAnimator(this.getCtx(),.3);this._pzc.zoomToFit(a);a.play()};DvtThematicMap.prototype.getDrillParentLayer=function(a){a=DvtBaseMapManager.getParentLayerName(this._mapName,a);return this.getLayer(a)};DvtThematicMap.prototype.getDrillChildLayer=function(a){a=DvtBaseMapManager.getChildLayerName(this._mapName,a);return this.getLayer(a)};
DvtThematicMap.prototype.getNavigableAreas=function(){var a=[];if(this._topLayer)for(var b=0;b<this._layers.length;b++){var c=this._layers[b].getDataLayers(),d;for(d in c)a=this._topLayer.getLayerName()==this._layers[b].getLayerName()?a.concat(c[d].getNavigableAreaObjects()):a.concat(c[d].getNavigableDisclosedAreaObjects())}return a};
DvtThematicMap.prototype.getNavigableObjects=function(){var a=[];if(this._topLayer)for(var b=0;b<this._layers.length;b++){var c=this._layers[b].getDataLayers();if(this._topLayer.getLayerName()==this._layers[b].getLayerName()||!(this._layers[b]instanceof DvtMapAreaLayer))for(var d in c)a=a.concat(c[d].getDataObjects())}return a};
DvtThematicMap.prototype._setCenteredObjsMatrix=function(a){this._currentAnimMatrix=a;if(this.isMarkerZoomBehaviorFixed()){for(var b=this.getNavigableObjects(),c=0;c<b.length;c++)b[c].HandleZoomEvent(a);b=this._labelLayers.getNumChildren();for(c=0;c<b;c++)for(var d=this._labelLayers.getChildAt(c),e=d.getNumChildren(),g=0;g<e;g++){var h=d.getChildAt(g);h instanceof DvtMapLabel&&h.update(a)}}};DvtThematicMap.prototype._getCenteredObjsMatrix=function(){return this._currentAnimMatrix};
DvtThematicMap.prototype.drillDown=function(){this._stopAnimation();var a=this.getDrillChildLayer(this._clickedLayerName),b=this.getLayer(this._clickedLayerName),c=[];if(a){this._drillDataLayer[this._clickedLayerName]=this._clickedDataLayerId;var d=this._selectedAreas[this._clickedLayerName];this._processingInitDrilled||"single"!=this._drillMode||(this._drilled.pop(),b.reset(c,d),a.reset(this._drillAnimFadeOutObjs));for(var e=[],g=0;g<d.length;g++){var h=d[g],k=b.getChildrenForArea(h);e.push(k[0]);
for(var m=0;m<k.length;m++)this._childToParent[k[m]]=d[g];a.discloseAreas(k,c);(k=b.getDataLayer(this._clickedDataLayerId))&&k.drill(h,this._drillAnimFadeOutObjs);this._drilled.push(h)}this._handleDrillAnimations(this._drillAnimFadeOutObjs,c,!1);this._updateDrillButton(a.getLayerName());this._clickedLayerName=a.getLayerName();this._selectedAreas[this._clickedLayerName]=e}};
DvtThematicMap.prototype.drillUp=function(){this._stopAnimation();for(var a=this.getLayer(this._clickedLayerName),b=this.getDrillParentLayer(this._clickedLayerName),c=[],d=[],e=this._selectedAreas[this._clickedLayerName],g=0;g<e.length;g++){var h=this._childToParent[e[g]];d.push(h);if(-1!=DvtArrayUtils.getIndex(this._drilled,h)){var k=b.getChildrenForArea(h);a.undiscloseAreas(k,this._drillAnimFadeOutObjs);b.getDataLayer(this._drillDataLayer[b.getLayerName()]).undrill(h,c);h=DvtArrayUtils.getIndex(this._drilled,
h);-1!=h&&this._drilled.splice(h,1)}}this._handleDrillAnimations(this._drillAnimFadeOutObjs,c,!0);this._clickedLayerName=b.getLayerName();this._clickedDataLayerId=this._drillDataLayer[this._clickedLayerName];this._selectedAreas[this._clickedLayerName]=d;this._updateDrillButton(this._clickedLayerName)};DvtThematicMap.prototype._stopAnimation=function(){this._animation&&(this._animation.stop(!0),this._animation=null)};
DvtThematicMap.prototype._handleDrillAnimations=function(a,b,c){this._pzc.getContentPane().getMatrix();if("zoomToFit"==this._animationOnDrill&&!this._processingInitDrilled){var d=new DvtAnimator(this.getCtx(),.3);DvtAgent.isEnvironmentBrowser()||(d=null);c?this._pzc.zoomToFit(d):this.fitSelectedRegions();d&&d.play()}this._stopAnimation();!DvtAgent.isEnvironmentBrowser()||"alphaFade"!=this._animationOnDrill&&"auto"!=this._animationOnDrill||(this._animation=DvtBlackBoxAnimationHandler.getCombinedAnimation(this.getCtx(),
"alphaFade",a,b,null,.5));this._animation?(this._eventHandler.hideTooltip(),this._eventHandler.removeListeners(this),this._animation.setOnEnd(this.OnDrillAnimationEnd,this),this._animation.play()):this._cleanUpDrilledObjects()};DvtThematicMap.prototype.setClickInfo=function(a,b,c){this._clickedLayerName=b;this._clickedDataLayerId=a;this._clickedObject=c};DvtThematicMap.prototype.setEventClientId=function(a){this._eventClientId=a};
DvtThematicMap.prototype.__dispatchEvent=function(a){var b=a.getType();b==DvtSelectionEvent.TYPE?this._handleSelectionEvent(a):b==DvtMapDrillEvent.TYPE?this._handleDrillEvent(a):b!=DvtShowPopupEvent.TYPE&&b!=DvtHidePopupEvent.TYPE||a.addParam("clientId",this._eventClientId);DvtThematicMap.superclass.__dispatchEvent.call(this,a)};
DvtThematicMap.prototype._handleSelectionEvent=function(a){if(this._clickedDataLayerId){this._selectedRowKeys=a.getSelection();var b=this.getLayer(this._clickedLayerName).getDataLayer(this._clickedDataLayerId);this._selectedAreas[this._clickedLayerName]=b.getSelectedAreas(this._selectedRowKeys);this._updateDrillButton(this._clickedLayerName);a.addParam("clientId",this._clickedDataLayerId);!this._clickedObject||this._clickedObject instanceof DvtMarker||(this._zoomToFitObject=this._clickedObject)}else this._updateDrillButton(null),
this._zoomToFitObject=null};DvtThematicMap.prototype._hideSelectionMenu=function(){this._selectionText&&(this.removeChild(this._selectionText),this._selectionText=null)};
DvtThematicMap.prototype._updateDrillButton=function(a){if(this._controlPanel&&this._drillMode&&"none"!=this._drillMode){var b=this.getDrillChildLayer(a);a=this.getDrillParentLayer(a);b?this._controlPanel.setEnabledDrillDownButton(!0):this._controlPanel.setEnabledDrillDownButton(!1);a?this._controlPanel.setEnabledDrillUpButton(!0):this._controlPanel.setEnabledDrillUpButton(!1)}};
DvtThematicMap.prototype._handleDrillEvent=function(a){a.addParam("clientId",this._eventClientId);this._drilledRowKeys="multiple"==this._drillMode?this._drilledRowKeys.concat(this._selectedRowKeys):this._selectedRowKeys;var b=a.getDrillType();b==DvtMapDrillEvent.DRILL_UP&&this.drillUp();b==DvtMapDrillEvent.DRILL_DOWN?this.drillDown():b==DvtMapDrillEvent.RESET&&this.resetMap();a.setDisclosed(this._drilledRowKeys)};
DvtThematicMap.prototype.destroy=function(){DvtThematicMap.superclass.destroy.call(this);this._eventHandler&&(this._eventHandler.destroy(),this._eventHandler=null)};
DvtThematicMap.prototype.OnAnimationEnd=function(){this._controlPanel&&this._pzc.addChild(this._controlPanel);this._oldPzc&&(this.removeChild(this._oldPzc),this._oldPzc=null);this._animation=null;this._initialZooming&&this._zoomData();this.Options.highlightedCategories&&0<this.Options.highlightedCategories.length&&this.highlight(this.Options.highlightedCategories);this._bListenersRemoved&&(this._eventHandler.addListeners(this),this._bListenersRemoved=!1)};
DvtThematicMap.prototype.OnDrillAnimationEnd=function(){this._cleanUpDrilledObjects();this._animation=null;this._eventHandler.addListeners(this)};DvtThematicMap.prototype._cleanUpDrilledObjects=function(){if(0<this._drillAnimFadeOutObjs.length){for(var a=0;a<this._drillAnimFadeOutObjs.length;a++){var b=this._drillAnimFadeOutObjs[a];if(b)if(b instanceof DvtMapLabel)b.reset();else if(b.isDrilled&&b.isDrilled())b.setAlpha(0);else{var c=b.getParent();c&&c.removeChild(b)}}this._drillAnimFadeOutObjs=[]}};
DvtThematicMap.prototype._fireRolloverEvent=function(a,b){var c=new DvtCategoryRolloverEvent(a,b),d=[],e;for(e in this._areas)for(var g in this._areas[e])d.push(this._areas[e][g]);for(e in this._markers)for(g in this._markers[e])d.push(this._markers[e][g]);e=this._legend._hideAttrsLookUp;for(var h in e)g=new DvtThematicMapCategoryWrapper(e[h].getContentShape(),h),d.push(g);DvtCategoryRolloverHandler.highlight(c.getCategory(),d,!0)};
DvtThematicMap.prototype.getShapesForViewSwitcher=function(a){a={};var b=this._topLayer.getDataLayers(),c;for(c in b){c=b[c].getAreaObjects();for(b=0;b<c.length;b++){var d=c[b],e=d.getDisplayable();a[d.getId()]=e}break}return a};DvtThematicMap.prototype.getShowPopupBehaviors=function(){return this._showPopupBehaviors};DvtThematicMap.prototype.setShowPopupBehaviors=function(a){this._showPopupBehaviors=a};
DvtThematicMap.prototype.getAutomation=function(){this.Automation||(this.Automation=new DvtThematicMapAutomation(this));return this.Automation};DvtThematicMap.prototype.GetComponentDescription=function(){return DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,"THEMATIC_MAP")};DvtThematicMap.prototype.processLegendEvent=function(a,b){a.getType()==DvtResizeEvent.RESIZE_EVENT&&this._legend&&this._legend.FireListener(a)};
DvtThematicMap.prototype.highlight=function(a){this.Options.highlightedCategories=DvtJSONUtils.clone(a);DvtCategoryRolloverHandler.highlight(a,this.getNavigableAreas().concat(this.getNavigableObjects()),"any"==this.Options.highlightMatch)};DvtThematicMap.prototype.processDefaultHoverEffect=function(a,b){var c=this._getDataItemById(a);c&&c.processDefaultHoverEffect(b)};DvtThematicMap.prototype.processDefaultSelectionEffect=function(a,b){var c=this._getDataItemById(a);c&&c.processDefaultSelectionEffect(b)};
DvtThematicMap.prototype.processDefaultFocusEffect=function(a,b){var c=this._getDataItemById(a);c&&c.processDefaultFocusEffect(b)};DvtThematicMap.prototype._getDataItemById=function(a){for(var b=0;b<this._layers.length;b++){var c=this._layers[b].getDataLayers(),d;for(d in c)for(var e=c[d].getDataObjects(),b=0;b<e.length;b++)if(e[b].getId()===a)return e[b]}return null};var DvtThematicMapDefaults=function(){this.Init({fusion:DvtThematicMapDefaults.DEFAULT,alta:DvtThematicMapDefaults.SKIN_ALTA})};
DvtObj.createSubclass(DvtThematicMapDefaults,DvtBaseComponentDefaults,"DvtThematicMapDefaults");
DvtThematicMapDefaults.DEFAULT={animationDuration:500,animationOnDisplay:"none",animationOnDrill:"none",animationOnMapChange:"none",controlPanelBehavior:"hidden",drilling:"none",highlightMatch:"all",hoverBehavior:"none",initialZooming:"none",markerZoomBehavior:"fixed",panning:"none",tooltipDisplay:"auto",touchResponse:"auto",visualEffects:"none",zooming:"none",styleDefaults:{skin:"alta",areaStyle:"background-color:#B8CDEC;border-color:#FFFFFF;",hoverBehaviorDelay:200,dataAreaDefaults:{borderColor:"#FFFFFF",
drilledInnerColor:"#FFFFFF",drilledOuterColor:"#000000",hoverColor:"#FFFFFF",opacity:1,selectedInnerColor:"#FFFFFF",selectedOuterColor:"#000000"},dataMarkerDefaults:{borderColor:"#FFFFFF",borderStyle:"solid",borderWidth:.5,color:"#000000",height:8,labelStyle:"font-family:Tahoma;font-size:13pt;color:#000000",opacity:.4,scaleX:1,scaleY:1,shape:"circle",width:8},labelStyle:"font-family:Tahoma;font-size:11pt;"},legend:{position:"auto",rendered:!0,layout:{gapRatio:1}},layout:{gapRatio:null,legendMaxSize:.3,
legendGap:10},resources:{images:{},translations:{}}};DvtThematicMapDefaults.SKIN_ALTA={styleDefaults:{areaStyle:"background-color:#DDDDDD;border-color:#FFFFFF;",dataAreaDefaults:{drilledOuterColor:"#0572CE"},dataMarkerDefaults:{color:"rgb(51,51,51)",labelStyle:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;color:#333333',opacity:1},labelStyle:'font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;'}};
DvtThematicMapDefaults.DEFAULT_AREA_LAYER={animationOnLayerChange:"none",labelDisplay:"auto",labelType:"short"};DvtThematicMapDefaults.DEFAULT_DATA_LAYER={animationOnDataChange:"none",selectionMode:"none"};DvtThematicMapDefaults.prototype.calcAreaLayerOptions=function(a){return DvtJSONUtils.merge(a,DvtThematicMapDefaults.DEFAULT_AREA_LAYER)};DvtThematicMapDefaults.prototype.calcDataLayerOptions=function(a){return DvtJSONUtils.merge(a,DvtThematicMapDefaults.DEFAULT_DATA_LAYER)};
DvtThematicMapDefaults.getGapSize=function(a,b){return Math.ceil(b*a.getGapRatio())};DvtThematicMap.prototype._getCurrentDragSource=function(){for(var a=0;a<this._layers.length;a++){var b=this._layers[a].getDataLayers(),c;for(c in b){var d=b[c].getDragSource();if(d&&d.getDragCandidate())return d}}return null};DvtThematicMap.prototype.isDragAvailable=function(a,b,c){this._dragAllowed=!1;return(a=this._getCurrentDragSource())?a.isDragAvailable(c):!1};
DvtThematicMap.prototype.getDragTransferable=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragTransferable(a,b):null};DvtThematicMap.prototype.getDragOverFeedback=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragOverFeedback(a,b):null};DvtThematicMap.prototype.getDragContext=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragContext(a,b):null};
DvtThematicMap.prototype.getDragOffset=function(a,b){var c=this._getCurrentDragSource();return c?c.getDragOffset(a,b):null};DvtThematicMap.prototype.getPointerOffset=function(a,b){var c=this._getCurrentDragSource();return c?c.getPointerOffset(a,b):null};DvtThematicMap.prototype.initiateDrag=function(){var a=this._getCurrentDragSource();a&&a.initiateDrag()};DvtThematicMap.prototype.dragDropEnd=function(){var a=this._getCurrentDragSource();a&&a.dragDropEnd();this.getPanZoomCanvas().resetTouchTargets()};
DvtThematicMap.prototype.prepDrag=function(){this._panning?this._startDragDropTimer(1E3):this._dragAllowed=!0};DvtThematicMap.prototype.abortPrep=function(){this._stopDragDropTimer()};DvtThematicMap.prototype.recognizeDrag=function(){this._stopDragDropTimer();return this._dragAllowed};DvtThematicMap.prototype._startDragDropTimer=function(a){this._dragDropTimer=new DvtTimer(this.getCtx(),a,this._handleDragDropTimer,this,1);this._dragDropTimer.start()};
DvtThematicMap.prototype._handleDragDropTimer=function(){this._stopDragDropTimer();this._dragAllowed=!0};DvtThematicMap.prototype._stopDragDropTimer=function(){this._dragDropTimer&&(this._dragDropTimer.stop(),this._dragDropTimer=null)};DvtThematicMap.prototype._getCurrentDropTarget=function(a,b){for(var c=0;c<this._layers.length;c++)if(this._layers[c].getDropTarget){var d=this._layers[c].getDropTarget();if(d&&d.getDropSite(a,b))return d}return null};
DvtThematicMap.prototype.acceptDrag=function(a,b,c){var d=this._pzc.getZoom();a=(a-this._pzc.getPanX())/d;b=(b-this._pzc.getPanY())/d;return(this._dropTarget=this._getCurrentDropTarget(a,b))?this._dropTarget.acceptDrag(a,b,c):null};DvtThematicMap.prototype.dragEnter=function(){return this._dropTarget?this._dropTarget.dragEnter():null};DvtThematicMap.prototype.dragExit=function(){return this._dropTarget?this._dropTarget.dragExit():null};
DvtThematicMap.prototype.getDropSite=function(a,b){var c=this._pzc.getZoom();a=(a-this._pzc.getPanX())/c;b=(b-this._pzc.getPanY())/c;return this._dropTarget?this._dropTarget.getDropSite(a,b):null};var DvtThematicMapDropTarget=function(a,b){this._areaLayer=a;this._basemap=b};DvtObj.createSubclass(DvtThematicMapDropTarget,DvtDropTarget,"DvtThematicMapDropTarget");
DvtThematicMapDropTarget.prototype.acceptDrag=function(a,b,c){a=this._areaLayer.__getObjectUnderPoint(a,b);if(!a)return this._areaLayer.__showDropSiteFeedback(null),null;a!=this._dropSite&&(this._areaLayer.__showDropSiteFeedback(a),this._dropSite=a);return c[0]};DvtThematicMapDropTarget.prototype.dragExit=function(){this._areaLayer.__showDropSiteFeedback(null);this._dropSite=null};
DvtThematicMapDropTarget.prototype.getDropSite=function(a,b){var c=this._areaLayer.__getObjectUnderPoint(a,b);if(c){var d=DvtThematicMapProjections.inverseProject(a,b,this._basemap);return{regionId:c.getAreaName(),localX:d.x,localY:d.y}}return null};var DvtThematicMapAutomation=function(a){this._tmap=a};DvtObj.createSubclass(DvtThematicMapAutomation,DvtAutomation,"DvtThematicMapAutomation");
DvtThematicMapAutomation.prototype.GetSubIdForDomElement=function(a){return(a=this._tmap.__getEventManager().GetLogicalObject(a))&&(a instanceof DvtMapAreaPeer||a instanceof DvtMapObjPeer)?this._getSubId(a):null};
DvtThematicMapAutomation.prototype.getDomElementForSubId=function(a){if(a==DvtAutomation.TOOLTIP_SUBID)return this.GetTooltipElement(this._tmap);var b=a.indexOf(":"),c=a.indexOf("[");if(0<b&&0<c){var d=a.substring(0,b),b=a.substring(b+1,c);a=parseInt(a.substring(c+1,a.length-1));return this._getDomElement(d,b,a)}return null};
DvtThematicMapAutomation.prototype.getData=function(a,b,c){return(a=this._getDataObject(a,b,c))?(b={},b.color=a.getDatatipColor(),b.tooltip=a.getShortDesc(),c=a.getLabel(),b.label=c?c.getTextString():null,b.selected=a.isSelected(),b):null};DvtThematicMapAutomation.prototype._getDomElement=function(a,b,c){return(a=this._getDataObject(a,b,c))?a.getDisplayable().getElem():null};
DvtThematicMapAutomation.prototype._getSubId=function(a){for(var b=a.getDisplayable(),c=this._tmap.getAllLayers(),d=0;d<c.length;d++){var e=c[d].getDataLayers(),g;for(g in e)if(b instanceof DvtPath)for(var h=e[g].getAreaObjects(),k=0;k<h.length;k++){if(h[k]===a)return this._getDataLayerId(g)+":area["+k+"]"}else if(b instanceof DvtSimpleMarker||b instanceof DvtImageMarker)for(h=e[g].getDataObjects(),k=0;k<h.length;k++)if(h[k]===a)return this._getDataLayerId(g)+":marker["+k+"]"}return null};
DvtThematicMapAutomation.prototype._getDataObject=function(a,b,c){for(var d=this._tmap.getAllLayers(),e=0;e<d.length;e++){var g=d[e].getDataLayers(),h;for(h in g)if(this._getDataLayerId(h)==a){if("area"==b)return g[h].getDataAreaCollection()[c];if("marker"==b)return g[h].getDataMarkerCollection()[c]}}return null};DvtThematicMapAutomation.prototype._getDataLayerId=function(a){var b=a.lastIndexOf(":");return 0<b?a.substring(b+1):a};var DvtDrillablePath=function(a,b){this.Init(a,b)};
DvtObj.createSubclass(DvtDrillablePath,DvtPath,"DvtDrillablePath");DvtDrillablePath.HOVER_STROKE_WIDTH=2;DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH=1;DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH=4;DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH=6;DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH=2;DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH=4;
DvtDrillablePath.prototype.Init=function(a,b){DvtDrillablePath.superclass.Init.call(this,a);this._disclosedOuterShape=this._disclosedInnerShape=this._disclosedOuterStroke=this._disclosedInnerStroke=null;this._isDrilled=!1;this.Zoom=1;this._bSupportsVectorEffects=b};DvtDrillablePath.prototype.isDrilled=function(){return this._isDrilled};
DvtDrillablePath.prototype.setDrilled=function(a){this._isDrilled!=a&&(this._isDrilled=a,this.isDrilled()?(this._disclosedInnerShape=this.copyShape(),this._disclosedInnerShape.setFill(null),this._disclosedInnerShape.setMouseEnabled(!1),this._disclosedOuterShape=this.copyShape(),this._disclosedOuterShape.setFill(null),this._disclosedOuterShape.setMouseEnabled(!1),a=this.getParent(),a.addChild(this._disclosedOuterShape),a.addChild(this._disclosedInnerShape),this._disclosedInnerShape.setStroke(this._adjustStrokeZoomWidth(this._disclosedInnerStroke,
DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH)),this._disclosedOuterShape.setStroke(this._adjustStrokeZoomWidth(this._disclosedOuterStroke,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH)),this.setMouseEnabled(!1),this.IsShowingHoverEffect=!1):(this.isHoverEffectShown()&&(this.UpdateSelectionEffect(),this.InnerShape.setStroke(this._adjustStrokeZoomWidth(this.HoverInnerStroke,1),DvtDrillablePath.HOVER_STROKE_WIDTH)),this._disclosedOuterShape.getParent().removeChild(this._disclosedOuterShape),this._disclosedInnerShape.getParent().removeChild(this._disclosedInnerShape),
this.setMouseEnabled(!0),this.setAlpha(1)))};
DvtDrillablePath.prototype.setSelected=function(a){this.IsSelected!=a&&(a&&(this.isHoverEffectShown()?(this.CreateSelectedHoverStrokes(),this.SelectedHoverInnerStroke=this._adjustStrokeZoomWidth(this.SelectedHoverInnerStroke,DvtDrillablePath.HOVER_STROKE_WIDTH),this.SelectedHoverOuterStroke=this._adjustStrokeZoomWidth(this.SelectedHoverOuterStroke,DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH)):(this.SelectedInnerStroke=this._adjustStrokeZoomWidth(this.SelectedInnerStroke,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),
this.SelectedOuterStroke=this._adjustStrokeZoomWidth(this.SelectedOuterStroke,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH))),DvtDrillablePath.superclass.setSelected.call(this,a))};
DvtDrillablePath.prototype.showHoverEffect=function(){this.isSelected()?(this.CreateSelectedHoverStrokes(),this.SelectedHoverInnerStroke=this._adjustStrokeZoomWidth(this.SelectedHoverInnerStroke,DvtDrillablePath.HOVER_STROKE_WIDTH),this.SelectedHoverOuterStroke=this._adjustStrokeZoomWidth(this.SelectedHoverOuterStroke,DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH)):this.HoverInnerStroke=this._adjustStrokeZoomWidth(this.HoverInnerStroke,DvtDrillablePath.HOVER_STROKE_WIDTH);DvtDrillablePath.superclass.showHoverEffect.call(this)};
DvtDrillablePath.prototype.CreateSelectedHoverStrokes=function(){this.SelectedHoverInnerStroke||(this.SelectedHoverInnerStroke=this.HoverInnerStroke.clone(),this.SelectedHoverInnerStroke.setWidth(DvtDrillablePath.HOVER_STROKE_WIDTH),this._bSupportsVectorEffects&&this.SelectedHoverInnerStroke.setFixedWidth(!0));this.SelectedHoverOuterStroke||(this.SelectedHoverOuterStroke=this.SelectedOuterStroke.clone(),this.SelectedHoverOuterStroke.setWidth(DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH),this._bSupportsVectorEffects&&
this.SelectedHoverOuterStroke.setFixedWidth(!0))};DvtDrillablePath.prototype.hideHoverEffect=function(){this.isSelected()&&(this.SelectedInnerStroke=this._adjustStrokeZoomWidth(this.SelectedInnerStroke,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),this.SelectedOuterStroke=this._adjustStrokeZoomWidth(this.SelectedOuterStroke,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH));DvtDrillablePath.superclass.hideHoverEffect.call(this)};
DvtDrillablePath.prototype.setHoverStroke=function(a,b){DvtDrillablePath.superclass.setHoverStroke.call(this,a,b);this._bSupportsVectorEffects&&(this.HoverInnerStroke&&this.HoverInnerStroke.setFixedWidth(!0),this.HoverOuterStroke&&this.HoverOuterStroke.setFixedWidth(!0));return this};
DvtDrillablePath.prototype.setSelectedStroke=function(a,b){DvtDrillablePath.superclass.setSelectedStroke.call(this,a,b);this._bSupportsVectorEffects&&(this.SelectedInnerStroke&&this.SelectedInnerStroke.setFixedWidth(!0),this.SelectedOuterStroke&&this.SelectedOuterStroke.setFixedWidth(!0));return this};
DvtDrillablePath.prototype.setSelectedHoverStroke=function(a,b){DvtDrillablePath.superclass.setSelectedHoverStroke.call(this,a,b);this._bSupportsVectorEffects&&(this.SelectedHoverInnerStroke&&this.SelectedHoverInnerStroke.setFixedWidth(!0),this.SelectedHoverOuterStroke&&this.SelectedHoverOuterStroke.setFixedWidth(!0));return this};
DvtDrillablePath.prototype.setDisclosedStroke=function(a,b){(this._disclosedInnerStroke=a)&&this._bSupportsVectorEffects&&this._disclosedInnerStroke.setFixedWidth(!0);(this._disclosedOuterStroke=b)&&this._bSupportsVectorEffects&&this._disclosedOuterStroke.setFixedWidth(!0);return this};DvtDrillablePath.prototype.savePatternFill=function(a){this._ptFill=a};DvtDrillablePath.prototype.getSavedPatternFill=function(){return this._ptFill};
DvtDrillablePath.prototype._updateStrokeZoomWidth=function(a,b){if(!this._bSupportsVectorEffects){var c=a.getStroke();c&&(c=c.clone(),c.setWidth(b/this.Zoom),a.setStroke(c))}};DvtDrillablePath.prototype._adjustStrokeZoomWidth=function(a,b){if(!this._bSupportsVectorEffects){var c=a.clone();c.setWidth(b/this.Zoom);return c}return a};
DvtDrillablePath.prototype.handleZoomEvent=function(a){this.Zoom=a.getA();this.isDrilled()?(this._updateStrokeZoomWidth(this._disclosedInnerShape,DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH),this._updateStrokeZoomWidth(this._disclosedOuterShape,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH)):this.isSelected()?this.isHoverEffectShown()?(this._updateStrokeZoomWidth(this.InnerShape,DvtDrillablePath.HOVER_STROKE_WIDTH),this._updateStrokeZoomWidth(this,DvtDrillablePath.SELECTED_HOVER_OUTER_STROKE_WIDTH)):
(this._updateStrokeZoomWidth(this.InnerShape,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),this._updateStrokeZoomWidth(this,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH)):this.isHoverEffectShown()?this._updateStrokeZoomWidth(this.InnerShape,DvtDrillablePath.HOVER_STROKE_WIDTH):this._updateStrokeZoomWidth(this,1)};var DvtCustomDataItem=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtCustomDataItem,DvtContainer,"DvtCustomDataItem");DvtCustomDataItem._RECT_PADDING=5;
DvtCustomDataItem.prototype.Init=function(a,b,c){DvtCustomDataItem.superclass.Init.call(this,a);this._dataItem=b;b instanceof DvtBaseComponent?(this._width=b.getWidth(),this._height=b.getHeight(),this.addChild(b)):(this.getElem().appendChild(b),b=DvtDisplayableUtils.getDimensionsForced(a,this),this._width=b.w,this._height=b.h);this._boundingRect=new DvtRect(a,-DvtCustomDataItem._RECT_PADDING,-DvtCustomDataItem._RECT_PADDING,this._width+2*DvtCustomDataItem._RECT_PADDING,this._height+2*DvtCustomDataItem._RECT_PADDING);
this._boundingRect.setInvisibleFill();a=new DvtSolidStroke(c.selectedInnerColor,1,2);b=new DvtSolidStroke("rgb(235, 236, 237)",1,4);var d=new DvtSolidStroke(c.selectedInnerColor,1,2),e=new DvtSolidStroke(c.selectedOuterColor,1,4),g=new DvtSolidStroke(c.selectedInnerColor,1,2);c=new DvtSolidStroke(c.selectedOuterColor,1,6);this._boundingRect.setHoverStroke(a,b).setSelectedStroke(d,e).setSelectedHoverStroke(g,c);this.addChildAt(this._boundingRect,0)};
DvtCustomDataItem.prototype.setAriaProperty=function(a,b){DvtAgent.isTouchDevice()?this._boundingRect.setAriaProperty(a,b):DvtCustomDataItem.superclass.setAriaProperty.call(this,a,b)};DvtCustomDataItem.prototype.setAriaRole=function(a){DvtAgent.isTouchDevice()?this._boundingRect.setAriaRole(a):DvtCustomDataItem.superclass.setAriaRole.call(this,a)};DvtCustomDataItem.prototype.getWidth=function(){return this._width};DvtCustomDataItem.prototype.getHeight=function(){return this._height};
DvtCustomDataItem.prototype.setSelectable=function(a){this._boundingRect.setSelectable(a)};DvtCustomDataItem.prototype.isSelectable=function(){return this._boundingRect.isSelectable()};DvtCustomDataItem.prototype.isSelected=function(){return this._boundingRect.isSelected()};DvtCustomDataItem.prototype.setSelected=function(a){this._boundingRect.setSelected(a)};DvtCustomDataItem.prototype.showHoverEffect=function(){this._boundingRect.showHoverEffect()};DvtCustomDataItem.prototype.hideHoverEffect=function(){this._boundingRect.hideHoverEffect()};
DvtCustomDataItem.prototype.getRootElement=function(){return this._dataItem};DvtCustomDataItem.prototype.updateRootElement=function(a){this._dataItem!==a&&(this._dataItem&&(this._dataItem instanceof DvtBaseComponent?this.removeChild(this._dataItem):this.getElem().removeChild(this._dataItem)),a instanceof DvtBaseComponent?this.addChild(a):this.getElem().appendChild(a),this._dataItem=a)};DvtCustomDataItem.prototype.fireKeyboardListener=function(a){this._dataItem instanceof DvtBaseComponent&&this._dataItem.fireKeyboardListener(a)};
var DvtBaseMapManager;this?this.DvtBaseMapManager?DvtBaseMapManager=this.DvtBaseMapManager:(this.DvtBaseMapManager=DvtBaseMapManager={},DvtBaseMapManager._UNPROCESSED_MAPS=[[],[],[]],DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=[[]]):window.DvtBaseMapManager?DvtBaseMapManager=window.DvtBaseMapManager:(DvtBaseMapManager={},window.DvtBaseMapManager=DvtBaseMapManager,DvtBaseMapManager._UNPROCESSED_MAPS=[[],[],[]],DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=[[]]);
DvtObj.createSubclass(DvtBaseMapManager,DvtObj,"DvtBaseMapManager");DvtBaseMapManager.TYPE_LABELS=0;DvtBaseMapManager.TYPE_PATH=1;DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN=2;DvtBaseMapManager.TYPE_LABELINFO=3;DvtBaseMapManager.TYPE_DIM=4;DvtBaseMapManager._INDEX="__index";DvtBaseMapManager._GLOBAL_MAPS={};
DvtBaseMapManager.getBaseMapDim=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c&&(c=c[DvtBaseMapManager.TYPE_DIM])?new DvtRectangle(c[0],c[1],c[2],c[3]):null};DvtBaseMapManager.getAreaLabelInfo=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c?c[DvtBaseMapManager.TYPE_LABELINFO]:null};
DvtBaseMapManager.getAreaNames=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c?c[DvtBaseMapManager.TYPE_LABELS]:null};DvtBaseMapManager.getLongAreaLabel=function(a,b,c){DvtBaseMapManager._processUnprocessedMaps();a=DvtBaseMapManager._GLOBAL_MAPS[a][b];var d;a&&(d=a[DvtBaseMapManager.TYPE_LABELS]);return d&&d[c]?d[c][1]:null};
DvtBaseMapManager.getCityCoordinates=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a];return c&&(c=c.cities)&&(c=c[DvtBaseMapManager.TYPE_PATH][b])?new DvtPoint(c[0],c[1]):null};DvtBaseMapManager.getCityLabel=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a];return c&&(c=c.cities)&&(c=c[DvtBaseMapManager.TYPE_LABELS][b])?c[1]:null};
DvtBaseMapManager.getAreaCenter=function(a,b,c){DvtBaseMapManager._processUnprocessedMaps();var d=DvtBaseMapManager._GLOBAL_MAPS[a];if(d&&(d=d[b])){if((d=d[DvtBaseMapManager.TYPE_LABELINFO])&&d[c])return DvtRectangle.create(d[c][0]).getCenter();a=DvtBaseMapManager._GLOBAL_MAPS[a][b][DvtBaseMapManager.TYPE_PATH][c];if(!a)return null;a=DvtPathUtils.createPathArray(a);return DvtPathUtils.getDimensions(a).getCenter()}return null};
DvtBaseMapManager.getChildLayerName=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b];return c?DvtBaseMapManager._GLOBAL_MAPS[a][DvtBaseMapManager._INDEX][c.__index+1]:null};DvtBaseMapManager.getParentLayerName=function(a,b){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][b]?DvtBaseMapManager._GLOBAL_MAPS[a][DvtBaseMapManager._INDEX][DvtBaseMapManager._GLOBAL_MAPS[a][b].__index-1]:null};
DvtBaseMapManager.getAreaPaths=function(a,b){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][b][DvtBaseMapManager.TYPE_PATH]};DvtBaseMapManager.getPathForArea=function(a,b,c){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][b][DvtBaseMapManager.TYPE_PATH][c]};
DvtBaseMapManager.getChildrenForLayerAreas=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager.getChildLayerName(a,b);return c&&(c=DvtBaseMapManager._GLOBAL_MAPS[a][c][DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN])?c:[]};DvtBaseMapManager.getMapLayerName=function(a,b){DvtBaseMapManager._processUnprocessedMaps();return DvtBaseMapManager._GLOBAL_MAPS[a][DvtBaseMapManager._INDEX][b]};
DvtBaseMapManager.registerBaseMapLayer=function(a,b,c,d,e,g,h,k){var m=DvtBaseMapManager._GLOBAL_MAPS[a];m||(m={},m[DvtBaseMapManager._INDEX]=[],DvtBaseMapManager._GLOBAL_MAPS[a]=m);a=m[b];a||(a={},m[b]=a,null!=h&&(m[DvtBaseMapManager._INDEX][h]=b));a[DvtBaseMapManager.TYPE_LABELS]=c;a[DvtBaseMapManager.TYPE_PATH]=d;a[DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN]=e;a[DvtBaseMapManager.TYPE_LABELINFO]=g;a[DvtBaseMapManager.TYPE_DIM]=k;a[DvtBaseMapManager._INDEX]=h};
DvtBaseMapManager.registerResourceBundle=function(a,b,c){var d=DvtBaseMapManager._GLOBAL_MAPS[a];d||(d={},DvtBaseMapManager._GLOBAL_MAPS[a]=d);a=d[b];a||(a={},d[b]=a);(a=d[b])&&(a[DvtBaseMapManager.TYPE_LABELS]=c)};DvtBaseMapManager.updateResourceBundle=function(a,b,c){if(a=DvtBaseMapManager._GLOBAL_MAPS[a])if(b=a[b])for(var d in c)b[DvtBaseMapManager.TYPE_LABELS][d]=c[d]};
DvtBaseMapManager._processUnprocessedMaps=function(){var a,b,c=DvtBaseMapManager._UNPROCESSED_MAPS;if(c){for(a=0;a<c[0].length;a++)b=c[0][a],DvtBaseMapManager.registerBaseMapLayer(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);for(a=0;a<c[1].length;a++)b=c[1][a],DvtBaseMapManager.registerResourceBundle(b[0],b[1],b[2]);for(a=0;a<c[2].length;a++)b=c[2][a],DvtBaseMapManager.updateResourceBundle(b[0],b[1],b[2]);DvtBaseMapManager._UNPROCESSED_MAPS=[[],[],[]]}if(c=DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES){for(a=
0;a<c[0].length;a++){b=c[0][a];var d=b[1],e=b[2],g=DvtBaseMapManager._GLOBAL_MAPS[b[0]],h;if(g){if(d=g[d])for(d[DvtBaseMapManager.TYPE_PARENTREGION_CHILDREN]=b[3],h=d[DvtBaseMapManager.TYPE_DIM],a=d[DvtBaseMapManager._INDEX],d=g[DvtBaseMapManager._INDEX],d.splice(a,0,e),g[e][DvtBaseMapManager._INDEX]=a,a+=1;a<d.length;a++)(e=g[d[a]])&&e[DvtBaseMapManager._INDEX]++;(d=g[b[2]])&&(d[DvtBaseMapManager.TYPE_DIM]=h)}}DvtBaseMapManager._UNPROCESSED_PARENT_UPDATES=[[]]}};
DvtBaseMapManager.simplifyAreaPaths=function(a,b,c,d,e,g){if(0<g){b=1/(Math.min(d/b,e/c)*g);if(1>=b)return a;c=[];if(a)for(var h in a)d=a[h],isNaN(d)&&(d=DvtPathUtils.createPathArray(a[h])),c[h]=DvtPathUtils.simplifyPath(d,b);return c}return a};DvtBaseMapManager.getLayerIds=function(a,b){DvtBaseMapManager._processUnprocessedMaps();var c=DvtBaseMapManager._GLOBAL_MAPS[a][b],d={};if(c){var c=c[DvtBaseMapManager.TYPE_LABELS],e;for(e in c)d[e]=c[e][1]}return d};
var DvtThematicMapCategoryWrapper=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtThematicMapCategoryWrapper,DvtObj,"DvtThematicMapCategoryWrapper");DvtThematicMapCategoryWrapper.prototype.Init=function(a,b){this._displayable=a;this._category=b};DvtThematicMapCategoryWrapper.prototype.getCategories=function(){return this._category};DvtThematicMapCategoryWrapper.prototype.getDisplayables=function(){return[this._displayable]};
var DvtMapDrillEvent=function(a){this.Init(DvtMapDrillEvent.TYPE);this._drillType=a};DvtObj.createSubclass(DvtMapDrillEvent,DvtBaseComponentEvent,"DvtMapDrillEvent");DvtMapDrillEvent.TYPE="drill";DvtMapDrillEvent.DRILL_UP=0;DvtMapDrillEvent.DRILL_DOWN=1;DvtMapDrillEvent.RESET=2;DvtMapDrillEvent.prototype.getDisclosed=function(){return this._disclosed};DvtMapDrillEvent.prototype.setDisclosed=function(a){this._disclosed=a};DvtMapDrillEvent.prototype.getDrillType=function(){return this._drillType};
var DvtMapActionEvent=function(a,b,c){this.Init(DvtMapActionEvent.TYPE);this._clientId=a;this._rowKey=b;this._action=c};DvtObj.createSubclass(DvtMapActionEvent,DvtBaseComponentEvent,"DvtMapActionEvent");DvtMapActionEvent.TYPE="action";DvtMapActionEvent.prototype.getClientId=function(){return this._clientId};DvtMapActionEvent.prototype.getRowKey=function(){return this._rowKey};DvtMapActionEvent.prototype.getAction=function(){return this._action};
var DvtMapLabel=function(a,b,c,d,e,g){this.Init(a,b,c,d,e,g)};DvtObj.createSubclass(DvtMapLabel,DvtOutputText,"DvtMapLabel");
DvtMapLabel.prototype.Init=function(a,b,c,d,e,g){DvtMapLabel.superclass.Init.call(this,a,b,0,0);this._bSupportsVectorEffects=g;this._boundRectangle=[];this.setMouseEnabled(!1);this.alignCenter();this.alignMiddle();this._center=null;this._labelDisplay=d;this._parentContainer=e;if(c&&(this._boundRectangle.push(DvtRectangle.create(c[0])),1<c.length))for(this._leaderLines=[],b=1;b<c.length;b++)d=c[b],this._boundRectangle.push(DvtRectangle.create(d[0])),d=new DvtPolyline(a,d[1]),d.setPixelHinting(!0),
e=new DvtSolidStroke("#000000"),this._bSupportsVectorEffects&&e.setFixedWidth(!0),d.setStroke(e),this._leaderLines.push(d)};DvtMapLabel.prototype.addBounds=function(a){this._boundRectangle.push(a)};DvtMapLabel.prototype.hasBounds=function(){return 0<this._boundRectangle.length};
DvtMapLabel.prototype.update=function(a){a=a.getA();for(var b=-1,c=DvtTextUtils.guessTextDimensions(this),d=!1,e=0;e<this._boundRectangle.length;e++){var g=this._boundRectangle[e].w*a;if(c.h<=this._boundRectangle[e].h*a)if(c.w<=g){b=e;break}else if(this.getParent()||(d=!0,this._parentContainer.addChild(this)),this.getDimensions().w<=g){b=e;break}}-1==b&&"on"==this._labelDisplay&&(b=this._boundRectangle.length-1);this._currentState!=b?(-1==b?this.reset():(this.getParent()||this._parentContainer.addChild(this),
c=this._boundRectangle[b].getCenter(),this.setCenter(c),this._leaderLines&&(this._parentContainer.removeChild(this._leaderLine),this._leaderLine=null,0<b?(this._leaderLine=this._leaderLines[b-1],this._parentContainer.addChild(this._leaderLine),d=this.getCSSStyle(),d.setStyle(DvtCSSStyle.COLOR,"#000000"),this.setCSSStyle(d),d=this._boundRectangle[b],e=this._leaderLine.getPoints(),g=e.length,d.x>e[g-2]?(this.alignLeft(),this.alignMiddle(),this.setCenter(new DvtPoint(d.x,c.y))):d.y>e[g-1]?(this.alignTop(),
this.alignCenter(),this.setCenter(new DvtPoint(c.x,d.y))):d.x+d.w<e[g-2]?(this.alignRight(),this.alignMiddle(),this.setCenter(new DvtPoint(d.x+d.w,c.y))):d.y+d.h<e[g-1]&&(this.alignBottom(),this.alignCenter(),this.setCenter(new DvtPoint(c.x,d.y+d.h)))):(this.alignCenter(),this.alignMiddle(),d=this.getCSSStyle(),d.setStyle(DvtCSSStyle.COLOR,this._labelColor),this.setCSSStyle(d)))),this._currentState=b):-1==b&&d&&this._parentContainer.removeChild(this);-1!=this._currentState&&(b=new DvtMatrix,b.translate(a*
this._center.x-this._center.x,a*this._center.y-this._center.y),this.setMatrix(b),this._leaderLine&&(this._leaderLine.setMatrix(new DvtMatrix(a,0,0,a)),this._bSupportsVectorEffects||(b=this._leaderLine.getStroke().clone(),b.setWidth(1/a),this._leaderLine.setStroke(b))))};DvtMapLabel.prototype.setCenter=function(a){this._center=a;this.setX(a.x);this.setY(a.y)};DvtMapLabel.prototype.getLeaderLine=function(){return this._leaderLine};DvtMapLabel.prototype.getCenter=function(){return this._center};
DvtMapLabel.prototype.setCSSStyle=function(a){DvtMapLabel.superclass.setCSSStyle.call(this,a);this._labelColor||(this._labelColor=a.getStyle(DvtCSSStyle.COLOR))};DvtMapLabel.prototype.reset=function(){this._parentContainer.removeChild(this);this._currentState=-1;this._leaderLine&&(this._parentContainer.removeChild(this._leaderLine),this._leaderLine=null)};var DvtMapObjPeer=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapObjPeer,DvtObj,"DvtMapObjPeer");
DvtMapObjPeer.ANIMATION_DELETE_PRIORITY=0;DvtMapObjPeer.ANIMATION_UPDATE_PRIORITY=1;DvtMapObjPeer.ANIMATION_INSERT_PRIORITY=2;
DvtMapObjPeer.prototype.Init=function(a,b,c,d,e){this._data=a;this._dataLayer=b;this.Displayable=c;this._isShowingKeyboardFocusEffect=this._isShowingHoverEffect=this._isSelected=!1;this.Displayable.setDataColor&&this.Displayable.setDataColor(a.color);this._label=d;this._center=e;this._zoom=1;this._view=b.getMap();this._data.categories||this._label&&(this._data.categories=[this._label.getTextString()]);c=a.location;"auto"==this._view.getDisplayTooltips()&&c&&(b=b.getMapLayer(),(b=!(b instanceof DvtMapAreaLayer)||
b instanceof DvtMapCustomAreaLayer?DvtBaseMapManager.getCityLabel(this._view.getMapName(),c):DvtBaseMapManager.getLongAreaLabel(this._view.getMapName(),b.getLayerName(),c))&&(this._data.shortDesc=a.shortDesc?b+": "+a.shortDesc:b));this.Displayable&&(a.destination?(this.Displayable.setAriaRole("link"),this.Displayable.setCursor(DvtSelectionEffectUtils.getSelectingCursor()),this._linkCallback=DvtToolkitUtils.getLinkCallback("_blank",a.destination)):this.Displayable.setAriaRole("img"));this.UpdateAriaLabel()};
DvtMapObjPeer.prototype.getId=function(){return this._data.id};DvtMapObjPeer.prototype.getClientId=function(){return this._data.clientId};DvtMapObjPeer.prototype.getLocation=function(){return this._data.location};DvtMapObjPeer.prototype.getCenter=function(){return this._center};DvtMapObjPeer.prototype.setCenter=function(a){this._center=a;this.__recenter()};DvtMapObjPeer.prototype.getDisplayable=function(){return this.Displayable};DvtMapObjPeer.prototype.getLabel=function(){return this._label};
DvtMapObjPeer.prototype.getDataLayer=function(){return this._dataLayer};DvtMapObjPeer.prototype.hasAction=function(){return null!=this.getAction()};DvtMapObjPeer.prototype.getAction=function(){return this._data.action};DvtMapObjPeer.prototype.setVisible=function(a){this.Displayable.setVisible(a);this._label&&this._label.setVisible(a)};DvtMapObjPeer.prototype.getShortDesc=function(){return this._data.shortDesc};DvtMapObjPeer.prototype.removeLabel=function(){this._label=null};
DvtMapObjPeer.prototype.getSize=function(){return this.Displayable.getWidth?this.Displayable.getWidth()*this.Displayable.getHeight():0};DvtMapObjPeer.prototype.getCategories=function(){return this._data.categories};DvtMapObjPeer.prototype.getDatatip=function(){if("none"!=this._view.getDisplayTooltips()){var a=this._view.getOptions().tooltip;return a?this._view.getCtx().getTooltipManager().getCustomTooltip(a,this.getDataContext()):this.getShortDesc()}return null};
DvtMapObjPeer.prototype.getDataContext=function(){return{id:this.getId(),label:this._label?this._label.getTextString():null,color:this.getDatatipColor(),location:this.getLocation(),x:this._data.x,y:this._data.y}};DvtMapObjPeer.prototype.getLinkCallback=function(){return this._linkCallback};DvtMapObjPeer.prototype.getDatatipColor=function(){return this._data.color?this._data.color:"#000000"};
DvtMapObjPeer.prototype.getAriaLabel=function(){var a=[];this.isSelectable()&&a.push(DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,this.isSelected()?"STATE_SELECTED":"STATE_UNSELECTED"));return DvtDisplayable.generateAriaLabel(this.getShortDesc(),a)};DvtMapObjPeer.prototype.getDisplayables=function(){return[this.getDisplayable()]};DvtMapObjPeer.prototype.UpdateAriaLabel=function(){if(!DvtAgent.deferAriaCreation()){var a=this.getAriaLabel();a&&this.Displayable.setAriaProperty("label",a)}};
DvtMapObjPeer.prototype.setSelectable=function(a){this.Displayable.setSelectable&&this.Displayable.setSelectable(a)};DvtMapObjPeer.prototype.isSelectable=function(){return this.Displayable.isSelectable?this.Displayable.isSelectable():!1};DvtMapObjPeer.prototype.isSelected=function(){return this._isSelected};
DvtMapObjPeer.prototype.setSelected=function(a){if(this.isSelectable()){var b=this._getState();this._isSelected=a;this._dataLayer.getOptions().selectionRenderer?this._callCustomRenderer(this._dataLayer.getOptions().selectionRenderer,this._getState(),b):this.processDefaultSelectionEffect(a);this.UpdateAriaLabel()}};
DvtMapObjPeer.prototype.showHoverEffect=function(){var a=this._getState();this._isShowingHoverEffect=!0;this._dataLayer.getOptions().hoverRenderer?this._callCustomRenderer(this._dataLayer.getOptions().hoverRenderer,this._getState(),a):this.processDefaultHoverEffect(!0)};
DvtMapObjPeer.prototype.hideHoverEffect=function(){var a=this._getState();this._isShowingHoverEffect=!1;this._dataLayer.getOptions().hoverRenderer?this._callCustomRenderer(this._dataLayer.getOptions().hoverRenderer,this._getState(),a):this.processDefaultHoverEffect(!1)};DvtMapObjPeer.prototype.setShowPopupBehaviors=function(a){this._showPopupBehaviors=a};DvtMapObjPeer.prototype.getShowPopupBehaviors=function(){return this._showPopupBehaviors};
DvtMapObjPeer.prototype.isDragAvailable=function(a){for(var b=this._dataLayer.getClientId(),c=0;c<a.length&&a[c]!=b;c++);return b};DvtMapObjPeer.prototype.getDragTransferable=function(a,b){return this._dataLayer.__getDragTransferable(this)};DvtMapObjPeer.prototype.getDragFeedback=function(a,b){return this._dataLayer.__getDragFeedback()};
DvtMapObjPeer.prototype.getNextNavigable=function(a){return a.type==DvtMouseEvent.CLICK?this:a.keyCode==DvtKeyboardEvent.SPACE&&a.ctrlKey?this:DvtKeyboardHandler.getNextAdjacentNavigable(this,a,this.GetNavigables())};DvtMapObjPeer.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableObjects()};
DvtMapObjPeer.prototype.getKeyboardBoundingBox=function(a){return this.Displayable.getParent()?this.Displayable instanceof DvtCustomDataItem?this.Displayable.getDimensions(a?a:this.Displayable.getCtx().getStage()):this.Displayable.getDimensions(a):new DvtRectangle(0,0,0,0)};DvtMapObjPeer.prototype.getTargetElem=function(){return this.Displayable.getElem()};
DvtMapObjPeer.prototype.showKeyboardFocusEffect=function(){var a=this._getState();this._isShowingKeyboardFocusEffect=!0;this._dataLayer.getOptions().focusRenderer?this._callCustomRenderer(this._dataLayer.getOptions().focusRenderer,this._getState(),a):this.processDefaultFocusEffect(!0)};
DvtMapObjPeer.prototype.hideKeyboardFocusEffect=function(){if(this.isShowingKeyboardFocusEffect()){var a=this._getState();this._isShowingKeyboardFocusEffect=!1;this._dataLayer.getOptions().focusRenderer?this._callCustomRenderer(this._dataLayer.getOptions().focusRenderer,this._getState(),a):this.processDefaultFocusEffect(!1)}};DvtMapObjPeer.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect};
DvtMapObjPeer.prototype.HandleZoomEvent=function(a){this.Displayable.getParent()&&(this._zoom=a.getA(),this.__recenter())};
DvtMapObjPeer.prototype.positionLabel=function(){if(this._label){this._label.alignCenter();var a=this.Displayable.getCx()*this._zoom,b=this.Displayable.getCy()*this._zoom,c=this.Displayable.getHeight(),d=this.Displayable instanceof DvtSimpleMarker?this.Displayable.getType():"image",e=this._data.labelPosition;"top"==e?(b=b-c/2-4,this._label.alignBottom()):"bottom"==e?(b+=c/2,this._label.alignTop()):(b=d==DvtSimpleMarker.TRIANGLE_UP?b+c/6:d==DvtSimpleMarker.TRIANGLE_DOWN?b-c/6:b,this._label.alignMiddle());
this._label.setX(a).setY(b)}};
DvtMapObjPeer.prototype.__recenter=function(){var a=this.Displayable.getWidth(),b=this.Displayable.getHeight();if(null!=a&&null!=b&&this.Displayable.getParent()){var c=0,d=this._center.x,c=this._center.y;this.Displayable.getRotation&&(c=this.Displayable.getRotation(),d=this._center.x*Math.cos(c)-this._center.y*Math.sin(c),c=this._center.x*Math.sin(c)+this._center.y*Math.cos(c));d=this._center.x*this._zoom-d;c=this._center.y*this._zoom-c;this.Displayable instanceof DvtCustomDataItem&&(d+=this._center.x-
a/2,c+=this._center.y-b/2);this.Displayable.setTranslate(d,c);DvtAgent.workaroundFirefoxRepaint(this.Displayable);this.positionLabel()}};
DvtMapObjPeer.prototype.animateUpdate=function(a,b){var c=new DvtCustomAnimation(this._view.getCtx(),this.Displayable,this.getDataLayer().getAnimationDuration()),d=b.getDisplayable();if(this.Displayable.getFill){var e=d.getFill(),g=this.Displayable.getFill();g instanceof DvtSolidFill&&(g.getColor()!=e.getColor()||g.getAlpha()!=e.getAlpha())&&(this.Displayable.setFill(e),b.getLabel()&&this._label&&(e=this._label.getFill(),this._label.setFill(b.getLabel().getFill().clone()),c.getAnimator().addProp(DvtAnimator.TYPE_FILL,
this._label,this._label.getFill,this._label.setFill,e)),c.getAnimator().addProp(DvtAnimator.TYPE_FILL,this.Displayable,this.Displayable.getFill,this.Displayable.setFill,g))}this.Displayable.getCenterDimensions&&(g=b.getDisplayable().getCenterDimensions(),e=this.Displayable.getCenterDimensions(),g.x!=e.x||g.y!=e.y||g.w!=e.w||g.h!=e.h)&&(this.Displayable.setCenterDimensions(g),c.getAnimator().addProp(DvtAnimator.TYPE_RECTANGLE,this.Displayable,this.Displayable.getCenterDimensions,this.Displayable.setCenterDimensions,
e));g=d.getRotation();e=this.Displayable.getRotation();if(g!=e){var h=g-e;h>Math.PI?g-=2*Math.PI:h<-Math.PI&&(g+=2*Math.PI);this.Displayable.setRotation(g);c.getAnimator().addProp(DvtAnimator.TYPE_NUMBER,this.Displayable,this.Displayable.getRotation,this.Displayable.setRotation,e)}var h=b.getCenter(),k=this.getCenter();h&&k&&(h.x!=k.x||h.y!=k.y||g!=e)&&(this.setCenter(new DvtPoint(h.x,h.y)),c.getAnimator().addProp(DvtAnimator.TYPE_POINT,this,this.getCenter,this.setCenter,new DvtPoint(k.x,k.y)));this._label&&
b.getLabel()?(g=b.getLabel().getX(),e=this._label.getX(),g!=e&&(this._label.setX(g),c.getAnimator().addProp(DvtAnimator.TYPE_NUMBER,this._label,this._label.getX,this._label.setX,e)),g=b.getLabel().getY(),e=this._label.getY(),g!=e&&(this._label.setY(g),c.getAnimator().addProp(DvtAnimator.TYPE_NUMBER,this._label,this._label.getY,this._label.setY,e)),b.getLabel().setAlpha(0)):b.getLabel()&&b.getLabel().setAlpha(0);d.setAlpha(0);a.add(c,DvtMapObjPeer.ANIMATION_UPDATE_PRIORITY)};
DvtMapObjPeer.prototype.animateDelete=function(a,b){var c=[this.Displayable],d=this.getLabel();d&&c.push(d);c=new DvtAnimFadeOut(this._view.getCtx(),c,this.getDataLayer().getAnimationDuration());a.add(c,DvtMapObjPeer.ANIMATION_DELETE_PRIORITY)};DvtMapObjPeer.prototype.animateInsert=function(a){var b=[this.Displayable];this.Displayable.setAlpha(0);var c=this.getLabel();c&&(c.setAlpha(0),b.push(c));b=new DvtAnimFadeIn(this._view.getCtx(),b,this.getDataLayer().getAnimationDuration());a.add(b,DvtMapObjPeer.ANIMATION_INSERT_PRIORITY)};
DvtMapObjPeer.prototype.processDefaultSelectionEffect=function(a){this.Displayable.setSelected&&this.Displayable.setSelected(a)};DvtMapObjPeer.prototype.processDefaultFocusEffect=function(a){this.processDefaultHoverEffect(a)};DvtMapObjPeer.prototype.processDefaultHoverEffect=function(a){a?this.Displayable.showHoverEffect&&this.Displayable.showHoverEffect():this.Displayable.hideHoverEffect&&!this.isShowingKeyboardFocusEffect()&&this.Displayable.hideHoverEffect()};
DvtMapObjPeer.prototype._callCustomRenderer=function(a,b,c){if(this.Displayable instanceof DvtCustomDataItem){var d=this._view.getOptions()._contextHandler;if(d){var e=this.Displayable.getRootElement();b=d(this.Displayable.getElem(),e,this._data,b,c);a=a(b);this.Displayable.updateRootElement(a)}}};DvtMapObjPeer.prototype.IsHoverEffectShown=function(){return this._isShowingHoverEffect};
DvtMapObjPeer.prototype._getState=function(){return{hovered:this.IsHoverEffectShown(),selected:this.isSelected(),focused:this.isShowingKeyboardFocusEffect()}};var DvtMapAreaPeer=function(a,b,c,d){this.Init(a,b,c,d)};DvtObj.createSubclass(DvtMapAreaPeer,DvtMapObjPeer,"DvtMapAreaPeer");DvtMapAreaPeer.prototype.Init=function(a,b,c,d){DvtMapAreaPeer.superclass.Init.call(this,a,b,c,d)};DvtMapAreaPeer.prototype.setAreaLayer=function(a){this._dataAreaLayer=a};
DvtMapAreaPeer.prototype.setSelected=function(a){this.isSelectable()&&(a&&!this.IsHoverEffectShown()&&this._dataAreaLayer.addChild(this.Displayable),DvtMapAreaPeer.superclass.setSelected.call(this,a))};DvtMapAreaPeer.prototype.showHoverEffect=function(){this._dataAreaLayer.addChild(this.Displayable);DvtMapAreaPeer.superclass.showHoverEffect.call(this)};
DvtMapAreaPeer.prototype.hideHoverEffect=function(){this.isSelected()?this._dataAreaLayer.addChild(this.Displayable):this._dataAreaLayer.addChildAt(this.Displayable,0);DvtMapAreaPeer.superclass.hideHoverEffect.call(this)};DvtMapAreaPeer.prototype.isDrilled=function(){return this.Displayable.isDrilled()};DvtMapAreaPeer.prototype.setDrilled=function(a){a?this._dataAreaLayer.addChild(this.Displayable):this._dataAreaLayer.addChildAt(this.Displayable,0);this.Displayable.setDrilled(a)};
DvtMapAreaPeer.prototype.HandleZoomEvent=function(a){DvtMapAreaPeer.superclass.HandleZoomEvent.call(this,a);this.Displayable.getParent()&&(this.Displayable.handleZoomEvent(a),this.isDrilled()||this.positionLabel(a))};DvtMapAreaPeer.prototype.positionLabel=function(a){this.getLabel()&&this.getLabel().update(a)};DvtMapAreaPeer.prototype.GetNavigables=function(){return this.getDataLayer().getMap().getNavigableAreas()};
DvtMapAreaPeer.prototype.animateUpdate=function(a,b){DvtMapAreaPeer.superclass.animateUpdate.call(this,a,b);this.getDataLayer().getMapLayer().setAreaRendered(this.getLocation(),!1)};DvtMapAreaPeer.prototype.__recenter=function(){};var DvtMapArea=function(a,b,c,d){this.Init(a,b,c,d)};DvtObj.createSubclass(DvtMapArea,DvtContainer,"DvtMapArea");DvtMapArea._DEFAULT_STROKE_WIDTH=1;
DvtMapArea.prototype.Init=function(a,b,c,d){DvtMapArea.superclass.Init.call(this,a);this._isSelected=this._bSelectable=!1;this._areaName=c;this._shape=b;this.addChild(this._shape);this._bSupportsVectorEffects=d;if(a=b.getStroke())this._areaStrokeWidth=a.getWidth()};DvtMapArea.prototype.getAreaName=function(){return this._areaName};DvtMapArea.prototype.getTooltip=function(){return this._tooltip};DvtMapArea.prototype.setTooltip=function(a){this._tooltip=a};
DvtMapArea.prototype.getStroke=function(){return this._shape instanceof DvtShape?this._shape.getStroke():null};DvtMapArea.prototype.setStroke=function(a){this._shape instanceof DvtShape&&this._shape.setStroke(a)};DvtMapArea.prototype.setFill=function(a){this._shape instanceof DvtShape&&this._shape.setFill(a)};DvtMapArea.prototype.getFill=function(){return this._shape instanceof DvtShape?this._shape.getFill():null};
DvtMapArea.prototype.getCmds=function(){return this._shape instanceof DvtPath?this._shape.getCmds():null};DvtMapArea.prototype.setCmds=function(a){this._shape instanceof DvtPath&&this._shape.setCmds(a)};DvtMapArea.prototype.setSrc=function(a){this._shape instanceof DvtImage&&this._shape.setSrc(a)};DvtMapArea.prototype.getDropSiteFeedback=function(){return this._shape.copyShape()};DvtMapArea.prototype.contains=function(a,b){var c=this.getDimensions();return a>=c.x&&a<=c.x+c.w&&b>=c.y&&b<=c.y+c.h};
DvtMapArea.prototype.HandleZoomEvent=function(a){if(!this._bSupportsVectorEffects&&this._shape&&this._areaStrokeWidth){var b=this._shape.getStroke().clone();b.setWidth(this._areaStrokeWidth/a.getA());this._shape.setStroke(b)}};var DvtMapLayer=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtMapLayer,DvtObj,"DvtMapLayer");DvtMapLayer.prototype.Init=function(a,b,c){this._tmap=a;this.LayerName=b;this.EventHandler=c;this.DataLayers={};this.PzcMatrix=new DvtMatrix};
DvtMapLayer.prototype.addDataLayer=function(a){this.DataLayers[a.getClientId()]=a};DvtMapLayer.prototype.PreDataLayerUpdate=function(){};DvtMapLayer.prototype.PostDataLayerUpdate=function(){};
DvtMapLayer.prototype.updateDataLayer=function(a,b,c){this._animation&&this._animation.stop(!0);this.PzcMatrix=b;this._oldDataLayer=this.getDataLayer(a.getClientId());this.addDataLayer(a);a.render(this.PzcMatrix);a.HandleZoomEvent(new DvtZoomEvent(DvtZoomEvent.SUBTYPE_ZOOMED),this.PzcMatrix);if(this._oldDataLayer){c=a.getAnimation();var d=a.getAnimationDuration();if("auto"==c)b=new DvtDataAnimationHandler(this._tmap.getCtx()),b.constructAnimation(this._oldDataLayer.getAllObjects(),a.getAllObjects()),
this._animation=b.getAnimation();else if(DvtBlackBoxAnimationHandler.isSupported(c)){this._removeAnimRect=!0;var e=new DvtRectangle(0,0,this._tmap.getWidth(),this._tmap.getHeight()),g=this._oldDataLayer.getNonScaledContainers();for(b=0;b<g.length;b++){var h=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.getWidth(),this._tmap.getHeight());h.setFill(null);g[b].addChild(h)}var k=a.getNonScaledContainers();for(b=0;b<k.length;b++)h=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.getWidth(),this._tmap.getHeight()),
h.setFill(null),k[b].addChild(h);e=DvtBlackBoxAnimationHandler.getCombinedAnimation(this._tmap.getCtx(),c,g,k,e,d);g=new DvtRectangle(0,0,this._tmap.getWidth()/this.PzcMatrix.getA(),this._tmap.getHeight()/this.PzcMatrix.getA());k=this._oldDataLayer.getScaledContainers();for(b=0;b<k.length;b++)h=new DvtRect(this._tmap.getCtx(),0,0,this._tmap.getWidth()/this.PzcMatrix.getA(),this._tmap.getHeight()/this.PzcMatrix.getA()),h.setFill(null),k[b].addChild(h);var m=a.getScaledContainers();for(b=0;b<m.length;b++)h=
new DvtRect(this._tmap.getCtx(),0,0,this._tmap.getWidth()/this.PzcMatrix.getA(),this._tmap.getHeight()/this.PzcMatrix.getA()),h.setFill(null),m[b].addChild(h);b=DvtBlackBoxAnimationHandler.getCombinedAnimation(this._tmap.getCtx(),c,k,m,g,d);this._animation=new DvtParallelPlayable(this._tmap.getCtx(),[e,b])}else for(c=this._oldDataLayer.getContainers(),b=0;b<c.length;b++)c[b].getParent().removeChild(c[b]);this.PreDataLayerUpdate();if(this._animation){this.EventHandler.removeListeners(this._callbackObj);
var n=this;this._animation.setOnEnd(function(){n.OnAnimationEnd(a)},this);this._animation.play()}}else this.PostDataLayerUpdate(),this._tmap.OnUpdateLayerEnd()};DvtMapLayer.prototype.getDataLayers=function(){return this.DataLayers};DvtMapLayer.prototype.getDataLayer=function(a){return this.DataLayers?this.DataLayers[a]:null};DvtMapLayer.prototype.getLayerName=function(){return this.LayerName};DvtMapLayer.prototype.render=function(a){this.PzcMatrix=a;for(var b in this.DataLayers)this.DataLayers[b].render(a)};
DvtMapLayer.prototype.reset=function(a,b){for(var c in this.DataLayers)this.DataLayers[c].reset(a,b)};DvtMapLayer.prototype.HandleZoomEvent=function(a,b){this.PzcMatrix=b;for(var c in this.DataLayers)this.DataLayers[c].HandleZoomEvent(a,b)};DvtMapLayer.prototype.HandlePanEvent=function(a){this.PzcMatrix=a;for(var b in this.DataLayers)this.DataLayers[b].HandlePanEvent(a)};
DvtMapLayer.prototype.OnAnimationEnd=function(a){if(this._oldDataLayer)for(var b=this._oldDataLayer.getContainers(),c=0;c<b.length;c++){var d=b[c].getParent();d&&d.removeChild(b[c])}if(this._removeAnimRect){this._removeAnimRect=!1;b=a.getNonScaledContainers();for(c=0;c<b.length;c++)b[c].removeChildAt(b[c].getNumChildren()-1);a=a.getScaledContainers();for(c=0;c<a.length;c++)a[c].removeChildAt(a[c].getNumChildren()-1)}this.PostDataLayerUpdate();this._tmap.OnUpdateLayerEnd();this._animation=null;this.EventHandler.addListeners(this._callbackObj)};
var DvtMapAreaLayer=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapAreaLayer,DvtMapLayer,"DvtMapAreaLayer");DvtMapAreaLayer._SHORT_NAME=0;DvtMapAreaLayer._LONG_NAME=1;
DvtMapAreaLayer.prototype.Init=function(a,b,c,d,e){DvtMapAreaLayer.superclass.Init.call(this,a,b,e);this._labelDisplay=c;this._labelType=d;this._areaLabels={};this.Areas={};this.AreaShapes={};this._labelInfo=this.AreaNames=null;this._disclosed=[];this._renderArea={};this._renderLabel={};this._renderedLabels={};this.AreaContainer=new DvtContainer(this._tmap.getCtx());this.LabelContainer=new DvtContainer(this._tmap.getCtx());this._tmap.getAreaLayerContainer().addChildAt(this.AreaContainer,0);this._tmap.getLabelContainer().addChildAt(this.LabelContainer,
0);this._dropTarget=new DvtThematicMapDropTarget(this,this._tmap.getMapName())};DvtMapAreaLayer.prototype.setAnimation=function(a){this._animType=a};DvtMapAreaLayer.prototype.getAnimation=function(){return this._animType};DvtMapAreaLayer.prototype.setAnimationDuration=function(a){this._animDur=a};DvtMapAreaLayer.prototype.getAnimationDuration=function(){return this._animDur};DvtMapAreaLayer.prototype.getDropTarget=function(){return this._dropTarget};DvtMapAreaLayer.prototype.getLabelType=function(){return this._labelType};
DvtMapAreaLayer.prototype.setAreaShapes=function(a){this.AreaShapes=a};DvtMapAreaLayer.prototype.setAreaNames=function(a){this.AreaNames=a;for(var b in this.AreaNames)this.setAreaRendered(b,!0),this.setLabelRendered(b,!0)};DvtMapAreaLayer.prototype.getShortAreaName=function(a){return this.AreaNames[a][DvtMapAreaLayer._SHORT_NAME]};DvtMapAreaLayer.prototype.getLongAreaName=function(a){return this.AreaNames[a][DvtMapAreaLayer._LONG_NAME]};
DvtMapAreaLayer.prototype.setAreaLabelInfo=function(a){this._labelInfo=a};DvtMapAreaLayer.prototype.getLabelInfoForArea=function(a){return this._labelInfo?this._labelInfo[a]:null};DvtMapAreaLayer.prototype.setAreaChildren=function(a){this._children=a};DvtMapAreaLayer.prototype.getChildrenForArea=function(a){return this._children[a]?this._children[a].split(","):[]};DvtMapAreaLayer.prototype.getArea=function(a){return this.Areas[a]};DvtMapAreaLayer.prototype.getAreaShape=function(a){return this.AreaShapes[a]};
DvtMapAreaLayer.prototype.getLabelDisplay=function(){return this._labelDisplay};DvtMapAreaLayer.prototype.setDropSiteCSSStyle=function(a){this._dropSiteCSSStyle=a};DvtMapAreaLayer.prototype.setLayerCSSStyle=function(a){this._layerCSSStyle=a};DvtMapAreaLayer.prototype.getLayerCSSStyle=function(){return new DvtCSSStyle(this._layerCSSStyle)};DvtMapAreaLayer.prototype.setAreaRendered=function(a,b){this._renderArea[a]=b};DvtMapAreaLayer.prototype.setLabelRendered=function(a,b){this._renderLabel[a]=b};
DvtMapAreaLayer.prototype.setIsolatedArea=function(a){this._isolatedArea=a;this._layerDim=null;for(var b in this.AreaShapes)b!=a&&(this._renderArea[b]=!1)};DvtMapAreaLayer.prototype.getIsolatedArea=function(){return this._isolatedArea};
DvtMapAreaLayer.prototype.getLayerDim=function(){if(!this._layerDim)if(this._isolatedArea)this._layerDim=DvtPathUtils.getDimensions(DvtPathUtils.createPathArray(DvtBaseMapManager.getPathForArea(this._tmap.getMapName(),this.LayerName,this._isolatedArea)));else if("world"!=this._tmap.getMapName()&&"worldRegions"!=this._tmap.getMapName()&&(this._layerDim=DvtBaseMapManager.getBaseMapDim(this._tmap.getMapName(),this.LayerName)),!this._layerDim){var a=this.AreaContainer.getDimensions().getUnion(this._tmap.getDataAreaContainer().getDimensions());
0<a.w&&0<a.h&&(this._layerDim=a)}return this._layerDim};
DvtMapAreaLayer.prototype._createAreaAndLabel=function(a,b){var c=this.AreaShapes[a];if(c){!b&&this.Areas[a]||this.updateAreaShape(a);if(!this.Areas[a]){var d=this._tmap.getCtx(),d=new DvtMapArea(d,c,a,this._tmap.supportsVectorEffects());this.Areas[a]=d;this.EventHandler.associate(c,d);d.setTooltip(this.AreaNames&&this.AreaNames[a]?this.AreaNames[a][DvtMapAreaLayer._LONG_NAME]:null)}this._renderLabel[a]&&(d=this._areaLabels[a],!d&&"off"!=this._labelDisplay&&this.AreaNames&&(d="short"==this._labelType?
this.AreaNames[a][DvtMapAreaLayer._SHORT_NAME]:this.AreaNames[a][DvtMapAreaLayer._LONG_NAME]))&&(this._labelInfo&&this._labelInfo[a]?d=new DvtMapLabel(this._tmap.getCtx(),d,this._labelInfo[a],this._labelDisplay,this.LabelContainer,this._tmap.supportsVectorEffects()):(c=DvtDisplayableUtils.getDimensionsForced(this._tmap.getCtx(),c),d=new DvtMapLabel(this._tmap.getCtx(),d,[[c.x,c.y,c.w,c.h]],this._labelDisplay,this.LabelContainer,this._tmap.supportsVectorEffects())),this._areaLabels[a]=d,this._layerCSSStyle&&
d.setCSSStyle(this._layerCSSStyle))}};DvtMapAreaLayer.prototype._addAreaAndLabel=function(a,b){if(this.AreaShapes[a]){this.AreaContainer.addChild(this.Areas[a]);var c=this._areaLabels[a];c&&(this._renderLabel[a]?c.update(this.PzcMatrix):c.reset(),this._renderedLabels[a]=this._renderLabel[a]);b&&(b.push(this.Areas[a]),c&&(b.push(c),b.push(c.getLeaderLine())))}};
DvtMapAreaLayer.prototype.updateAreaShape=function(a){if(!this._paths||this._bUpdateShapesForRender){this._bUpdateShapesForRender=!1;var b;this._paths=(b="world"==this._tmap.getMapName()||"worldRegions"==this._tmap.getMapName()?DvtBaseMapManager.getBaseMapDim(this._tmap.getMapName(),this.LayerName):this.getLayerDim())?DvtBaseMapManager.simplifyAreaPaths(DvtBaseMapManager.getAreaPaths(this._tmap.getMapName(),this.LayerName),b.w,b.h,this._tmap.getWidth(),this._tmap.getHeight(),this._tmap.getMaxZoomFactor()):
DvtBaseMapManager.getAreaPaths(this._tmap.getMapName(),this.LayerName)}b=this._paths[a];this.AreaShapes[a]&&b?this.AreaShapes[a].setCmds(b):delete this.AreaShapes[a]};DvtMapAreaLayer.prototype.resetRenderedAreas=function(){for(var a in this.AreaNames)this.setAreaRendered(a,!0),this.setLabelRendered(a,!0)};
DvtMapAreaLayer.prototype.updateDataLayer=function(a,b,c){DvtMapAreaLayer.superclass.updateDataLayer.call(this,a,b,c);if(c==this.getLayerName())for(var d in this.AreaShapes)this._createAreaAndLabel(d,!0),this._renderArea[d]&&this._addAreaAndLabel(d)};DvtMapAreaLayer.prototype.render=function(a){this._bUpdateShapesForRender=!0;for(var b in this.AreaShapes)this._createAreaAndLabel(b,!0),this._renderArea[b]&&this._addAreaAndLabel(b);DvtMapAreaLayer.superclass.render.call(this,a)};
DvtMapAreaLayer.prototype.PreDataLayerUpdate=function(){for(var a in this._renderArea)this._renderArea[a]||(this._createAreaAndLabel(a,!1),this._addAreaAndLabel(a))};DvtMapAreaLayer.prototype.PostDataLayerUpdate=function(){for(var a in this._renderArea)if(!this._renderArea[a]){this.AreaContainer.removeChild(this.Areas[a]);var b=this._areaLabels[a];b&&(this._renderedLabels[a]=!1,this.LabelContainer.removeChild(b),(b=b.getLeaderLine())&&this.LabelContainer.removeChild(b))}};
DvtMapAreaLayer.prototype._renderSelectedAreasAndLabels=function(a,b){for(var c=0;c<a.length;c++)this._createAreaAndLabel(a[c],!1),this._renderArea[a[c]]&&this._addAreaAndLabel(a[c],b)};DvtMapAreaLayer.prototype.discloseAreas=function(a,b){this._renderSelectedAreasAndLabels(a,b);for(var c in this.DataLayers)this.DataLayers[c].discloseAreas(a,b,this.PzcMatrix);this._disclosed=this._disclosed.concat(a)};
DvtMapAreaLayer.prototype.undiscloseAreas=function(a,b){for(var c in this.DataLayers)this.DataLayers[c].undiscloseAreas(a,b);c=this._tmap.getDrillChildLayer(this.LayerName);for(var d=0;d<a.length;d++){var e=a[d];if(this.Areas[e]){var g=DvtArrayUtils.getIndex(this._disclosed,e);-1!==g&&(this._disclosed.splice(g,1),b.push(this.Areas[e]))}c&&c.undiscloseAreas(this.getChildrenForArea(e),b)}};
DvtMapAreaLayer.prototype.reset=function(a,b){DvtMapAreaLayer.superclass.reset.call(this,a,b);"none"!=this._tmap.getDrillMode()&&(this.undiscloseAreas(this._disclosed,a),this._disclosed=[])};DvtMapAreaLayer.prototype.__getObjectUnderPoint=function(a,b){for(var c in this.Areas)if(this.Areas[c].contains(a,b))return this.Areas[c];return null};
DvtMapAreaLayer.prototype.__showDropSiteFeedback=function(a){this._dropSiteFeedback&&(this.AreaContainer.removeChild(this._dropSiteFeedback),this._dropSiteFeedback=null);a&&(this._dropSiteFeedback=a.getDropSiteFeedback())&&(this._dropSiteFeedback.setFill(new DvtSolidFill(this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BACKGROUND_COLOR))),a=this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_WIDTH)?this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_WIDTH).substring(0,this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_WIDTH).indexOf("px")):
1,this._tmap.supportsVectorEffects()||(a/=this.PzcMatrix.getA()),a=new DvtSolidStroke(this._dropSiteCSSStyle.getStyle(DvtCSSStyle.BORDER_COLOR),1,a),this._tmap.supportsVectorEffects()&&a.setFixedWidth(!0),this._dropSiteFeedback.setStroke(a),this.AreaContainer.addChild(this._dropSiteFeedback));return this._dropSiteFeedback};
DvtMapAreaLayer.prototype.HandleZoomEvent=function(a,b){DvtMapAreaLayer.superclass.HandleZoomEvent.call(this,a,b);if(!this._tmap.supportsVectorEffects())for(var c in this.Areas)this.Areas[c].HandleZoomEvent(b);for(c in this._renderedLabels)if(this._renderedLabels[c]){var d=this._areaLabels[c];d&&d.update(b)}};var DvtMapCustomAreaLayer=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapCustomAreaLayer,DvtMapAreaLayer,"DvtMapCustomAreaLayer");
DvtMapCustomAreaLayer.prototype.Init=function(a,b,c,d,e){DvtMapCustomAreaLayer.superclass.Init.call(this,a,b,c,d,e)};DvtMapCustomAreaLayer.prototype.updateAreaShape=function(a){};DvtMapCustomAreaLayer.prototype.getLayerDim=function(){return new DvtRectangle(0,0,this._layerWidth,this._layerHeight)};
DvtMapCustomAreaLayer.prototype._selectImageBasedOnResolution=function(){for(var a=this._tmap.getWidth(),b=this._tmap.getHeight(),c=this._areaLayerImages,d=0;d<c.length;d++){var e=c[d],g=e.source,h=e.width,e=e.height;if(g&&-1<g.search(".svg")||h>=a&&e>=b||d==c.length-1)return g}};
DvtMapCustomAreaLayer.prototype.setAreaLayerImage=function(a){var b=null,c=DvtAgent.isRightToLeft(this._tmap.getCtx());if(a&&0<a.length){var b=a[0].width,d=a[0].height;this._layerWidth=b;this._layerHeight=d;for(var e=[],g=0;g<a.length;g++)c&&"rtl"==a[g].dir?e.push(a[g]):c||"ltr"!=a[g].dir||e.push(a[g]);this._areaLayerImages=0<e.length?e:a;this._imageSrc=this._selectImageBasedOnResolution();b=new DvtImage(this._tmap.getCtx(),this._imageSrc,0,0,b,d)}b&&(this.setAreaNames({image:[null,null]}),this.setAreaShapes({image:b}))};
DvtMapCustomAreaLayer.prototype.HandleZoomEvent=function(a,b){DvtMapCustomAreaLayer.superclass.HandleZoomEvent.call(this,a,b);if(this.Areas.image){var c=this._selectImageBasedOnResolution();c!=this._imageSrc&&(this._imageSrc=c,this.Areas.image.setSrc(this._imageSrc))}};var DvtMapDataLayer=function(a,b,c,d,e){this.Init(a,b,c,d,e)};DvtObj.createSubclass(DvtMapDataLayer,DvtObj,"DvtMapDataLayer");
DvtMapDataLayer.prototype.Init=function(a,b,c,d,e){this._tmap=a;this._clientId=c;this._options=e;this._areaObjs=[];this._dataObjs=[];this._dataAreaCollection=[];this._dataMarkerCollection=[];this._eventHandler=d;this._dragSource=new DvtDragSource(a.getCtx());this._eventHandler.setDragSource(this._dragSource);this._dataAreaLayer=new DvtContainer(this._tmap.getCtx());this._dataPointLayer=new DvtContainer(this._tmap.getCtx());this._dataLabelLayer=new DvtContainer(this._tmap.getCtx());this._tmap.getDataAreaContainer().addChildAt(this._dataAreaLayer,
0);this._tmap.getDataPointContainer().addChildAt(this._dataPointLayer,0);this._tmap.getLabelContainer().addChildAt(this._dataLabelLayer,0);this._parentLayer=b;this._disclosed=[];this._drilled=[]};DvtMapDataLayer.prototype.getOptions=function(){return this._options};DvtMapDataLayer.prototype.getDragSource=function(){return this._dragSource};DvtMapDataLayer.prototype.getContainers=function(){return[this._dataAreaLayer,this._dataPointLayer,this._dataLabelLayer]};
DvtMapDataLayer.prototype.getScaledContainers=function(){return[this._dataAreaLayer]};DvtMapDataLayer.prototype.getNonScaledContainers=function(){var a=[this._dataLabelLayer];this._tmap.isMarkerZoomBehaviorFixed()&&a.push(this._dataPointLayer);return a};DvtMapDataLayer.prototype.getDataLabelContainer=function(){return this._dataLabelLayer};DvtMapDataLayer.prototype.getMapLayer=function(){return this._parentLayer};DvtMapDataLayer.prototype.getMap=function(){return this._tmap};
DvtMapDataLayer.prototype.getAllObjects=function(){return this._dataObjs.concat(this._areaObjs)};DvtMapDataLayer.prototype.getAreaObjects=function(){return this._areaObjs};DvtMapDataLayer.prototype.getDataObjects=function(){return this._dataObjs};DvtMapDataLayer.prototype.getNavigableAreaObjects=function(){for(var a=[],b=0;b<this._areaObjs.length;b++)this._areaObjs[b].isDrilled()||a.push(this._areaObjs[b]);return a};
DvtMapDataLayer.prototype.getNavigableDisclosedAreaObjects=function(){for(var a=[],b=0;b<this._areaObjs.length;b++)for(var c=0;c<this._disclosed.length;c++)this._areaObjs[b].getLocation()==this._disclosed[c]&&(this._areaObjs[b].isDrilled()||a.push(this._areaObjs[b]));return a};DvtMapDataLayer.prototype.addDataObject=function(a){this._dataMarkerCollection.push(a);a&&(this._dataObjs.push(a),this._eventHandler.associate(a.getDisplayable(),a))};
DvtMapDataLayer.prototype.addAreaObject=function(a){this._dataAreaCollection.push(a);a&&(this._areaObjs.push(a),this._eventHandler.associate(a.getDisplayable(),a),a.setAreaLayer(this._dataAreaLayer))};DvtMapDataLayer.prototype.getDataAreaCollection=function(){return this._dataAreaCollection};DvtMapDataLayer.prototype.getDataMarkerCollection=function(){return this._dataMarkerCollection};
DvtMapDataLayer.prototype._removeAreaObject=function(a){a=this._areaObjs.indexOf(a);-1!==a&&this._areaObjs.splice(a,1)};DvtMapDataLayer.prototype.getClientId=function(){return this._clientId};DvtMapDataLayer.prototype.setAnimation=function(a){this._animType=a};DvtMapDataLayer.prototype.getAnimation=function(){return this._animType};DvtMapDataLayer.prototype.setAnimationDuration=function(a){this._animDur=a};DvtMapDataLayer.prototype.getAnimationDuration=function(){return this._animDur};
DvtMapDataLayer.prototype.setSelectionMode=function(a){if(this._selectionMode=a)this._selectionHandler=new DvtSelectionHandler(this._selectionMode),this._eventHandler.setSelectionHandler(this._clientId,this._selectionHandler)};DvtMapDataLayer.prototype.isSelectable=function(){return null!=this._selectionMode};DvtMapDataLayer.prototype.setIsolatedAreaRowKey=function(a){this._isolatedAreaRowKey=a};
DvtMapDataLayer.prototype._updateAreaShape=function(a){var b=a.getDisplayable(),c=this._parentLayer.getAreaShape(a.getLocation());if(c)return b.setCmds(c.getCmds()),!0;this._removeAreaObject(a);return!1};DvtMapDataLayer.prototype._renderAreaAndLabel=function(a){if(this._updateAreaShape(this._areaObjs[a])){var b=this._areaObjs[a].getDisplayable();this._dataAreaLayer.addChild(b);if(a=this._areaObjs[a].getLabel())a.hasBounds()||(b=b.getDimensions(),a.addBounds(b)),a.update(this._pzcMatrix);return!0}return!1};
DvtMapDataLayer.prototype.render=function(a){this._bFixPatterns=!0;this._pzcMatrix=a;a={};var b=this._dataObjs.slice();b.sort(function(a,b){return a.getSize()<b.getSize()?1:a.getSize()>b.getSize()?-1:0});for(var c=0;c<b.length;c++){var d=b[c],e=d.getDisplayable(),g=d.getLabel();if(g){var h=new DvtContainer(e.getCtx());this._dataPointLayer.addChild(h);h.addChild(e);h.addChild(g);d.positionLabel()}else this._dataPointLayer.addChild(e);(d=d.getLocation())&&(a[d]=!0)}for(c=0;c<this._areaObjs.length;c++)a[this._areaObjs[c].getLocation()]&&
this._areaObjs[c].removeLabel(),this._renderAreaAndLabel(c)||c--;this._initSelections&&this._processInitialSelections()};
DvtMapDataLayer.prototype.discloseAreas=function(a,b,c){this._pzcMatrix=c;for(var d=[],e=0;e<a.length;e++)for(var g=0;g<this._areaObjs.length;g++)if(this._areaObjs[g].getLocation()==a[e]){d.push(this._areaObjs[g].getLocation());this._renderAreaAndLabel(g);var h=this._areaObjs[g].getDisplayable();b.push(h);h.handleZoomEvent(c);if(g=this._areaObjs[g].getLabel())b.push(g),(g=g.getLeaderLine())&&b.push(g);break}for(g=0;g<this._dataObjs.length;g++)for(e=0;e<a.length;e++)c=this._dataObjs[g].getLocation(),
h=this._dataObjs[g].getDisplayable(),null!=c?c==a[e]&&(this._dataPointLayer.addChild(h),b.push(h)):(this._dataPointLayer.addChild(h),b.push(h));this._disclosed=this._disclosed.concat(d)};
DvtMapDataLayer.prototype.undiscloseAreas=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<this._areaObjs.length;d++)if(this._areaObjs[d].getLocation()==a[c]){this._areaObjs[d].isDrilled()&&this._areaObjs[d].setDrilled(!1);this._areaObjs[d].isSelected()&&this._selectionHandler.removeFromSelection(this._areaObjs[d]);var e=DvtArrayUtils.getIndex(this._disclosed,a[c]);-1<e&&(this._disclosed.splice(e,1),b.push(this._areaObjs[d].getDisplayable()),d=this._areaObjs[d].getLabel())&&(b.push(d),b.push(d.getLeaderLine()));
break}};DvtMapDataLayer.prototype.drill=function(a,b){for(var c=0;c<this._areaObjs.length;c++)if(this._areaObjs[c].getLocation()==a){this._areaObjs[c].setDrilled(!0);this._drilled.push(a);b.push(this._areaObjs[c].getDisplayable());if(c=this._areaObjs[c].getLabel())b.push(c),(c=c.getLeaderLine())&&b.push(c);break}for(c=0;c<this._dataObjs.length;c++)if(this._dataObjs[c].getLocation()==a){b.push(this._dataObjs[c].getDisplayable());break}};
DvtMapDataLayer.prototype.undrill=function(a,b){for(var c=0;c<this._areaObjs.length;c++)if(this._areaObjs[c].getLocation()==a){var d=DvtArrayUtils.getIndex(this._drilled,a);this._drilled.splice(d,1);this._areaObjs[c].setDrilled(!1);d=this._areaObjs[c].getDisplayable();this._dataAreaLayer.addChild(d);b.push(d);if(c=this._areaObjs[c].getLabel())c.update(this._pzcMatrix),b.push(c),b.push(c.getLeaderLine());break}for(c=0;c<this._dataObjs.length;c++)if(this._dataObjs[c].getLocation()==a){d=this._dataObjs[c].getDisplayable();
this._dataPointLayer.addChild(d);b.push(d);break}};
DvtMapDataLayer.prototype.reset=function(a,b){if(this._selectionHandler)for(var c=this._selectionHandler.getSelection(),d=0;d<c.length;d++)(!b||b&&-1==DvtArrayUtils.getIndex(b,c[d].getLocation()))&&this._selectionHandler.removeFromSelection(c[d]);if("none"!=this._tmap.getDrillMode())for(c=0;c<this._drilled.length;c++){for(d=0;d<this._areaObjs.length;d++)if(this._areaObjs[d].getLocation()==this._drilled[c]){this._areaObjs[d].setDrilled(!1);var e=this._areaObjs[d].getDisplayable();this._dataAreaLayer.addChild(e);
a.push(e);if(d=this._areaObjs[d].getLabel())d.update(this._pzcMatrix),a.push(d),a.push(d.getLeaderLine());break}for(d=0;d<this._dataObjs.length;d++)if(this._dataObjs[d].getLocation()==this._drilled[c]){e=this._dataObjs[d].getDisplayable();this._dataPointLayer.addChild(e);a.push(e);break}}this._drilled=[]};
DvtMapDataLayer.prototype.HandleZoomEvent=function(a,b){this._pzcMatrix=b;var c=b.getA(),d=a.getSubType();if(this._bFixPatterns&&d==DvtZoomEvent.SUBTYPE_ZOOMED)for(this._bFixPatterns=!1,d=0;d<this._areaObjs.length;d++){var e=this._areaObjs[d].getDisplayable(),g=e.getSavedPatternFill();if(g){var h=new DvtPatternFill;g.mergeProps(h);h.setMatrix(new DvtMatrix(1/c,null,null,1/c));e.setFill(h)}}d=this.getAreaObjects();for(c=0;c<d.length;c++)d[c].HandleZoomEvent(b);if(this._tmap.isMarkerZoomBehaviorFixed())for(d=
this.getDataObjects(),c=0;c<d.length;c++)d[c].HandleZoomEvent(b)};DvtMapDataLayer.prototype.HandlePanEvent=function(a){this._pzcMatrix=a};DvtMapDataLayer.prototype.setInitialSelections=function(a){this._initSelections=a};DvtMapDataLayer.prototype._processInitialSelections=function(){this._selectionHandler&&(this._selectionHandler.processInitialSelections(this._initSelections,this.getAllObjects()),this._initSelections=null)};
DvtMapDataLayer.prototype.__getDragTransferable=function(a){if(this._selectionHandler){a.isSelected()||(this._selectionHandler.processClick(a,!1),this._eventHandler.fireSelectionEvent(a));a=[];for(var b=this._selectionHandler.getSelection(),c=0;c<b.length;c++)a.push(b[c].getId());return a}return null};DvtMapDataLayer.prototype.__getDragFeedback=function(){for(var a=[],b=this._selectionHandler.getSelection(),c=0;c<b.length;c++)a.push(b[c].getDisplayable());return a};
DvtMapDataLayer.prototype.getSelectedAreas=function(a){for(var b=[],c=this.getAreaObjects(),d=0;d<a.length;d++)for(var e=0;e<c.length;e++)if(c[e].getId()==a[d]){b.push(c[e].getLocation());break}return b};var DvtThematicMapKeyboardHandler=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtThematicMapKeyboardHandler,DvtPanZoomCanvasKeyboardHandler,"DvtThematicMapKeyboardHandler");
DvtThematicMapKeyboardHandler.prototype.Init=function(a,b){DvtThematicMapKeyboardHandler.superclass.Init.call(this,a,b);this._tmap=a};DvtThematicMapKeyboardHandler.prototype.isSelectionEvent=function(a){return this.isNavigationEvent(a)&&!a.ctrlKey};
DvtThematicMapKeyboardHandler.prototype.processKeyDown=function(a){var b=a.keyCode;if(b==DvtKeyboardEvent.CLOSE_BRACKET){var b=this._eventManager.getFocus(),c=this._tmap.getNavigableObjects();b instanceof DvtMapAreaPeer&&0<c.length&&(b=DvtKeyboardHandler.getNextAdjacentNavigable(b,a,c));this._eventManager.SetClickInfo(b)}else b==DvtKeyboardEvent.OPEN_BRACKET?(b=this._eventManager.getFocus(),c=this._tmap.getNavigableAreas(),!(b instanceof DvtMapAreaPeer)&&0<c.length&&(b=DvtKeyboardHandler.getNextAdjacentNavigable(b,
a,c)),this._eventManager.SetClickInfo(b)):(b=DvtThematicMapKeyboardHandler.superclass.processKeyDown.call(this,a),this.isNavigationEvent(a)&&!a.ctrlKey&&this._eventManager.SetClickInfo(b));return b};DvtThematicMapKeyboardHandler.prototype.isMultiSelectEvent=function(a){return a.keyCode==DvtKeyboardEvent.SPACE&&a.ctrlKey};
DvtThematicMapKeyboardHandler.prototype.isNavigationEvent=function(a){var b=DvtThematicMapKeyboardHandler.superclass.isNavigationEvent.call(this,a);b||(a=a.keyCode,a!=DvtKeyboardEvent.OPEN_BRACKET&&a!=DvtKeyboardEvent.CLOSE_BRACKET)||(b=!0);return b};var DvtThematicMapEventManager=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtThematicMapEventManager,DvtEventManager,"DvtThematicMapEventManager");
DvtThematicMapEventManager.prototype.Init=function(a,b,c){DvtThematicMapEventManager.superclass.Init.call(this,a,b,c);this._selectionHandlers={};this._tmap=c;this._bPassOnEvent=!1};DvtThematicMapEventManager.prototype.getSelectionHandler=function(a){if(a&&a.getDataLayer)return a=a.getDataLayer().getClientId(),this._selectionHandlers[a]};DvtThematicMapEventManager.prototype.setSelectionHandler=function(a,b){this._selectionHandlers[a]=b};
DvtThematicMapEventManager.prototype.setDrillMode=function(a){this._drillMode=a};DvtThematicMapEventManager.prototype.removeFromSelection=function(a,b){var c=this._selectionHandlers[a];c&&c.removeFromSelection(b)};DvtThematicMapEventManager.prototype.clearSelection=function(a){(a=this._selectionHandlers[a])&&a.clearSelection()};DvtThematicMapEventManager.prototype.setInitialFocus=function(a){a&&DvtThematicMapEventManager.superclass.setFocus.call(this,a)};
DvtThematicMapEventManager.prototype.OnMouseOver=function(a){var b=this.GetLogicalObject(a.target);b&&b.getShowPopupBehaviors&&b.getDataLayer&&this._tmap.setEventClientId(b.getDataLayer().getClientId());DvtThematicMapEventManager.superclass.OnMouseOver.call(this,a)};DvtThematicMapEventManager.prototype.OnMouseOut=function(a){this._tmap.setEventClientId(null);DvtThematicMapEventManager.superclass.OnMouseOut.call(this,a)};
DvtThematicMapEventManager.prototype.OnClick=function(a){var b=this.GetLogicalObject(a.target);this.SetClickInfo(b);if(!(b&&b.isSelectable&&b.isSelectable()))for(var c in this._selectionHandlers)if(this._selectionHandlers[c].processClick(null,a.ctrlKey)){var d=new DvtSelectionEvent([]);d.addParam("clientId",c);this._callback.call(this._callbackObj,d)}DvtThematicMapEventManager.superclass.OnClick.call(this,a);this._handleClick(b,a.pageX,a.pageY)};
DvtThematicMapEventManager.prototype._handleClick=function(a,b,c){if(a instanceof DvtMapObjPeer){var d=a.getLinkCallback();d?d.call():a.hasAction()?this.HandleAction(a,b,c):a.getShowPopupBehaviors()&&this._tmap.setEventClientId(a.getDataLayer().getClientId())}};
DvtThematicMapEventManager.prototype.HandleAction=function(a,b,c){var d=new DvtMapActionEvent(a.getClientId(),a.getId(),a.getAction());d.addParam("clientId",a.getDataLayer().getClientId());null!=b&&null!=c&&(a=this._tmap.getCtx().pageToStageCoords(b,c),d.addParam("pointXY",{x:a.x,y:a.y}));this.hideTooltip();this._callback.call(this._callbackObj,d)};
DvtThematicMapEventManager.prototype.SetClickInfo=function(a){var b=null,c=null,d=null;a&&(a instanceof DvtMapObjPeer?d=a.getDisplayable():a instanceof DvtMapArea&&(d=a),a.getDataLayer&&(a=a.getDataLayer(),b=a.getClientId(),c=a.getMapLayer().getLayerName()));this._tmap.setClickInfo(b,c,d)};
DvtThematicMapEventManager.prototype.OnDblClickInternal=function(a){a=this.GetLogicalObject(a.target);this.getSelectionHandler(a)&&this._drillMode&&"none"!=this._drillMode&&(a=new DvtMapDrillEvent(DvtMapDrillEvent.DRILL_DOWN),this._callback.call(this._callbackObj,a))};
DvtThematicMapEventManager.prototype.ProcessKeyboardEvent=function(a){var b=!0,c=a.keyCode,d=this.getFocus(),e=d.getDisplayable();c!=DvtKeyboardEvent.TAB&&this._bPassOnEvent?(e.fireKeyboardListener(a),a.preventDefault()):(c==DvtKeyboardEvent.ZERO||c==DvtKeyboardEvent.NUMPAD_ZERO)&&a.ctrlKey&&a.shiftKey?(this._tmap.resetMap(),a.preventDefault()):c==DvtKeyboardEvent.BACK_SLASH?((d=this._tmap.getLegendPanel())&&(d instanceof DvtCollapsiblePanel?d.setCollapsed(!d.isCollapsed()):d instanceof DvtPanelDrawer&&
d.setDisclosed(!d.isDisclosed())),a.preventDefault()):c==DvtKeyboardEvent.ENTER?d instanceof DvtMapObjPeer&&((c=d.getLinkCallback())?c.call():d.hasAction()?this.HandleAction(d):a.shiftKey?this._tmap.drillUp():this._tmap.drillDown(),a.preventDefault()):c==DvtKeyboardEvent.SPACE&&a.ctrlKey?(this.SetClickInfo(d),this.ProcessSelectionEventHelper(d,!0),a.preventDefault()):c!=DvtKeyboardEvent.ZERO&&c!=DvtKeyboardEvent.NUMPAD_ZERO||!a.ctrlKey?c==DvtKeyboardEvent.TAB&&e instanceof DvtCustomDataItem?!a.shiftKey&&
d.isShowingKeyboardFocusEffect()?(d.hideKeyboardFocusEffect(),e.fireKeyboardListener(a),a.preventDefault(),this._bPassOnEvent=!0):(a.shiftKey&&this._bPassOnEvent?(this.ShowFocusEffect(a,d),a.preventDefault()):(this._bPassOnEvent&&d.showKeyboardFocusEffect(),b=DvtThematicMapEventManager.superclass.ProcessKeyboardEvent.call(this,a)),this._bPassOnEvent=!1):b=DvtThematicMapEventManager.superclass.ProcessKeyboardEvent.call(this,a):(a.altKey?this._tmap.fitRegion(e):this._tmap.fitSelectedRegions(),a.preventDefault());
return b};
DvtThematicMapEventManager.prototype.OnComponentTouchClick=function(a){if(!this.GetEventInfo(a,DvtPanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY)){var b=this.GetLogicalObject(a.target);this.SetClickInfo(b);if(b instanceof DvtThematicMap)for(var c in this._selectionHandlers)if(this._selectionHandlers[c].processClick(null,a.ctrlKey)){for(var d=this._selectionHandlers[c].getSelection(),e=[],g=0;g<d.length;g++)e.push(d[g].getId());d=new DvtSelectionEvent(e);this._callback.call(this._callbackObj,d)}DvtThematicMapEventManager.superclass.OnComponentTouchClick.call(this,
a);this._handleClick(b,a.touch.pageX,a.touch.pageY)}};DvtThematicMapEventManager.prototype.HandleTouchHoverStartInternal=function(a){(a=this.GetLogicalObject(a.target))&&a.getShowPopupBehaviors&&a.getDataLayer?this._tmap.setEventClientId(a.getDataLayer().getClientId()):this._tmap.setEventClientId(null)};
DvtThematicMapEventManager.prototype.HandleTouchHoverOverInternal=function(a){(a=this.GetLogicalObject(a.target))&&a.getShowPopupBehaviors&&a.getDataLayer?this._tmap.setEventClientId(a.getDataLayer().getClientId()):this._tmap.setEventClientId(null)};
DvtThematicMapEventManager.prototype.HandleTouchDblClickInternal=function(a){var b=this.GetLogicalObject(a.target);b&&this.getSelectionHandler(b)&&this._drillMode&&"none"!=this._drillMode&&(this.ProcessSelectionEventHelper(b,a.ctrlKey),a=new DvtMapDrillEvent(DvtMapDrillEvent.DRILL_DOWN),this._callback.call(this._callbackObj,a))};
DvtThematicMapEventManager.prototype.HandleTouchActionsEnd=function(a,b){var c=this.GetLogicalObject(a.target);this.SetClickInfo(c);DvtThematicMapEventManager.superclass.HandleTouchActionsEnd.call(this,a,b)};
DvtThematicMapEventManager.prototype.ProcessRolloverEvent=function(a,b,c){a=this._tmap.getOptions();"dim"==a.hoverBehavior&&(b=b.getCategories?b.getCategories():[],a.highlightedCategories=c?b.slice():null,c=new DvtCategoryRolloverEvent(c?DvtCategoryRolloverEvent.TYPE_OVER:DvtCategoryRolloverEvent.TYPE_OUT,a.highlightedCategories),b=DvtStyleUtils.getTimeMilliseconds(a.styleDefaults.hoverBehaviorDelay),this.RolloverHandler.processEvent(c,this._tmap.getNavigableAreas().concat(this._tmap.getNavigableObjects()),
b,"any"==a.highlightMatch))};DvtThematicMapEventManager.prototype.GetTouchResponse=function(){var a=this._tmap.getOptions();return"none"!==a.panning||"none"!==a.zooming?DvtEventManager.TOUCH_RESPONSE_TOUCH_HOLD:a.touchResponse===DvtEventManager.TOUCH_RESPONSE_TOUCH_START?DvtEventManager.TOUCH_RESPONSE_TOUCH_START:DvtEventManager.TOUCH_RESPONSE_AUTO};
DvtThematicMapEventManager.prototype.StoreInfoByEventType=function(a){return a==DvtPanZoomCanvasEventManager.EVENT_INFO_PANNED_KEY?!1:DvtThematicMapEventManager.superclass.StoreInfoByEventType.call(this,a)};var DvtThematicMapJsonParser=function(a){this.Init(a)};DvtObj.createSubclass(DvtThematicMapJsonParser,DvtObj,"DvtThematicMapJsonParser");
DvtThematicMapJsonParser.prototype.Init=function(a){this._tmap=a;this._isCustomBasemap=!1;this._areaLayerStyle=null;this._isMobile=DvtAgent.isTouchDevice();this._customAreaLayerImages={};this._customMarkerDefs={}};
DvtThematicMapJsonParser.prototype.parse=function(a){this._parseMapProperties(a);a._legend&&this._tmap.setLegendData(a._legend);this._parseStyles(a.styleDefaults);if(this._isCustomBasemap&&a.sourceXml){var b=(new DvtXmlParser(this._tmap.getCtx())).parse(a.sourceXml);this._parseCustomBasemap(b)}this._parseAreaLayers(a.areaLayers);this.ParseDataLayers(a.pointDataLayers,null,null,!1)};
DvtThematicMapJsonParser.prototype._parseMapProperties=function(a){var b=a.animationDuration;"string"==typeof b?"ms"==b.slice(-2)?b=parseInt(b.slice(0,-2))/1E3:"s"==b.slice(-1)&&(b=parseFloat(b.slice(0,-1))):b/=1E3;this._tmap.setAnimationDuration(b);this._tmap.setAnimationOnDisplay("auto"==a.animationOnDisplay?"alphaFade":a.animationOnDisplay);this._tmap.setAnimationOnMapChange("auto"==a.animationOnMapChange?"alphaFade":a.animationOnMapChange);this._isCustomBasemap=null!=a.source;this._tmap.setMapName(this._isCustomBasemap?
"$"+a.basemap:a.basemap);this._tmap.setFeaturesOff(a.featuresOff);this._tmap.setControlPanelBehavior(a.controlPanelBehavior);b=a.tooltipDisplay;"shortDesc"==b?b="shortDescOnly":"labelAndShortDesc"==b&&(b="auto");this._tmap.setDisplayTooltips(b);(b=a.popups)&&this._tmap.setShowPopupBehaviors(this._getShowPopupBehaviors(b));this._tmap.setDrillMode(a.drilling);this._tmap.setAnimationOnDrill(a.animationOnDrill);this._tmap.setInitialZooming("auto"==a.initialZooming);this._tmap.setMarkerZoomBehavior(a.markerZoomBehavior);
this._tmap.setPanning("auto"==a.panning);this._tmap.setZooming("auto"==a.zooming);this._tmap.setInitialCenterX(a.panX);this._tmap.setInitialCenterY(a.panY);this._tmap.setInitialZoom(a.zoom);isNaN(a.maxZoom)||this._tmap.setMaxZoomFactor(Math.max(a.maxZoom,1))};
DvtThematicMapJsonParser.prototype._parseAreaLayers=function(a){for(var b=this._tmap.getMapName(),c=0;c<a.length;c++){var d=this._tmap.Defaults.calcAreaLayerOptions(a[c]),e=d.layer;if(e){var g;d.areaStyle&&this._areaLayerStyle.parseInlineStyle(d.areaStyle);d.labelStyle&&this._areaLayerStyle.parseInlineStyle(d.labelStyle);if(this._isCustomBasemap)g=new DvtMapCustomAreaLayer(this._tmap,e,d.labelDisplay,d.labelType,this._tmap.__getEventManager()),g.setAreaLayerImage(this._customAreaLayerImages[e]);else{g=
new DvtMapAreaLayer(this._tmap,e,d.labelDisplay,d.labelType,this._tmap.__getEventManager());var h=DvtBaseMapManager.getAreaNames(b,e);g.setAreaShapes(this._createPathShapes(h));g.setAreaNames(h);g.setAreaLabelInfo(DvtBaseMapManager.getAreaLabelInfo(b,e));g.setAreaChildren(DvtBaseMapManager.getChildrenForLayerAreas(this._tmap.getMapName(),e))}g.setLayerCSSStyle(this._areaLayerStyle);g.setDropSiteCSSStyle(this._areaDropSiteStyle);g.setAnimation("auto"==d.animationOnLayerChange?"alphaFade":d.animationOnLayerChange);
g.setAnimationDuration(this._tmap.getAnimationDuration());this._tmap.addLayer(g);d.areaDataLayer&&this.ParseDataLayers([d.areaDataLayer],g,null,!0);d.pointDataLayers&&this.ParseDataLayers(d.pointDataLayers,g,null,!1)}}};
DvtThematicMapJsonParser.prototype.ParseDataLayers=function(a,b,c,d){if(a)for(var e=0;e<a.length;e++){var g=this._tmap.Defaults.calcDataLayerOptions(a[e]);if(g.markerDefs){var h=g.markerDefs,k;for(k in h)if(!this._customMarkerDefs[k]){var m=(new DvtXmlParser(this._tmap.getCtx())).parse(h[k]);this._customMarkerDefs[k]=DvtMarkerUtils.createMarkerDef(this._tmap.getCtx(),m)}}g.legend&&this._tmap.setLegendData(g.legend);b?b instanceof DvtMapAreaLayer&&d&&b.resetRenderedAreas():(b=new DvtMapLayer(this._tmap,
g.id,this._tmap.__getEventManager()),this._tmap.addPointLayer(b));h=new DvtMapDataLayer(this._tmap,b,g.id,this._tmap.__getEventManager(),g);d=g.selectionMode;"single"==d?h.setSelectionMode(DvtSelectionHandler.TYPE_SINGLE):"multiple"==d&&h.setSelectionMode(DvtSelectionHandler.TYPE_MULTIPLE);h.setAnimation(g.animationOnDataChange);h.setAnimationDuration(this._tmap.getAnimationDuration());var n=null;b instanceof DvtMapAreaLayer&&(n=g.isolatedItem);var t=g.disclosedItems,m=[],u;d=b instanceof DvtMapAreaLayer;
var v;g.popups&&(v=this._getShowPopupBehaviors(g.popups));var w=this._tmap.getOptions().hiddenCategories,x=g.areas;if(x)for(var y=0;y<x.length;y++)if(w&&DvtArrayUtils.hasAnyItem(w,x[y].categories))h.addAreaObject(null);else{var z=x[y].location;if(n)if(n!=x[y].id)continue;else u=z;t&&-1!=t.indexOf(x[y].id)&&m.push(z);z=this._createArea(b,h,x[y]);v&&z.setShowPopupBehaviors(v);z&&(z.setSelectable(h.isSelectable()),h.addAreaObject(z))}var x=g.renderer,A=g.markers;if(A&&!x)for(y=0;y<A.length;y++)if(w&&
DvtArrayUtils.hasAnyItem(w,A[y].categories))h.addDataObject(null);else{z=A[y].location;if(n)if(n!=A[y].id)continue;else u=z;z=this._createMarker(b,h,A[y],d);v&&z.setShowPopupBehaviors(v);z&&(z.setSelectable(h.isSelectable()),h.addDataObject(z))}if(w=g.images)for(y=0;y<w.length;y++){z=w[y].location;if(n)if(n!=w[y].id)continue;else u=z;z=this._createImage(b,h,w[y],d);v&&z.setShowPopupBehaviors(v);z&&h.addDataObject(z)}if(x)for(y=0;y<A.length;y++){z=A[y].location;if(n)if(n!=A[y].id)continue;else u=z;
t&&-1!=t.indexOf(A[y].id)&&m.push(z);w=this._tmap.getOptions()._contextHandler(this._tmap.getElem(),null,A[y],{hovered:!1,selected:!1,focused:!1},null);w=x(w);z=this._createCustomDataItem(b,h,A[y],w,d);v&&z.setShowPopupBehaviors(v);z&&(z.setSelectable(h.isSelectable()),h.addDataObject(z))}u&&(h.setIsolatedAreaRowKey(n),b.setIsolatedArea(u));(g=g.selection)&&0<g.length&&h.setInitialSelections(g);m&&0<m.length&&this._tmap.addDrilledLayer(b.getLayerName(),[h.getClientId(),m]);c?b.updateDataLayer(h,this._tmap.getPanZoomCanvas().getContentPane().getMatrix(),
c):b.addDataLayer(h)}};DvtThematicMapJsonParser.prototype._parseStyles=function(a){this._tmap.parseComponentJson(a);this._areaLayerStyle=new DvtCSSStyle(a.areaStyle);this._areaLayerStyle.parseInlineStyle(a.labelStyle);this._areaDropSiteStyle=new DvtCSSStyle(a.dropTargetStyle);this._tmap.setStyleDefaults(a)};DvtThematicMapJsonParser.prototype._parseCustomBasemap=function(a){a=a.getChildNodes();for(var b,c,d=0;d<a.length;d++)b=a[d],c=b.getName(),"layer"==c?this._parseCustomLayer(b):"points"==c&&this._parseCustomPoints(b)};
DvtThematicMapJsonParser.prototype._parseCustomLayer=function(a){var b=a.getChildNodes();a=a.getAttr("id");for(var c,d,e=[],g=0;g<b.length;g++)if(c=b[g],d=c.getName(),"image"==d){d={};d.source=c.getAttr("source");d.width=c.getAttr("width");d.height=c.getAttr("height");var h=c.getAttr("bidi");c=c.getAttr("dir");d.dir="true"==h||"rtl"==c?"rtl":"ltr";e.push(d)}this._customAreaLayerImages[a]=e};
DvtThematicMapJsonParser.prototype._parseCustomPoints=function(a){a=a.getChildNodes();for(var b,c,d={},e={},g=0;g<a.length;g++)b=a[g],c=b.getName(),"point"==c&&(d[b.getAttr("name")]=[b.getAttr("x"),b.getAttr("y")],e[b.getAttr("name")]=[null,b.getAttr("longLabel")]);DvtBaseMapManager.registerBaseMapLayer(this._tmap.getMapName(),"cities",e,d,null,null,1)};
DvtThematicMapJsonParser.prototype._createPathShapes=function(a){var b={},c=this._tmap.getCtx(),d;for(d in a)b[d]=new DvtPath(c),(a=this._areaLayerStyle.getStyle(DvtCSSStyle.BORDER_COLOR))&&"transparent"!=a&&(a=new DvtSolidStroke(a),this._tmap.supportsVectorEffects()&&a.setFixedWidth(!0),b[d].setStroke(a)),a=this._areaLayerStyle.getStyle(DvtCSSStyle.BACKGROUND_COLOR),"transparent"!=a?b[d].setSolidFill(a):b[d].setFill(null);return b};
DvtThematicMapJsonParser.prototype._createArea=function(a,b,c){var d=c.location;if(a.getAreaShape(d)&&c.color){a.setAreaRendered(d,!1);d=this._tmap.getCtx();d=new DvtDrillablePath(d,this._tmap.supportsVectorEffects());c=DvtJSONUtils.merge(c,this._tmap.getStyleDefaults().dataAreaDefaults);c.labelStyle||(c.labelStyle=this._tmap.getStyleDefaults().labelStyle);var e=new DvtSolidStroke(c.hoverColor,1,DvtDrillablePath.HOVER_STROKE_WIDTH),g=new DvtSolidStroke(c.selectedInnerColor,1,DvtDrillablePath.SELECTED_INNER_STROKE_WIDTH),
h=new DvtSolidStroke(c.selectedOuterColor,1,DvtDrillablePath.SELECTED_OUTER_STROKE_WIDTH);d.setHoverStroke(e,null).setSelectedStroke(g,h);e=new DvtSolidStroke(c.drilledInnerColor,1,DvtDrillablePath.DISCLOSED_INNER_STROKE_WIDTH);g=new DvtSolidStroke(c.drilledOuterColor,1,DvtDrillablePath.DISCLOSED_OUTER_STROKE_WIDTH);d.setDisclosedStroke(e,g);a.setLabelRendered(c.location,!1);this._styleDisplayable(c,d);a=this._createLabel(a,b,c,d,!0);return new DvtMapAreaPeer(c,b,d,a)}return null};
DvtThematicMapJsonParser.prototype._createMarker=function(a,b,c,d){var e=DvtThematicMapJsonParser.getCenter(b,c);if(!e)return null;var g=this._tmap.getStyleDefaults().dataMarkerDefaults,h=new DvtCSSStyle(g.labelStyle);h.parseInlineStyle(c.labelStyle);c=DvtJSONUtils.merge(c,g);c.labelStyle=h.toString();g=1;isNaN(c.scaleX)||(g=c.scaleX);h=1;isNaN(c.scaleY)||(h=c.scaleY);var k=c.width,m=c.height;if(!k||isNaN(k))k=this._tmap.getOptions().styleDefaults.dataMarkerDefaults.width;if(!m||isNaN(m))m=this._tmap.getOptions().styleDefaults.dataMarkerDefaults.height;
if(c.source)g=new DvtImageMarker(this._tmap.getCtx(),e.x,e.y,k*g,m*h,c.source,c.sourceSelected,c.sourceHover,c.sourceHoverSelected);else var n=c.shape?c.shape:this._tmap.getOptions().styleDefaults.dataMarkerDefaults.shape,g=new DvtSimpleMarker(this._tmap.getCtx(),n,this._tmap.getSkinName(),e.x,e.y,k*g,m*h);(h=c.rotation)&&g.setRotation(h*Math.PI/180);d&&a.setLabelRendered(c.location,!1);this._styleDisplayable(c,g);a=this._createLabel(a,b,c,g,d);return new DvtMapObjPeer(c,b,g,a,e)};
DvtThematicMapJsonParser.prototype._createImage=function(a,b,c,d){var e=DvtThematicMapJsonParser.getCenter(b,c);if(!e)return null;var g=new DvtImage(this._tmap.getCtx(),c.url),h=c.width,k=c.height;null!=h&&null!=k&&(g.setX(e.x-h/2),g.setY(e.y-k/2),g.setWidth(h),g.setHeight(k));d&&a.setLabelRendered(c.location,!1);var m=new DvtMapObjPeer(c,b,g,null,e);h&&k||DvtImageLoader.loadImage(this._tmap.getCtx(),c.url,function(a){a&&a.width&&a.height&&(g.setWidth(a.width),g.setHeight(a.height),g.setX(e.x-a.width/
2),g.setY(e.y-a.height/2),m.__recenter())});return m};DvtThematicMapJsonParser.prototype._createCustomDataItem=function(a,b,c,d,e){var g=DvtThematicMapJsonParser.getCenter(b,c);if(!g)return null;e&&a.setLabelRendered(c.location,!1);a=new DvtCustomDataItem(this._tmap.getCtx(),d,this._tmap.getStyleDefaults().dataAreaDefaults);return new DvtMapObjPeer(c,b,a,null,g)};
DvtThematicMapJsonParser.prototype._createLabel=function(a,b,c,d,e){var g=c.location,h=c.label,k=h?"on":"off";e&&(k=a.getLabelDisplay());d=d instanceof DvtPath;!h&&e&&(d&&"off"!=k||!d&&"on"==k)&&(h="long"==a.getLabelType()?a.getLongAreaName(g):a.getShortAreaName(g));if(h){var m=this._tmap.getCtx(),m=d?new DvtMapLabel(m,h,a.getLabelInfoForArea?a.getLabelInfoForArea(g):null,k,b.getDataLabelContainer(),this._tmap.supportsVectorEffects()):new DvtOutputText(m,h,0,0);b=new DvtCSSStyle;d&&b.merge(a.getLayerCSSStyle());
c.labelStyle&&b.parseInlineStyle(c.labelStyle);a=b.getStyle(DvtCSSStyle.COLOR);b.setStyle(DvtCSSStyle.COLOR,null);m.setCSSStyle(b);m instanceof DvtMapLabel&&(DvtAgent.isHighContrast()||!a)&&(a=DvtColorUtils.getContrastingTextColor(c.color));a&&m.setSolidFill(a)}return m};
DvtThematicMapJsonParser.prototype._styleDisplayable=function(a,b){var c=a.pattern,d=a.color,e=this._isMobile||this._tmap.getSkinName()==DvtCSSStyle.SKIN_ALTA?"none":a.visualEffects;if(b instanceof DvtSimpleMarker){if("none"!=a.borderStyle){var g=a.borderWidth;"string"==typeof g&&(g="px"==g.slice(-2)?parseFloat(a.borderWidth.slice(0,-2)):parseFloat(a.borderWidth));var h=new DvtSolidStroke(a.borderColor,1,g);this._tmap.isMarkerZoomBehaviorFixed()||h.setFixedWidth(!0);h.setType(DvtStroke.convertTypeString(a.borderStyle));
b.setStroke(h)}g=a.opacity;"none"!=e?b.setFill(new DvtMarkerGradient.createMarkerGradient(d,b,g)):c?b.setFill(new DvtPatternFill(c,d,"#FFFFFF")):d&&b.setSolidFill(d,g)}else if(b instanceof DvtPath){if(e=a.borderColor)h=new DvtSolidStroke(e),this._tmap.supportsVectorEffects()&&h.setFixedWidth(!0),b.setStroke(h);c?b.savePatternFill(new DvtPatternFill(c,d,"#FFFFFF")):b.setSolidFill(d,g)}};
DvtThematicMapJsonParser.getCenter=function(a,b){var c=a.getMap(),d=c.getMapName(),e=b.location;return e?((c=DvtBaseMapManager.getAreaCenter(d,a.getMapLayer().getLayerName(),e))||(c=DvtBaseMapManager.getCityCoordinates(d,e)),c):DvtThematicMapProjections.project(b.x,b.y,c.getMapName())};DvtThematicMapJsonParser.prototype._getShowPopupBehaviors=function(a){for(var b=[],c=0;c<a.length;c++)b.push(new DvtShowPopupBehavior(a[c].popupId,a[c].triggerType,null,a[c].align));return b};
var DvtThematicMapProjections={};DvtObj.createSubclass(DvtThematicMapProjections,DvtObj,"DvtThematicMapProjections");DvtThematicMapProjections._VIEWPORT_BOUNDS=new DvtRectangle(0,0,800,500);DvtThematicMapProjections._RADIUS=6378206.4;DvtThematicMapProjections._NEW_ZEALAND_RECT=new DvtRectangle(500,200,200,200);DvtThematicMapProjections._NEW_ZEALAND_BOUNDS=new DvtRectangle(163,-49,17,17);
DvtThematicMapProjections._AFRICA_BOUNDS=new DvtRectangle(-17.379205428479874,-37.201510854305546,68.66391442808313,77.50071544582713);DvtThematicMapProjections._ASIA_BOUNDS=new DvtRectangle(-.8436866097568272,-.7626456732012923,1.8336308036296942,1.5748427214611724);DvtThematicMapProjections._AUSTRALIA_BOUNDS=new DvtRectangle(113.29667079927977,-52.89550592498755,65.25257389065216,42.123114617504626);
DvtThematicMapProjections._EUROPE_BOUNDS=new DvtRectangle(-.47944476148667076,-.0014669405958800579,.7364925893845453,.6293972741802124);DvtThematicMapProjections._N_AMERICA_BOUNDS=new DvtRectangle(-.6154469465354344,-.24589767758847714,1.2448236795108683,1.2631535127174947);DvtThematicMapProjections._S_AMERICA_BOUNDS=new DvtRectangle(-80.60817722658722,-60.796273249672765,46.608687602908056,66.96595767361796);
DvtThematicMapProjections._APAC_BOUNDS=new DvtRectangle(68.20516856593524,-52.89892708045518,111.65739821771903,116.55460214469134);DvtThematicMapProjections._EMEA_BOUNDS=new DvtRectangle(-24.543831069368586,-37.202500659225905,204.54283106936856,164.9634493690208);DvtThematicMapProjections._L_AMERICA_BOUNDS=new DvtRectangle(-117.12451221229134,-54.95921623126266,82.33223251442891,87.67786623127876);
DvtThematicMapProjections._USA_CANADA_BOUNDS=new DvtRectangle(-.6154656300926513,.0507209798775865,1.0153104799231851,.966537441082997);DvtThematicMapProjections._WORLD_BOUNDS=new DvtRectangle(-171.9,-62.6,349.8,150.8);DvtThematicMapProjections._ALASKA1_RECT=new DvtRectangle(172,51,8,3);DvtThematicMapProjections._ALASKA2_RECT=new DvtRectangle(-180,51,51,21);DvtThematicMapProjections._HAWAII_RECT=new DvtRectangle(-178.5,18.9,35,11);
DvtThematicMapProjections._USA_RECT=new DvtRectangle(-124.8,24.4,58,25.5);DvtThematicMapProjections._ALASKA_BOUNDS=new DvtRectangle(-187.5517578125,59.82610321044922,57.562225341796875,43.83738708496094);DvtThematicMapProjections._HAWAII_BOUNDS=new DvtRectangle(-160.23606872558594,18.91549301147461,5.4374847412109375,3.3189010620117188);DvtThematicMapProjections._USA_BOUNDS=new DvtRectangle(-2386803.25,-1183550.5,4514111,2908402);
DvtThematicMapProjections._HAWAII_WINDOW=new DvtRectangle(165,400,100,100);DvtThematicMapProjections._ALASKA_WINDOW=new DvtRectangle(-75,350,240,150);DvtThematicMapProjections._ROBINSON_COORDINATES=[[1,0],[.9986,.0314],[.9954,.0629],[.99,.0943],[.9822,.1258],[.973,.1572],[.96,.1887],[.9427,.2201],[.9216,.2515],[.8962,.2826],[.8679,.3132],[.835,.3433],[.7986,.3726],[.7597,.4008],[.6732,.4532],[.6213,.4765],[.5722,.4951],[.5322,.5072]];
DvtThematicMapProjections.project=function(a,b,c){var d;switch(c){case "africa":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._AFRICA_BOUNDS,DvtThematicMapProjections._getMercatorProjection(a,b));break;case "asia":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._ASIA_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(40,95,20,60,a,b),DvtThematicMapProjections.toRadians(5));break;case "australia":d=DvtThematicMapProjections._getAustraliaProjection(a,
b);break;case "europe":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._EUROPE_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(35,25,40,65,a,b),DvtThematicMapProjections.toRadians(10));break;case "northAmerica":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._N_AMERICA_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(23,-96,20,60,a,b));break;case "southAmerica":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._S_AMERICA_BOUNDS,
new DvtPoint(a,b),DvtThematicMapProjections.toRadians(5));break;case "apac":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._APAC_BOUNDS,DvtThematicMapProjections._getMercatorProjection(a,b));break;case "emea":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._EMEA_BOUNDS,DvtThematicMapProjections._getMercatorProjection(a,b));break;case "latinAmerica":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._L_AMERICA_BOUNDS,new DvtPoint(a,
b));break;case "usaAndCanada":d=DvtThematicMapProjections._getAffineProjection(DvtThematicMapProjections._USA_CANADA_BOUNDS,DvtThematicMapProjections._getAlbersEqualAreaConicProjection(23,-96,20,60,a,b));break;case "worldRegions":d=DvtThematicMapProjections._getWorldProjection(a,b);break;case "usa":d=DvtThematicMapProjections._getUSAProjection(a,b);break;case "world":d=DvtThematicMapProjections._getWorldProjection(a,b)}return d?new DvtPoint(10*d.x,10*d.y):null};
DvtThematicMapProjections._getUSAProjection=function(a,b){var c;DvtThematicMapProjections._ALASKA1_RECT.containsPoint(a,b)||DvtThematicMapProjections._ALASKA2_RECT.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._ALASKA_BOUNDS,DvtThematicMapProjections._ALASKA_WINDOW),c=DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getMercatorProjection(a,b))):DvtThematicMapProjections._HAWAII_RECT.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._HAWAII_BOUNDS,
DvtThematicMapProjections._HAWAII_WINDOW),c=DvtThematicMapProjections._applyAffineTransform(c,new DvtPoint(a,b))):DvtThematicMapProjections._USA_RECT.containsPoint(a,b)&&(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._USA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS),c=DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getOrthographicProjection(new DvtPoint(-95,36),a,b)));return DvtThematicMapProjections._getBoundedTransformedPoint(DvtThematicMapProjections._VIEWPORT_BOUNDS,
c)};DvtThematicMapProjections._getWorldProjection=function(a,b){var c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._WORLD_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS),c=DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getRobinsonProjection(a,b));return DvtThematicMapProjections._getBoundedTransformedPoint(DvtThematicMapProjections._VIEWPORT_BOUNDS,c)};
DvtThematicMapProjections._getAustraliaProjection=function(a,b){var c;c=DvtThematicMapProjections._NEW_ZEALAND_BOUNDS.containsPoint(a,b)?DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._NEW_ZEALAND_BOUNDS,DvtThematicMapProjections._NEW_ZEALAND_RECT):DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._AUSTRALIA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);c=DvtThematicMapProjections._applyAffineTransform(c,DvtThematicMapProjections._getMercatorProjection(a,
b));return DvtThematicMapProjections._getBoundedTransformedPoint(DvtThematicMapProjections._VIEWPORT_BOUNDS,c)};DvtThematicMapProjections._getAffineProjection=function(a,b,c){a=DvtThematicMapProjections._getViewPortTransformation(a,DvtThematicMapProjections._VIEWPORT_BOUNDS);if(c){var d=new DvtMatrix;d.rotate(c);a=DvtThematicMapProjections._concatAffineTransforms(a,d)}b=a.transformPoint(b);return DvtThematicMapProjections._getBoundedTransformedPoint(DvtThematicMapProjections._VIEWPORT_BOUNDS,b)};
DvtThematicMapProjections._getBoundedTransformedPoint=function(a,b){return b&&a.containsPoint(b.x,b.y)?b:null};
DvtThematicMapProjections._getAlbersEqualAreaConicProjection=function(a,b,c,d,e,g){b=DvtThematicMapProjections.toRadians(b);var h=DvtThematicMapProjections.toRadians(a);c=DvtThematicMapProjections.toRadians(c);d=DvtThematicMapProjections.toRadians(d);d=.5*(Math.sin(c)+Math.sin(d));a=Math.pow(Math.cos(c),2)+2*d*Math.sin(c);c=a-2*d*Math.sin(h);c=Math.sqrt(c)/d;e=DvtThematicMapProjections.toRadians(e);g=DvtThematicMapProjections.toRadians(g);b=d*(e-b);g=a-2*d*Math.sin(g);g=Math.sqrt(g)/d;d=g*Math.sin(b);
g=c-g*Math.cos(b);return new DvtPoint(d,g)};DvtThematicMapProjections._getMercatorProjection=function(a,b){var c=Math.log(Math.tan(.25*Math.PI+.5*DvtThematicMapProjections.toRadians(b)));return new DvtPoint(a,DvtThematicMapProjections.toDegrees(c))};
DvtThematicMapProjections._getOrthographicProjection=function(a,b,c){b=DvtThematicMapProjections.toRadians(b);c=DvtThematicMapProjections.toRadians(c);var d=DvtThematicMapProjections.toRadians(a.x),e=DvtThematicMapProjections.toRadians(a.y);a=Math.cos(c)*Math.sin(b-d);b=Math.cos(e)*Math.sin(c)-Math.sin(e)*Math.cos(c)*Math.cos(b-d);return new DvtPoint(a*DvtThematicMapProjections._RADIUS,b*DvtThematicMapProjections._RADIUS)};
DvtThematicMapProjections._getRobinsonProjection=function(a,b){var c=Math.floor(Math.abs(b)/5);c>=DvtThematicMapProjections._ROBINSON_COORDINATES.length-1&&(c=DvtThematicMapProjections._ROBINSON_COORDINATES.length-2);var d=(Math.abs(b)-5*c)/5,e=a*(DvtThematicMapProjections._ROBINSON_COORDINATES[c][0]+d*(DvtThematicMapProjections._ROBINSON_COORDINATES[c+1][0]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][0])),c=DvtThematicMapProjections._ROBINSON_COORDINATES[c][1]+d*(DvtThematicMapProjections._ROBINSON_COORDINATES[c+
1][1]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][1]);0>b&&(c*=-1);return new DvtPoint(e,180*c)};DvtThematicMapProjections._applyAffineTransform=function(a,b){return new DvtPoint(b.x*a.getA()+a.getTx(),b.y*a.getD()+a.getTy())};DvtThematicMapProjections._concatAffineTransforms=function(a,b){var c=a.getA(),d=b.getA()*c,e=b.getB()*c,c=a.getTx()+b.getTx()*c,g=a.getD(),h=b.getC()*g,k=b.getD()*g,g=a.getTy()+b.getTy()*g;return new DvtMatrix(d,e,h,k,c,g)};
DvtThematicMapProjections._getViewPortTransformation=function(a,b){var c=b.x,d=b.y,e=a.w,g=a.h,h=0,h=b.w/e,k=b.h/g,h=h<=k?h:k,c=c-a.x*h,d=d+a.y*h,c=c+(b.w-e*h)/2,d=d+(b.h-(b.h-g*h)/2);return new DvtMatrix(h,0,0,-h,c,d)};DvtThematicMapProjections.toRadians=function(a){return Math.PI/180*a};DvtThematicMapProjections.toDegrees=function(a){return 180/Math.PI*a};
DvtThematicMapProjections.inverseProject=function(a,b,c){var d;a/=10;b/=10;switch(c){case "africa":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._AFRICA_BOUNDS,new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseMercatorProjection(d.x,d.y);break;case "asia":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._ASIA_BOUNDS,new DvtPoint(a,b),DvtThematicMapProjections.toRadians(5));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(40,
95,20,60,d.x,d.y);break;case "australia":d=DvtThematicMapProjections._getInverseAustraliaProjection(a,b);break;case "europe":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._EUROPE_BOUNDS,new DvtPoint(a,b),DvtThematicMapProjections.toRadians(10));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(35,25,40,65,d.x,d.y);break;case "northAmerica":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._N_AMERICA_BOUNDS,new DvtPoint(a,
b));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(23,-96,20,60,d.x,d.y);break;case "southAmerica":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._S_AMERICA_BOUNDS,new DvtPoint(a,b),DvtThematicMapProjections.toRadians(5));break;case "apac":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._APAC_BOUNDS,new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseMercatorProjection(d.x,d.y);break;case "emea":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._EMEA_BOUNDS,
new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseMercatorProjection(d.x,d.y);break;case "latinAmerica":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._L_AMERICA_BOUNDS,new DvtPoint(a,b));break;case "usaAndCanada":d=DvtThematicMapProjections._getInverseAffineProjection(DvtThematicMapProjections._USA_CANADA_BOUNDS,new DvtPoint(a,b));d=DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection(23,-96,20,60,d.x,d.y);break;case "worldRegions":d=DvtThematicMapProjections._getInverseWorldProjection(a,
b);break;case "usa":d=DvtThematicMapProjections._getInverseUSAProjection(a,b);break;case "world":d=DvtThematicMapProjections._getInverseWorldProjection(a,b)}return d?d:new DvtPoint(a,b)};
DvtThematicMapProjections._getInverseUSAProjection=function(a,b){var c;return DvtThematicMapProjections._ALASKA_WINDOW.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._ALASKA_BOUNDS,DvtThematicMapProjections._ALASKA_WINDOW),c.invert(),c=c.transformPoint(new DvtPoint(a,b)),DvtThematicMapProjections._getInverseMercatorProjection(c.x,c.y)):DvtThematicMapProjections._HAWAII_WINDOW.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._HAWAII_BOUNDS,
DvtThematicMapProjections._HAWAII_WINDOW),c.invert(),c.transformPoint(new DvtPoint(a,b))):DvtThematicMapProjections._VIEWPORT_BOUNDS.containsPoint(a,b)?(c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._USA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS),c.invert(),c=c.transformPoint(new DvtPoint(a,b)),DvtThematicMapProjections._getInverseOrthographicProjection(new DvtPoint(-95,36),c.x,c.y)):new DvtPoint(a,b)};
DvtThematicMapProjections._getInverseWorldProjection=function(a,b){var c=DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._WORLD_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);c.invert();c=c.transformPoint(new DvtPoint(a,b));return DvtThematicMapProjections._getInverseRobinsonProjection(c.x,c.y)};
DvtThematicMapProjections._getInverseAustraliaProjection=function(a,b){var c;c=DvtThematicMapProjections._NEW_ZEALAND_RECT.containsPoint(a,b)?DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._NEW_ZEALAND_BOUNDS,DvtThematicMapProjections._NEW_ZEALAND_RECT):DvtThematicMapProjections._getViewPortTransformation(DvtThematicMapProjections._AUSTRALIA_BOUNDS,DvtThematicMapProjections._VIEWPORT_BOUNDS);c.invert();c=c.transformPoint(new DvtPoint(a,b));return DvtThematicMapProjections._getInverseMercatorProjection(c.x,
c.y)};DvtThematicMapProjections._getInverseAffineProjection=function(a,b,c){a=DvtThematicMapProjections._getViewPortTransformation(a,DvtThematicMapProjections._VIEWPORT_BOUNDS);if(c){var d=new DvtMatrix;d.rotate(c);a=DvtThematicMapProjections._concatAffineTransforms(a,d)}a.invert();return a.transformPoint(b)};
DvtThematicMapProjections._getInverseAlbersEqualAreaConicProjection=function(a,b,c,d,e,g){b=DvtThematicMapProjections.toRadians(b);a=DvtThematicMapProjections.toRadians(a);c=DvtThematicMapProjections.toRadians(c);d=DvtThematicMapProjections.toRadians(d);d=.5*(Math.sin(c)+Math.sin(d));c=Math.pow(Math.cos(c),2)+2*d*Math.sin(c);var h=c-2*d*Math.sin(a),h=Math.sqrt(h)/d;a=Math.sqrt(e*e+(h-g)*(h-g));e=Math.atan(e/(h-g));g=Math.asin((c-a*a*d*d)/(2*d));return new DvtPoint(DvtThematicMapProjections.toDegrees(b+
e/d),DvtThematicMapProjections.toDegrees(g))};DvtThematicMapProjections._getInverseMercatorProjection=function(a,b){var c=2*Math.atan(Math.exp(DvtThematicMapProjections.toRadians(b)))-.5*Math.PI;return new DvtPoint(a,DvtThematicMapProjections.toDegrees(c))};
DvtThematicMapProjections._getInverseOrthographicProjection=function(a,b,c){b/=DvtThematicMapProjections._RADIUS;c/=DvtThematicMapProjections._RADIUS;var d=DvtThematicMapProjections.toRadians(a.x),e=DvtThematicMapProjections.toRadians(a.y),g=Math.sqrt(b*b+c*c),h=Math.asin(g);a=Math.asin(Math.cos(h)*Math.sin(e)+c*Math.sin(h)*Math.cos(e)/g);b=d+Math.atan(b*Math.sin(h)/(g*Math.cos(e)*Math.cos(h)-c*Math.sin(e)*Math.sin(h)));return new DvtPoint(DvtThematicMapProjections.toDegrees(b),DvtThematicMapProjections.toDegrees(a))};
DvtThematicMapProjections._getInverseRobinsonProjection=function(a,b){var c=Math.floor(Math.abs(b)/5);c>=DvtThematicMapProjections._ROBINSON_COORDINATES.length-1&&(c=DvtThematicMapProjections._ROBINSON_COORDINATES.length-2);var d=DvtThematicMapProjections._ROBINSON_COORDINATES[c+1][0]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][0],e=DvtThematicMapProjections._ROBINSON_COORDINATES[c+1][1]-DvtThematicMapProjections._ROBINSON_COORDINATES[c][1],g=(Math.abs(b/180)-DvtThematicMapProjections._ROBINSON_COORDINATES[c][1])/
e,e=5*g+5*c,c=a/(DvtThematicMapProjections._ROBINSON_COORDINATES[c][0]+g*d);0>b&&(e*=-1);return new DvtPoint(c,e)};var DvtMapControlButton=function(a,b,c,d,e,g,h){this.Init(a,b,c,d,e,g,h)};DvtObj.createSubclass(DvtMapControlButton,DvtBaseControl,"DvtMapControlButton");DvtMapControlButton.BUTTON_TYPE_DRILLUP=0;DvtMapControlButton.BUTTON_TYPE_DRILLDOWN=1;DvtMapControlButton.BUTTON_TYPE_RESET=2;
DvtMapControlButton.prototype.Init=function(a,b,c,d,e,g){DvtMapControlButton.superclass.Init.call(this,a);this._btype=e;this._button=b;this._eventManager=g;this._button.setCallback(this.HandleOnClick,this);a=new DvtControlPanelEventHandlerProxy(this,null,null,null,null,null,this._getTooltipText());this._eventManager.associate(this._button,a);this.addChild(this._button);this._mapCallback=c;this._isEnabled=!0};
DvtMapControlButton.prototype.setEnabled=function(a){this.setAlpha(a?1:.4);this._isEnabled=a;this._button.setEnabled(a);this._button.initState()};DvtMapControlButton.prototype.HandleOnClick=function(a){DvtEventManager.consumeEvent(a);this._isEnabled&&this._mapCallback&&this._mapCallback()};
DvtMapControlButton.prototype._getTooltipText=function(){return this._btype==DvtMapControlButton.BUTTON_TYPE_DRILLUP?DvtBundle.getTranslatedString(DvtBundle.SUBCOMPONENT_PREFIX,"CONTROL_PANEL_DRILLUP"):this._btype==DvtMapControlButton.BUTTON_TYPE_DRILLDOWN?DvtBundle.getTranslatedString(DvtBundle.SUBCOMPONENT_PREFIX,"CONTROL_PANEL_DRILLDOWN"):this._btype==DvtMapControlButton.BUTTON_TYPE_RESET?DvtBundle.getTranslatedString(DvtBundle.SUBCOMPONENT_PREFIX,"CONTROL_PANEL_RESET"):null};
var DvtThematicMapControlPanel=function(a,b,c){this.Init(a,b,c)};DvtObj.createSubclass(DvtThematicMapControlPanel,DvtControlPanel,"DvtThematicMapControlPanel");
DvtThematicMapControlPanel.prototype.Init=function(a,b,c){DvtThematicMapControlPanel.superclass.Init.call(this,a,b,c);this._drillMode=b.getDrillMode();this._buttonImages=b.getResourcesMap();this._drillUpCallback=DvtObj.createCallback(b,b.drillUp);this._drillDownCallback=DvtObj.createCallback(b,b.drillDown);this._resetCallback=DvtObj.createCallback(b,b.resetMap);this._drillDownButton=this._drillUpButton=this._resetButton=null;this._drillUpButtonEnabled=this._drillDownButtonEnabled=!1;this._styleMap=
b.getSubcomponentStyles()};DvtThematicMapControlPanel.prototype.setEnabledDrillDownButton=function(a){this._drillDownButtonEnabled=a;this._drillDownButton&&this._drillDownButton.setEnabled(a)};DvtThematicMapControlPanel.prototype.setEnabledDrillUpButton=function(a){this._drillUpButtonEnabled=a;this._drillUpButton&&this._drillUpButton.setEnabled(a)};
DvtThematicMapControlPanel.prototype.PopulateHorzContentBar=function(a){if(this._drillMode&&"none"!=this._drillMode){var b=DvtStyleUtils.getStyle(this._styleMap,DvtControlPanel.CP_BUTTON_WIDTH,0);this._resetButton=DvtButtonLAFUtils.createResetButton(this.getCtx(),this._resetCallback,this._panZoomCanvas,DvtMapControlButton.BUTTON_TYPE_RESET,this._buttonImages,this._eventManager,this._styleMap);a.addChild(this._resetButton);this._drillDownButton=DvtButtonLAFUtils.createDrillDownButton(this.getCtx(),
this._drillDownCallback,this._panZoomCanvas,DvtMapControlButton.BUTTON_TYPE_DRILLDOWN,this._buttonImages,this._eventManager,this._styleMap);this._drillDownButton.setTranslateX(b);this._drillDownButton.setEnabled(this._drillDownButtonEnabled);a.addChild(this._drillDownButton);this._drillUpButton=DvtButtonLAFUtils.createDrillUpButton(this.getCtx(),this._drillUpCallback,this._panZoomCanvas,DvtMapControlButton.BUTTON_TYPE_DRILLUP,this._buttonImages,this._eventManager,this._styleMap);this._drillUpButton.setTranslateX(2*
b);this._drillUpButton.setEnabled(this._drillUpButtonEnabled);a.addChild(this._drillUpButton)}};