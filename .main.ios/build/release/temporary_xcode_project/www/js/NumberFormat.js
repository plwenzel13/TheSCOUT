window.TrNumberFormat=function(a,b){a||alert("type for TrNumberFormat not defined!");this._type=a;this._localeSymbols=getLocaleSymbols(b);this._pPre=this._localeSymbols.getPositivePrefix();this._pSuf=this._localeSymbols.getPositiveSuffix();this._nPre=this._localeSymbols.getNegativePrefix();this._nSuf=this._localeSymbols.getNegativeSuffix();this._maxFractionDigits=3;this._maxIntegerDigits=40;this._minFractionDigits="currency"==this._type?2:0;this._minIntegerDigits=1;this._groupingUsed=!0};
TrNumberFormat.getNumberInstance=function(a){return new TrNumberFormat("number",a)};TrNumberFormat.getCurrencyInstance=function(a,b,c){a=new TrNumberFormat("currency",a);b?(c=getLocaleSymbols().getCurrencyCode(),a._pPre=a._pPre.replace(c,b),a._pSuf=a._pSuf.replace(c,b),a._nPre=a._nPre.replace(c,b),a._nSuf=a._nSuf.replace(c,b)):c&&(b=getLocaleSymbols().getCurrencySymbol(),a._pPre=a._pPre.replace(b,c),a._pSuf=a._pSuf.replace(b,c),a._nPre=a._nPre.replace(b,c),a._nSuf=a._nSuf.replace(b,c));return a};
TrNumberFormat.getPercentInstance=function(a){return new TrNumberFormat("percent",a)};TrNumberFormat.prototype.setGroupingUsed=function(a){this._groupingUsed=a};TrNumberFormat.prototype.isGroupingUsed=function(){return this._groupingUsed};TrNumberFormat.prototype.setMaximumIntegerDigits=function(a){a&&(this._maxIntegerDigits=0>a?0:a,this._minIntegerDigits>this._maxIntegerDigits&&(this._minIntegerDigits=this._maxIntegerDigits))};TrNumberFormat.prototype.getMaximumIntegerDigits=function(){return this._maxIntegerDigits};
TrNumberFormat.prototype.setMaximumFractionDigits=function(a){a&&(this._maxFractionDigits=0>a?0:a,this._maxFractionDigits<this._minFractionDigits&&(this._minFractionDigits=this._maxFractionDigits),this._isMaxFractionDigitsSet=!0)};TrNumberFormat.prototype.getMaximumFractionDigits=function(){return this._maxFractionDigits};TrNumberFormat.prototype.setMinimumIntegerDigits=function(a){a&&(this._minIntegerDigits=0>a?0:a,this._minIntegerDigits>this._maxIntegerDigits&&(this._maxIntegerDigits=this._minIntegerDigits))};
TrNumberFormat.prototype.getMinimumIntegerDigits=function(){return this._minIntegerDigits};TrNumberFormat.prototype.setMinimumFractionDigits=function(a){a&&(this._minFractionDigits=0>a?0:a,this._maxFractionDigits<this._minFractionDigits&&(this._maxFractionDigits=this._minFractionDigits))};TrNumberFormat.prototype.getMinimumFractionDigits=function(){return this._minFractionDigits};
TrNumberFormat.prototype.format=function(a){if("percent"==this._type)return this.percentageToString(a);if("currency"==this._type)return this.currencyToString(a);if("number"==this._type)return this.numberToString(a)};TrNumberFormat.prototype.parse=function(a){return"percent"==this._type?this.stringToPercentage(a):"currency"==this._type?this.stringToCurrency(a):this.stringToNumber(a)};
TrNumberFormat.prototype.stringToNumber=function(a){if(isNaN(a)||-1!=a.indexOf("e")||-1!=a.indexOf("E"))throw new TrParseException("not able to parse number");return parseFloat(a)};
TrNumberFormat.prototype.stringToCurrency=function(a){var b=a.indexOf(this._nPre),c=this._nSuf;if(" "==c.charAt(0)||"\u00a0"==c.charAt(0))c=c.substring(1);var d=a.indexOf(c);if(-1!=b&&-1!=d)return a=a.substr(this._nPre.length,a.length-(this._nPre.length+c.length)),-1*this.stringToNumber(a);b=a.indexOf(this._pPre);c=this._pSuf;if(" "==c.charAt(0)||"\u00a0"==c.charAt(0))c=c.substring(1);d=a.indexOf(c);if(-1!=b&&-1!=d)return a=a.substr(this._pPre.length,a.length-(this._pPre.length+c.length)),a=this.stringToNumber(a);
throw new TrParseException("not able to parse number");};TrNumberFormat.prototype.stringToPercentage=function(a){if(-1==a.indexOf("%"))throw new TrParseException("not able to parse number");a=a.replace(/\%/g,"");return this.stringToNumber(a)};
TrNumberFormat.prototype.numberToString=function(a){var b=0>a;b&&(a*=-1);var c;c=TrNumberFormat.scientificToExpanded(a+"");var d=c.indexOf("."),e=c.length;-1!=d?(a=c.substring(0,d),c=c.substring(d+1,e)):(a=c,c="");a=this._formatIntegers(a);c=this._formatFractions(c);d=this._localeSymbols.getDecimalSeparator();c=""!=c?a+d+c:a;b&&(c="-"+c);return c};
TrNumberFormat.prototype.currencyToString=function(a){if(0>a)return a=this.numberToString(-1*a+""),this._nPre+a+this._nSuf;a=this.numberToString(a);return this._pPre+a+this._pSuf};
TrNumberFormat.prototype.percentageToString=function(a){a*=100;null==this._isMaxFractionDigitsSet?a=this.getRounded(a):null!=this._maxFractionDigits&&(a=this.getRoundedFixedDigits(a,this._maxFractionDigits));if(isNaN(a))throw new TrParseException("not able to parse number");var b=this._localeSymbols.getPercentSuffix();if(!b||""==b)throw new TrParseException("percent suffix undefined or empty");a=this.numberToString(a);return a+b};
TrNumberFormat.scientificToExpanded=function(a){var b=a.indexOf("e");if(-1==b)return a;var c="";"-"==a.charAt(0)&&(c="-",a=a.substring(1),--b);var d="+"==a.charAt(b+1),e=parseInt(a.substring(b+2)),g=b-2,h="";if(d){for(d=0;d<e-g;++d)h+="0";return c+a.charAt(0)+a.substring(2,b)+h}for(d=0;d<e-1;++d)h+="0";return c+"0."+h+a.charAt(0)+a.substring(2,b)};
TrNumberFormat.trimLeadingZeroes=function(a){var b=[],c,d;for(c=0;c<a.length;++c){d=a.charAt(c);if("1"<=d&&"9">=d||"."==d)break;"0"==d&&c+1<a.length&&"."!=a.charAt(c+1)||b.push(d)}return b.join("")+a.substring(c)};TrNumberFormat.prototype.getRoundedFixedDigits=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)};TrNumberFormat.prototype.getRounded=function(a){a=this.moveDecimalRight(a);a=Math.round(a);return a=this.moveDecimalLeft(a)};
TrNumberFormat.prototype.moveDecimalRight=function(a){var b="";return b=this.moveDecimal(a,!1)};TrNumberFormat.prototype.moveDecimalLeft=function(a){var b="";return b=this.moveDecimal(a,!0)};TrNumberFormat.prototype.moveDecimal=function(a,b){var c="",c=this.moveDecimalAsString(a,b);return parseFloat(c)};
TrNumberFormat.prototype.moveDecimalAsString=function(a,b){var c=a+"",d=this.getZeros(2),e=/([0-9.]+)/;b?(c=c.replace(e,d+"$1"),d=/(-?)([0-9]*)([0-9]{2})(\.?)/,c=c.replace(d,"$1$2.$3")):(e=e.exec(c),null!=e&&(c=c.substring(0,e.index)+e[1]+d+c.substring(e.index+e[0].length)),d=/(-?)([0-9]*)(\.?)([0-9]{2})/,c=c.replace(d,"$1$2$4."));return c=c.replace(/\.$/,"")};TrNumberFormat.prototype.getZeros=function(a){var b="",c;for(c=0;c<a;c++)b+="0";return b};
TrNumberFormat.prototype._formatIntegers=function(a){var b=a.length,c=this.getMaximumIntegerDigits(),d=this.getMinimumIntegerDigits();if(b>c)a=a.substring(b-c,b);else if(b<d){b=d-b;for(c="";0<b;)c="0"+c,--b;a=c+a}this.isGroupingUsed()&&(a=this._addGroupingSeparators(a));return a};TrNumberFormat.prototype._formatFractions=function(a){var b=a.length,c=this.getMaximumFractionDigits(),d=this.getMinimumFractionDigits();b>c&&c>=d&&(a=a.substring(0,c));if(b<d)for(b=d-b;0<b;)a+="0",--b;return a};
TrNumberFormat.prototype._addGroupingSeparators=function(a){var b=a.length,c=b%3,d,e="",g=this._localeSymbols.getGroupingSeparator();0<c?(d=4>b?a.substring(0,c):a.substring(0,c)+g,a=a.substring(c,b)):d="";for(i=0;i<a.length;i++)0==i%3&&0!=i&&(e+=g),e+=a.charAt(i);return d+e};window.TrParseException=function(a){this._message=a};TrParseException.prototype.getMessage=function(){return this._message};