var DvtLegend=function(){};DvtObj.createSubclass(DvtLegend,DvtBaseComponent,"DvtLegend");DvtLegend.newInstance=function(a,b,c){var d=new DvtLegend;d.Init(a,b,c);return d};DvtLegend.getDefaults=function(a){return(new DvtLegendDefaults).getDefaults(a)};
DvtLegend.prototype.Init=function(a,b,c){DvtLegend.superclass.Init.call(this,a,b,c);this.setId("legend1000"+Math.floor(1E9*Math.random()));this.Defaults=new DvtLegendDefaults;this._eventManager=new DvtLegendEventManager(this);this._eventManager.addListeners(this);this._peers=[];this._navigablePeers=[];this._bounds=null;this._titles=[]};
DvtLegend.prototype.SetOptions=function(a){a?(this.Options=this.Defaults.calcOptions(a),this._transferVisibilityProperties(this.Options.sections)):this.Options||(this.Options=this.GetDefaults())};DvtLegend.prototype.getPreferredSize=function(a,b,c){this.SetOptions(a);this.getOptions().isLayout=!0;a=new DvtRectangle(0,0,b,c);a=DvtLegendRenderer.render(this,a);this.getOptions().isLayout=!1;return new DvtDimension(a.w,a.h)};
DvtLegend.prototype.render=function(a,b,c){this.SetOptions(a);isNaN(b)||isNaN(c)||(this.Width=b,this.Height=c);this.getOptions().isLayout=!1;this.removeChildren();this._peers=[];this._navigablePeers=[];this._bounds=null;this._titles=[];DvtAgent.isTouchDevice()||this._eventManager.setKeyboardHandler(new DvtLegendKeyboardHandler(this._eventManager,this));this.UpdateAriaAttributes();a=new DvtRectangle(0,0,this.Width,this.Height);this._contentDimensions=DvtLegendRenderer.render(this,a);(a=this.getOptions().highlightedCategories)&&
0<a.length&&this.highlight(a);return this._contentDimensions};DvtLegend.prototype.highlight=function(a){this.getOptions().highlightedCategories=a&&0<a.length?a.slice():null;DvtCategoryRolloverHandler.highlight(a,this.__getObjects(),!0)};
DvtLegend.prototype.processEvent=function(a,b){var c=a.getType();if((c==DvtCategoryRolloverEvent.TYPE_OVER||c==DvtCategoryRolloverEvent.TYPE_OUT)&&"dim"==this.getOptions().hoverBehavior){var d=this.__getObjects();this!=b&&this.highlight(a.categories);for(var e=0;e<d.length;e++)if(d[e].getId()==a.getCategory()){this.container.scrollIntoView(d[e].getDisplayables()[0]);break}}this!=b&&c!=DvtShowPopupEvent.TYPE&&c!=DvtHidePopupEvent.TYPE||this.__dispatchEvent(a)};
DvtLegend.prototype.__getEventManager=function(){return this._eventManager};DvtLegend.prototype.__registerObject=function(a){if(a.getDisplayables()[0]instanceof DvtButton)this._navigablePeers.push(a);else{var b=this.getOptions().hideAndShowBehavior;(null!=a.getDatatip()||null!=a.getAction()||a.isDrillable()||"none"!=b&&"off"!=b)&&this._navigablePeers.push(a);this._peers.push(a)}};DvtLegend.prototype.__getObjects=function(){return this._peers};DvtLegend.prototype.__getKeyboardObjects=function(){return this._navigablePeers};
DvtLegend.prototype.destroy=function(){this._eventManager&&(this._eventManager.removeListeners(this),this._eventManager.destroy(),this._eventManager=null);DvtLegend.superclass.destroy.call(this)};DvtLegend.prototype.__setBounds=function(a){this._bounds=a};DvtLegend.prototype.__getBounds=function(){return this._bounds};DvtLegend.prototype.__registerTitle=function(a){this._titles.push(a)};DvtLegend.prototype.__getTitles=function(){return this._titles};DvtLegend.prototype.getAutomation=function(){return new DvtLegendAutomation(this)};
DvtLegend.prototype.getKeyboardFocus=function(){return null!=this._eventManager?this._eventManager.getFocus():null};DvtLegend.prototype.setKeyboardFocus=function(a,b){if(null!=this._eventManager){for(var c=this.__getKeyboardObjects(),d=0;d<c.length;d++)if(c[d].getId()==a.getId()){this._eventManager.setFocusObj(c[d]);b&&c[d].showKeyboardFocusEffect();break}if(c=this.getKeyboardFocus())d=c.getDisplayables()[0],d.setAriaProperty("label",c.getAriaLabel()),this.getCtx().setActiveElement(d)}};
DvtLegend.prototype.getDimensions=function(a){var b=new DvtRectangle(0,0,this.Width,this.Height);return a&&a!==this?this.ConvertCoordSpaceRect(b,a):b};DvtLegend.prototype.getContentDimensions=function(a){return a&&a!==this?this.ConvertCoordSpaceRect(this._contentDimensions,a):this._contentDimensions};DvtLegend.prototype.GetComponentDescription=function(){return DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,"LEGEND")};
DvtLegend.prototype._transferVisibilityProperties=function(a){if(a&&!(0>=a.length))for(var b=this.getOptions().hiddenCategories,c=0;c<a.length;c++){var d=a[c];d.sections&&(b=this._transferVisibilityProperties(d.sections));if((d=d.items)&&!(0>=d.length))for(var e=0;e<d.length;e++){var g=d[e],h=DvtLegendRenderer.getItemCategory(g);"hidden"==g.categoryVisibility&&0>DvtArrayUtils.getIndex(b,h)&&b.push(h);g.categoryVisibility=null}}};
DvtLegend.prototype.UpdateAriaAttributes=function(){if(this.IsParentRoot()){var a=this.getOptions(),b=a.hideAndShowBehavior;if("off"!=b&&"none"!=b||"dim"==a.hoverBehavior)this.getCtx().setAriaRole("application"),this.getCtx().setAriaLabel(DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,"COLON_SEP_LIST",[DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,"DATA_VISUALIZATION"),DvtStringUtils.processAriaLabel(this.GetComponentDescription())]))}};
DvtLegend.prototype.isNavigable=function(){return 0<this._navigablePeers.length};var DvtLegendConstants={};DvtObj.createSubclass(DvtLegendConstants,DvtObj,"DvtLegendConstants");DvtLegendConstants.BACKGROUND="background";DvtLegendConstants.LEGEND_ITEM="legendItem";DvtLegendConstants.TITLE="title";var DvtLegendAutomation=function(a){this._legend=a;this._options=this._legend.getOptions()};DvtObj.createSubclass(DvtLegendAutomation,DvtAutomation,"DvtLegendAutomation");
DvtLegendAutomation.prototype.GetSubIdForDomElement=function(a){return(a=this._legend.__getEventManager().GetLogicalObject(a))&&a instanceof DvtLegendObjPeer&&(a=a.getData(),a=this._getIndicesFromItem(a,this._options))?"section"+a:null};
DvtLegendAutomation.prototype._getIndicesFromItem=function(a,b){if(b.sections&&0<b.sections.length){for(var c=0;c<b.sections.length;c++){if(b.sections[c]==a)return"["+c+"]";var d=this._getIndicesFromItem(a,b.sections[c]);if(d)return"["+c+"]"+d}return null}if(b.items&&0<b.items.length){for(c=0;c<b.items.length;c++)if(b.items[c]==a)return":item["+c+"]";return null}};
DvtLegendAutomation.prototype.getIndicesFromSeries=function(a,b){if(b.sections&&0<b.sections.length){for(var c=0;c<b.sections.length;c++){var d=this.getIndicesFromSeries(a,b.sections[c]);if(d)return"["+c+"]"+d}return null}if(b.items&&0<b.items.length){for(c=0;c<b.items.length;c++)if(b.items[c].text==a.name)return":item["+c+"]";return null}};
DvtLegendAutomation.prototype.getLegendItem=function(a,b){var c=b.indexOf("["),d=b.indexOf("]");if(0<=c&&0<=d){var c=b.substring(c+1,d),e=b.indexOf(":");b=b.substring(d+1);var d=b.indexOf("["),g=b.indexOf("]");return 0<=d&&0<=g?this.getLegendItem(a.sections[c],b):0==e?a.items[c]:a.sections[c]}};
DvtLegendAutomation.prototype.getDomElementForSubId=function(a){if(a==DvtAutomation.TOOLTIP_SUBID)return this.GetTooltipElement(this._legend);a=this.getLegendItem(this._options,a);for(var b=this._legend.__getObjects(),c=0;c<b.length;c++){var d=b[c].getData();if(a==d)return b[c].getDisplayables()[0].getElem()}return null};DvtLegendAutomation.prototype.getTitle=function(){return this._options.title};
DvtLegendAutomation.prototype.getItem=function(a){for(var b,c=a.shift(),d=this._options;void 0!=c;)0<a.length?d=d.sections[c]:b=d.items[c],c=a.shift();return b?{text:b.text?b.text:null}:null};DvtLegendAutomation.prototype.getSection=function(a){for(var b,c=a.shift(),d=this._options;void 0!=c;)0<a.length?d=d.sections[c]:b=d.sections[c],c=a.shift();return{title:b.title?b.title:null,items:b.items?this._generateItemObjects(b.items):null,sections:b.sections?this._generateSectionObjects(b.sections):null}};
DvtLegendAutomation.prototype._generateItemObjects=function(a){for(var b=[],c=0;c<a.length;c++)b.push({text:a[c].text});return b};DvtLegendAutomation.prototype._generateSectionObjects=function(a){for(var b=[],c=0;c<a.length;c++)b.push({title:a[c].title?a[c].title:null,items:a[c].items?this._generateItemObjects(a[c].items):null,sections:a[c].sections?this._generateSectionObjects(a[c].sections):null});return b};
var DvtLegendDefaults=function(){this.Init({skyros:DvtLegendDefaults.VERSION_1,alta:DvtLegendDefaults.SKIN_ALTA,next:DvtLegendDefaults.SKIN_NEXT})};DvtObj.createSubclass(DvtLegendDefaults,DvtBaseComponentDefaults,"DvtLegendDefaults");
DvtLegendDefaults.SKIN_NEXT={skin:DvtCSSStyle.SKIN_NEXT,titleStyle:new DvtCSSStyle("color: #737373;"),_sectionTitleStyle:new DvtCSSStyle("color: #737373;"),layout:{titleGapWidth:17,titleGapHeight:9,symbolGapWidth:7,symbolGapHeight:4,rowGap:4,columnGap:10,sectionGapHeight:16,sectionGapWidth:24}};
DvtLegendDefaults.SKIN_ALTA={skin:DvtCSSStyle.SKIN_ALTA,textStyle:new DvtCSSStyle("font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;"),titleStyle:new DvtCSSStyle("font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 11px; color: #333333;"),_sectionTitleStyle:new DvtCSSStyle("font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 11px; color: #333333;")};
DvtLegendDefaults.VERSION_1={skin:DvtCSSStyle.SKIN_SKYROS,orientation:"vertical",position:null,backgroundColor:null,borderColor:null,textStyle:new DvtCSSStyle("font-family: tahoma, sans-serif; font-size: 11px; color: #333333;"),titleStyle:new DvtCSSStyle("font-family: tahoma, sans-serif; font-size: 12px; color: #003d5b;"),titleHalign:"start",hiddenCategories:[],hideAndShowBehavior:"off",hoverBehavior:"none",hoverBehaviorDelay:200,scrolling:"asNeeded",halign:"start",valign:"top",drilling:"off",_color:"#a6acb1",
_markerShape:"square",_lineWidth:3,layout:{outerGapWidth:3,outerGapHeight:3,titleGapWidth:8,titleGapHeight:3,symbolGapWidth:5,symbolGapHeight:4,rowGap:0,columnGap:8,sectionGapHeight:6,sectionGapWidth:15},isLayout:!1};DvtLegendDefaults.getGapSize=function(a,b){var c=Math.min(DvtTextUtils.getTextStringHeight(a.getCtx(),a.getOptions().textStyle)/14,1);return Math.ceil(b*c)};var DvtLegendEventManager=function(a){this.Init(a.getCtx(),a.processEvent,a);this._legend=a};
DvtObj.createSubclass(DvtLegendEventManager,DvtEventManager,"DvtLegendEventManager");DvtLegendEventManager.getUIEventParams=function(a,b){return{type:a,id:b}};DvtLegendEventManager.prototype.FireUIEvent=function(a,b){var c=null;b instanceof DvtSimpleObjPeer&&null!=b.getParams()?c=b.getParams():b instanceof DvtLegendObjPeer&&(c=DvtLegendEventManager.getUIEventParams(DvtLegendConstants.LEGEND_ITEM,b.getId()));this.FireEvent(new DvtComponentUIEvent(a,c),this._legend)};
DvtLegendEventManager.prototype.OnClick=function(a){DvtLegendEventManager.superclass.OnClick.call(this,a);var b=this.GetLogicalObject(a.target);if(b){var c=this.processHideShowEvent(b),b=this.processActionEvent(b);(c||b)&&a.stopPropagation()}};DvtLegendEventManager.prototype.OnMouseOver=function(a){DvtLegendEventManager.superclass.OnMouseOver.call(this,a);(a=this.GetLogicalObject(a.target))&&this.UpdateActiveElement(a)};
DvtLegendEventManager.prototype.OnMouseOut=function(a){DvtLegendEventManager.superclass.OnMouseOut.call(this,a);this.GetLogicalObject(a.target)};DvtLegendEventManager.prototype.HandleTouchClickInternal=function(a){var b=this.GetLogicalObject(a.target);if(b){a=a.touchEvent;var c=this.processHideShowEvent(b),b=this.processActionEvent(b);(c||b)&&a&&a.preventDefault()}};
DvtLegendEventManager.prototype.processHideShowEvent=function(a){var b=this._legend.getOptions().hideAndShowBehavior;if("none"==b||"off"==b)return!1;var c=a.getCategories?a.getCategories():null;if(!c||0>=c.length)return!1;for(var d=a.getCategories()[0],b=this._legend.getOptions().hiddenCategories||[],b=b.slice(),e=a.getDisplayables(),g=0;g<e.length;g++){var h=e[g];h instanceof DvtSimpleMarker?h.setHollow(a.getColor()):h instanceof DvtRect&&a.updateAriaLabel()}a=c[0];DvtLegendRenderer.isCategoryHidden(d,
this._legend)?(b.splice(b.indexOf(d),1),a=new DvtCategoryHideShowEvent(DvtCategoryHideShowEvent.TYPE_SHOW,a)):(b.push(d),a=new DvtCategoryHideShowEvent(DvtCategoryHideShowEvent.TYPE_HIDE,a));a.hiddenCategories=b;this._legend.getOptions().hiddenCategories=b;this.FireEvent(a,this._legend);return!0};
DvtLegendEventManager.prototype.processActionEvent=function(a){return a&&a.getAction&&a.getAction()?(this.FireEvent(new DvtActionEvent(DvtActionEvent.SUBTYPE_ACTION,a.getAction(),a.getId()),this._legend),!0):a instanceof DvtLegendObjPeer&&a.isDrillable()?(a=a.getId(),this.FireEvent(new DvtDrillEvent(a,a,null),this._legend),!0):!1};
DvtLegendEventManager.prototype.ProcessRolloverEvent=function(a,b,c){a=this._legend.getOptions();"none"==a.hoverBehavior||b.getDisplayables&&b.getDisplayables()[0]instanceof DvtButton||(b=b.getCategories?b.getCategories():[],a.highlightedCategories=c?b.slice():null,c=new DvtCategoryRolloverEvent(c?DvtCategoryRolloverEvent.TYPE_OVER:DvtCategoryRolloverEvent.TYPE_OUT,a.highlightedCategories),a=DvtStyleUtils.getTimeMilliseconds(a.hoverBehaviorDelay),this.RolloverHandler.processEvent(c,this._legend.__getObjects(),
a,!0))};
DvtLegendEventManager.prototype.onCollapseButtonClick=function(a,b){for(var c=b.getId(),d=this._legend.getOptions(),e=0;e<c.length;e++)d=d.sections[c[e]];d.expanded="off"==d.expanded?"on":"off";a.type==DvtMouseEvent.CLICK&&(c=this.GetLogicalObject(this.GetCurrentTargetForEvent(a)),this.setFocusObj(c.getNextNavigable(a)));d=(c=this._legend.getKeyboardFocus())?c.isShowingKeyboardFocusEffect():!1;this._legend.render();c&&this._legend.setKeyboardFocus(c,d);this.hideTooltip();c=this._legend.getContentDimensions();this.FireEvent(new DvtResizeEvent(c.w,
c.h,c.x,c.y),this._legend)};DvtLegendEventManager.prototype.GetTouchResponse=function(){return this._legend.getOptions()._isScrollingLegend?DvtEventManager.TOUCH_RESPONSE_TOUCH_HOLD:DvtEventManager.TOUCH_RESPONSE_TOUCH_START};var DvtLegendKeyboardHandler=function(a,b){this.Init(a,b)};DvtObj.createSubclass(DvtLegendKeyboardHandler,DvtKeyboardHandler,"DvtLegendKeyboardHandler");DvtLegendKeyboardHandler.prototype.Init=function(a,b){DvtLegendKeyboardHandler.superclass.Init.call(this,a);this._legend=b};
DvtLegendKeyboardHandler.prototype.processKeyDown=function(a){var b=a.keyCode,c=this._eventManager.getFocus(),d=c&&c.getDisplayables()[0]instanceof DvtButton,e=null;if(null==c&&b==DvtKeyboardEvent.TAB)b=this._legend.__getKeyboardObjects(),0<b.length&&(DvtEventManager.consumeEvent(a),e=this.getDefaultNavigable(b));else if(c)if(b==DvtKeyboardEvent.TAB)DvtEventManager.consumeEvent(a),e=c;else if(b==DvtKeyboardEvent.ENTER||b==DvtKeyboardEvent.SPACE){b==DvtKeyboardEvent.ENTER&&this._eventManager.processActionEvent(c);
if(d)this._eventManager.onCollapseButtonClick(a,c.getDisplayables()[0]);else this._eventManager.processHideShowEvent(c);DvtEventManager.consumeEvent(a)}else!d||b!=DvtKeyboardEvent.LEFT_ARROW&&b!=DvtKeyboardEvent.RIGHT_ARROW?e=DvtLegendKeyboardHandler.superclass.processKeyDown.call(this,a):(this._eventManager.onCollapseButtonClick(a,c.getDisplayables()[0]),DvtEventManager.consumeEvent(a));e&&this._legend.container.scrollIntoView(e.getDisplayables()[0]);return e};
var DvtLegendObjPeer=function(a,b,c,d,e,g){this.Init(a,b,c,d,e,g)};DvtObj.createSubclass(DvtLegendObjPeer,DvtObj,"DvtLegendObjPeer");
DvtLegendObjPeer.prototype.Init=function(a,b,c,d,e,g){this._legend=a;this._displayables=b;this._item=c;this._id=(this._category=DvtLegendRenderer.getItemCategory(this._item))?this._category:c.title;this._action=c.action;this._drillable=g;this._spb=c._spb;this._tooltip=d;this._datatip=e;this._isShowingKeyboardFocusEffect=!1;if(this._action||this._drillable)for(a=0;a<this._displayables.length;a++)this._displayables[a].setCursor(DvtSelectionEffectUtils.getSelectingCursor())};
DvtLegendObjPeer.associate=function(a,b,c,d,e,g){if(!a||!c)return null;c=new DvtLegendObjPeer(b,a,c,d,e,g);b.__registerObject(c);for(d=0;d<a.length;d++)b.__getEventManager().associate(a[d],c);return c};DvtLegendObjPeer.prototype.getData=function(){return this._item};DvtLegendObjPeer.prototype.getColor=function(){return this._item.color};DvtLegendObjPeer.prototype.getId=function(){return this._id};DvtLegendObjPeer.prototype.getDisplayables=function(){return this._displayables};
DvtLegendObjPeer.prototype.getCategories=function(a){return null!=this._category?[this._category]:null};DvtLegendObjPeer.prototype.getAction=function(){return this._action};DvtLegendObjPeer.prototype.isDrillable=function(){return this._drillable};DvtLegendObjPeer.prototype.getShowPopupBehaviors=function(){return this._spb};
DvtLegendObjPeer.prototype.getAriaLabel=function(){var a=[],b=this._legend.getOptions(),c=this._legend.getOptions().hideAndShowBehavior,d=DvtLegendRenderer.isCategoryHidden(this._category,this._legend),e=this.getData();if(this._displayables[0]instanceof DvtButton)return a.push(DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,"off"==e.expanded?"STATE_COLLAPSED":"STATE_EXPANDED")),DvtDisplayable.generateAriaLabel(e.title,a);"off"!=c&&"none"!=c&&a.push(DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,
d?"STATE_HIDDEN":"STATE_VISIBLE"));this.isDrillable()&&a.push(DvtBundle.getTranslation(b,"stateDrillable",DvtBundle.UTIL_PREFIX,"STATE_DRILLABLE"));return null!=e.shortDesc?DvtDisplayable.generateAriaLabel(e.shortDesc,a):0<a.length?DvtDisplayable.generateAriaLabel(e.text,a):null};DvtLegendObjPeer.prototype.updateAriaLabel=function(){!DvtAgent.deferAriaCreation()&&this._displayables[0]&&this._displayables[0].setAriaProperty("label",this.getAriaLabel())};
DvtLegendObjPeer.prototype.getNextNavigable=function(a){if(a.type==DvtMouseEvent.CLICK)return this;var b=this._legend.__getKeyboardObjects();return DvtKeyboardHandler.getNextNavigable(this,a,b,!0)};DvtLegendObjPeer.prototype.getKeyboardBoundingBox=function(a){return this._displayables[0]?this._displayables[0].getDimensions(a):new DvtRectangle(0,0,0,0)};DvtLegendObjPeer.prototype.getTargetElem=function(){return this._displayables[0]?this._displayables[0].getElem():null};
DvtLegendObjPeer.prototype.showKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!0;this._displayables[0]&&(this._displayables[0]instanceof DvtButton?this._displayables[0].drawOverState():this._displayables[0].setSolidStroke(DvtAgent.getFocusColor()))};DvtLegendObjPeer.prototype.hideKeyboardFocusEffect=function(){this._isShowingKeyboardFocusEffect=!1;this._displayables[0]&&(this._displayables[0]instanceof DvtButton?this._displayables[0].drawUpState():this._displayables[0].setStroke(null))};
DvtLegendObjPeer.prototype.isShowingKeyboardFocusEffect=function(){return this._isShowingKeyboardFocusEffect};DvtLegendObjPeer.prototype.getTooltip=function(a){return this._tooltip};DvtLegendObjPeer.prototype.getDatatip=function(a){return this._datatip};DvtLegendObjPeer.prototype.getDatatipColor=function(a){return this._item.color};var DvtLegendRenderer={};DvtObj.createSubclass(DvtLegendRenderer,DvtObj,"DvtLegendRenderer");DvtLegendRenderer._MAX_LINE_WIDTH=5;
DvtLegendRenderer._MAX_LINE_WIDTH_WITH_MARKER=2;DvtLegendRenderer._LINE_MARKER_SIZE_FACTOR=.6;DvtLegendRenderer._DEFAULT_SYMBOL_SIZE=10;DvtLegendRenderer._BUTTON_SIZE=12;DvtLegendRenderer._FOCUS_GAP=2;
DvtLegendRenderer.render=function(a,b){var c=a.getOptions(),d=a.getCtx(),e=DvtAgent.isRightToLeft(d);c.isLayout||DvtLegendRenderer._renderBackground(a,b);var g=new DvtSimpleScrollableContainer(d,b.w,b.h),h=new DvtContainer(d);g.getScrollingPane().addChild(h);a.addChild(g);a.container=g;var k=DvtLegendDefaults.getGapSize(a,c.layout.outerGapWidth),m=DvtLegendDefaults.getGapSize(a,c.layout.outerGapHeight);b.x+=k;b.y+=m;b.w-=2*k;b.h-=2*m;a.__setBounds(b);if(0>=b.w||0>=b.h)return new DvtDimension(0,0);
d=DvtLegendRenderer._renderContents(a,h,new DvtRectangle(b.x,b.y,b.w,b.h));if(0==d.w||0==d.h)return new DvtDimension(0,0);g.prepareContentPane();d.h>b.h?(d.h=b.h,c._isScrollingLegend=!0):c._isScrollingLegend=!1;var n=g=0,t=null!=c.hAlign?c.hAlign:c.halign;"center"==t?g=b.x-d.x+(b.w-d.w)/2:"end"==t&&(g=e?b.x-d.x:b.x-d.x+b.w-d.w);e=null!=c.vAlign?c.vAlign:c.valign;"middle"==e?n=b.y-d.y+(b.h-d.h)/2:"bottom"==e&&(n=b.y-d.y+b.h-d.h);e=new DvtRectangle(d.x+g-k,d.y+n-m,d.w+2*k,d.h+2*m);if(c.isLayout)return e;
(g||n)&&h.setTranslate(g,n);c=a.__getTitles();for(h=0;h<c.length;h++)DvtLayoutUtils.align(d,c[h].halign,c[h].text,c[h].text.measureDimensions().w);return e};
DvtLegendRenderer._renderContents=function(a,b,c){var d=a.getOptions();c=c.clone();var e=DvtLegendRenderer._renderTitle(a,b,d.title,c,null,!0);if(e){var g=e.measureDimensions(),h=DvtLegendDefaults.getGapSize(a,d.layout.titleGapHeight);c.y+=g.h+h;c.h-=Math.floor(g.h+h)}a=DvtLegendRenderer._renderSections(a,b,d.sections,c,[]);return e?g.getUnion(a):a};
DvtLegendRenderer._renderBackground=function(a,b){var c=a.getOptions(),d=c.backgroundColor,e=c.borderColor;if(d||e)c=new DvtRect(a.getCtx(),b.x,b.y,b.w,b.h),d?c.setSolidFill(d):c.setInvisibleFill(),e&&(c.setSolidStroke(e),c.setPixelHinting(!0)),d=DvtLegendEventManager.getUIEventParams(DvtLegendConstants.BACKGROUND),a.__getEventManager().associate(c,new DvtSimpleObjPeer(null,null,null,d)),a.addChild(c)};
DvtLegendRenderer._renderTitle=function(a,b,c,d,e,g){var h=a.getOptions(),k=b.getCtx(),m=DvtAgent.isRightToLeft(k);if(!c)return null;c=new DvtOutputText(k,c,d.x,d.y);k=h.titleStyle;e&&e.titleStyle?k=new DvtCSSStyle(e.titleStyle):e&&h._sectionTitleStyle&&(k=h._sectionTitleStyle);c.setCSSStyle(k);return DvtTextUtils.fitText(c,d.w,Infinity,b)?(m&&c.setX(d.x+d.w-c.measureDimensions().w),h.isLayout?b.removeChild(c):(b=DvtLegendEventManager.getUIEventParams(DvtLegendConstants.TITLE),a.__getEventManager().associate(c,
new DvtSimpleObjPeer(c.getUntruncatedTextString(),null,null,b)),g&&a.__registerTitle({text:c,halign:e&&e.titleHalign?e.titleHalign:h.titleHalign})),c):null};
DvtLegendRenderer._renderSections=function(a,b,c,d,e){var g=a.getOptions();null==g.symbolWidth&&null==g.symbolHeight?(g.symbolWidth=DvtLegendRenderer._DEFAULT_SYMBOL_SIZE,g.symbolHeight=DvtLegendRenderer._DEFAULT_SYMBOL_SIZE):(null==g.symbolWidth?g.symbolWidth=g.symbolHeight:null==g.symbolHeight&&(g.symbolHeight=g.symbolWidth),g.symbolWidth=parseInt(g.symbolWidth),g.symbolHeight=parseInt(g.symbolHeight));for(var h=DvtLegendDefaults.getGapSize(a,g.layout.sectionGapHeight),k=DvtLegendDefaults.getGapSize(a,
g.layout.titleGapHeight),m=DvtLegendDefaults.getGapSize(a,g.layout.sectionGapWidth),n=DvtLegendRenderer._getRowHeight(a),g="vertical"!=g.orientation,t=null,u=d.clone(),v,w=0;w<c.length;w++){var x=e.concat([w]),y="off"==c[w].expanded||0==c[w].expanded?k:h;g?(v=DvtLegendRenderer._renderHorizontalSection(a,b,c[w],u,n),v.w>u.w?(u.w<d.w&&(d.y+=v.h+y,d.h-=v.h+y),v=v.w<=d.w?DvtLegendRenderer._renderHorizontalSection(a,b,c[w],d,n):DvtLegendRenderer._renderVerticalSection(a,b,c[w],d,n,x,!0),d.y+=v.h+y,d.h-=
v.h+y,u=d.clone()):(u.w-=v.w+m,DvtAgent.isRightToLeft(a.getCtx())||(u.x+=v.w+m))):(v=DvtLegendRenderer._renderVerticalSection(a,b,c[w],d,n,x,!1),d.y+=v.h+y,d.h-=v.h+y);t=t?t.getUnion(v):v}return t};
DvtLegendRenderer._createButton=function(a,b,c,d,e,g,h,k,m,n,t){var u=DvtLegendRenderer._createButtonImage(a,d,e+"Enabled",g,h),v=DvtLegendRenderer._createButtonImage(a,d,e+"Over",g,h);d=DvtLegendRenderer._createButtonImage(a,d,e+"Down",g,h);a=new DvtButton(a,u,v,d,null,m,n,t);b=DvtLegendObjPeer.associate([a],b,c,k,null,!1);a.setAriaRole("button");b.updateAriaLabel();return a};
DvtLegendRenderer._createButtonImage=function(a,b,c,d,e){var g=DvtAgent.isRightToLeft(a)?"RTL":"";a=new DvtImage(a,b[c+g]?b[c+g]:b[c],d,e,DvtLegendRenderer._BUTTON_SIZE,DvtLegendRenderer._BUTTON_SIZE);a.setInvisibleFill();return a};
DvtLegendRenderer._renderVerticalSection=function(a,b,c,d,e,g,h){if(c){var k=a.getOptions(),m=DvtLegendDefaults.getGapSize(a,k.layout.symbolGapWidth),n=DvtLegendDefaults.getGapSize(a,k.layout.rowGap),t=DvtLegendDefaults.getGapSize(a,k.layout.columnGap),u=a.getCtx(),v=DvtAgent.isRightToLeft(u);d=d.clone();"off"!=k.scrolling&&(d.h=Infinity);var w,x="on"==c.collapsible||1==c.collapsible;if(x){w=v?d.x+d.w-DvtLegendRenderer._BUTTON_SIZE:d.x;if(!k.isLayout){var y="off"==c.expanded||0==c.expanded,z=y?"closed":
"open",y=DvtBundle.getTranslatedString(DvtBundle.UTIL_PREFIX,y?"EXPAND":"COLLAPSE",null),A=a.__getEventManager(),u=DvtLegendRenderer._createButton(u,a,c,k._resources,z,w,d.y,y,g,A.onCollapseButtonClick,A);b.addChild(u)}w=new DvtRectangle(w,d.y,DvtLegendRenderer._BUTTON_SIZE,DvtLegendRenderer._BUTTON_SIZE);u=DvtLegendDefaults.getGapSize(a,k.layout.symbolGapWidth);v||(d.x+=DvtLegendRenderer._BUTTON_SIZE+u);d.w-=DvtLegendRenderer._BUTTON_SIZE+u}x=(x=DvtLegendRenderer._renderTitle(a,b,c.title,d,c,!x&&
1>=g.length))?x.measureDimensions():new DvtRectangle(v?d.x+d.w:d.x,d.y,0,0);x=w?x.getUnion(w):x;if(!c.items&&!c.sections||"off"==c.expanded||0==c.expanded)return x;0<x.h&&(u=DvtLegendDefaults.getGapSize(a,k.layout.titleGapHeight),d.y+=x.h+u,d.h-=x.h+u);c.sections&&(g=DvtLegendRenderer._renderSections(a,b,c.sections,d,g),x=x.getUnion(g));if(!c.items)return x;u=DvtLegendRenderer._calcColumns(a,d,e,c.items,h);h=u.numCols;g=u.numRows;u=u.width;w=d.y;if(0==g||0==h)return x;z=g*(e+n)-n;y=Math.min(h*(u+
t)-t,d.w);z=new DvtRectangle(v?d.x+d.w-y:d.x,d.y,y,z);x=x.getUnion(z);if(k.isLayout)return x;k=u-k.symbolWidth-m;m=0;z=1;y=c.items.length;for(A=0;A<y&&(DvtLegendRenderer._createLegendItem(a,b,c.items[A],d,k,e,A),d.y+=e+n,m++,m===g&&z!==h&&(d.y=w,d.w-=u+t,v||(d.x+=u+t),m=0,z++),m!==g);A++);return x}};
DvtLegendRenderer._renderHorizontalSection=function(a,b,c,d,e){if(c){var g=a.getOptions(),h=g.symbolWidth,k=DvtLegendDefaults.getGapSize(a,g.layout.symbolGapWidth),m=DvtLegendDefaults.getGapSize(a,g.layout.columnGap),n=DvtLegendDefaults.getGapSize(a,g.layout.titleGapWidth),t=c.items.length,u=DvtAgent.isRightToLeft(a.getCtx()),v=d.clone(),w=DvtLegendRenderer._renderTitle(a,b,c.title,d,c,!1),x=w?w.measureDimensions():new DvtRectangle(u?d.x+d.w:d.x,d.y,0,0);if(!c.items)return x;0<x.w&&(v.w-=x.w+n,u||
(v.x+=x.w+n));var n=[],y=d.w-v.w,z,A;for(A=0;A<t;A++)z=c.items[A],z=Math.ceil(DvtTextUtils.getTextStringWidth(a.getCtx(),z.text,g.textStyle)),y+=z+h+k+m,n.push(z);0<t&&(y-=m);x=new DvtRectangle(u?d.x+d.w-y:d.x,d.y,y,Math.max(e,x.h));if(g.isLayout||y>d.w)return b.removeChild(w),x;for(A=0;A<t;A++)z=c.items[A],DvtLegendRenderer._createLegendItem(a,b,z,v,n[A],e,A),d=n[A]+h+k,v.w-=d+m,u||(v.x+=d+m);return x}};
DvtLegendRenderer._calcColumns=function(a,b,c,d,e){for(var g=a.getOptions(),h=0,k=0;k<d.length;k++){var m=d[k],m=DvtTextUtils.getTextStringWidth(a.getCtx(),m.text,g.textStyle);m>h&&(h=m)}var k=g.symbolWidth,n=DvtLegendDefaults.getGapSize(a,g.layout.symbolGapWidth),m=DvtLegendDefaults.getGapSize(a,g.layout.rowGap);a=DvtLegendDefaults.getGapSize(a,g.layout.columnGap);h=Math.ceil(k+n+h);e?(e=Math.min(Math.floor((b.w+a)/(h+a)),d.length),c=Math.min(Math.floor((b.h+m)/(c+m)),Math.ceil(d.length/e)),e=Math.ceil(d.length/
c),c=Math.ceil(d.length/e)):Infinity==b.h?(e=1,c=d.length):(c=Math.min(Math.floor((b.h+m)/(c+m)),d.length),e=Math.ceil(d.length/c),c=Math.ceil(d.length/e));b=Math.min(h,(b.w-a*(e-1))/e);return b<k?{width:0,numCols:0,numRows:0}:{width:b,numCols:e,numRows:c}};
DvtLegendRenderer._getRowHeight=function(a){var b=a.getOptions(),c=new DvtOutputText(a.getCtx(),"Test");c.setCSSStyle(b.textStyle);c.alignMiddle();c=DvtTextUtils.guessTextDimensions(c).h;a=b.symbolHeight+DvtLegendDefaults.getGapSize(a,b.layout.symbolGapHeight);return Math.ceil(Math.max(c,a))};
DvtLegendRenderer._createLegendItem=function(a,b,c,d,e,g,h){var k=a.getOptions(),m=a.getCtx(),n=DvtAgent.isRightToLeft(m),t=k.symbolWidth,u=DvtLegendDefaults.getGapSize(a,k.layout.symbolGapWidth),v=n?d.x+d.w-t:d.x,w=n?d.x+d.w-t-u:d.x+t+u;h=DvtLegendRenderer._createLegendSymbol(a,v,d.y,g,c,h);var x=c.text,y;x&&(y=DvtLegendRenderer._createLegendText(b,e,x,k.textStyle))&&(y.setX(w),DvtTextUtils.centerTextVertically(y,d.y+g/2),n&&y.alignRight());b.addChild(h);d=new DvtRect(m,n?w-e-DvtLegendRenderer._FOCUS_GAP:
v-DvtLegendRenderer._FOCUS_GAP,d.y-DvtLegendRenderer._FOCUS_GAP,t+u+e+2*DvtLegendRenderer._FOCUS_GAP,g+2*DvtLegendRenderer._FOCUS_GAP);d.setInvisibleFill();k=k.hideAndShowBehavior;"none"!=k&&"off"!=k&&d.setCursor("pointer");b.addChild(d);b=[d,h];null!=y&&b.push(y);y=DvtLegendObjPeer.associate(b,a,c,null!=y?y.getUntruncatedTextString():null,c.shortDesc,DvtLegendRenderer._isItemDrillable(a,c));DvtLegendRenderer.isCategoryHidden(DvtLegendRenderer.getItemCategory(c),a)&&h.setHollow(y.getColor());if("none"!=
k&&"off"!=k||null!=c.shortDesc)d.setAriaRole("img"),y.updateAriaLabel()};DvtLegendRenderer._isItemDrillable=function(a,b){return"on"==b.drilling?!0:"off"==b.drilling?!1:"on"==a.getOptions().drilling};DvtLegendRenderer._createLegendText=function(a,b,c,d){c=new DvtOutputText(a.getCtx(),c);c.setCSSStyle(d);return c=DvtTextUtils.fitText(c,b,Infinity,a)?c:null};
DvtLegendRenderer._createLegendSymbol=function(a,b,c,d,e,g){var h=a.getOptions();e.markerShape||(e.markerShape=h._markerShape);e.color||(e.color=h._color);e.lineWidth||(e.lineWidth=h._lineWidth);g=h.symbolWidth;var h=h.symbolHeight,k=c+d/2,m=b+g/2,n=null!=e.type?e.type:e.symbolType;"line"==n?(e.lineWidth=Math.min(e.lineWidth,DvtLegendRenderer._MAX_LINE_WIDTH),b=DvtLegendRenderer._createLine(a.getCtx(),b,c,g,d,e)):"lineWithMarker"==n?(e.lineWidth=Math.min(e.lineWidth,DvtLegendRenderer._MAX_LINE_WIDTH_WITH_MARKER),
b=DvtLegendRenderer._createLine(a.getCtx(),b,c,g,d,e),DvtLegendRenderer.isCategoryHidden(DvtLegendRenderer.getItemCategory(e),a)||b.addChild(DvtLegendRenderer._createMarker(a,m,k,g*DvtLegendRenderer._LINE_MARKER_SIZE_FACTOR,h*DvtLegendRenderer._LINE_MARKER_SIZE_FACTOR,e))):b="image"==n?DvtLegendRenderer._createImage(a,b,c,g,h,d,e):DvtLegendRenderer._createMarker(a,m,k,g,h,e);return b};
DvtLegendRenderer._createImage=function(a,b,c,d,e,g,h){a=a.getCtx();return new DvtImage(a,h.source,b,c+(g-e)/2,d,e)};
DvtLegendRenderer._createMarker=function(a,b,c,d,e,g){var h=a.getCtx(),k=a.getOptions();a=g.markerShape;var m=g.markerColor?g.markerColor:g.color,n=g.pattern;n&&"none"!=n?(d=new DvtSimpleMarker(h,a,k.skin,0,0,d,e),d.setFill(new DvtPatternFill(n,m,"#FFFFFF")),d.setTranslate(b,c)):(d=new DvtSimpleMarker(h,a,k.skin,b,c,d,e),d.setSolidFill(m));g.borderColor&&d.setSolidStroke(g.borderColor,null,g._borderWidth?g._borderWidth:1);"square"==a&&d.setPixelHinting(!0);return d};
DvtLegendRenderer._createLine=function(a,b,c,d,e,g){c+=e/2;a=new DvtLine(a,b,c,b+d,c);b=new DvtSolidStroke(g.color,1,g.lineWidth);g=g.lineStyle;"dashed"==g?b.setType(DvtStroke.convertTypeString(g),"4,2,4"):"dotted"==g&&b.setType(DvtStroke.convertTypeString(g),"2");a.setStroke(b);a.setPixelHinting(!0);return a};DvtLegendRenderer.getItemCategory=function(a){var b=null;return b=a.categories&&0<a.categories.length?a.categories[0]:a.id?a.id:a.text};
DvtLegendRenderer.isCategoryHidden=function(a,b){var c=b.getOptions().hiddenCategories;return!c||0>=c.length?!1:-1!==c.indexOf(a)};